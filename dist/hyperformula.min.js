/*!
 * Copyright (c) HANDSONCODE sp. z o. o.
 * 
 * HYPERFORMULA is software distributed by HANDSONCODE sp. z o. o.,
 * a Polish corporation, based in Gdynia, Poland, at 96/98 Aleja Zwycięstwa,
 * registered with the National Court Register under number 538651,
 * EU tax ID number: PL5862294002, share capital: PLN 62,800.00.
 * 
 * This software is protected by applicable copyright laws, including
 * international treaties, and double-licensed.
 * 
 * First, commercial purposes dictate individual approach
 * and the terms of such use are subject to negotiations.
 * 
 * Second, at your option, your use of this Software –
 * either commercial, non-commercial, or both –
 * may be subject to the GNU General Public License
 * in such version as included in the “gpl-3.0.txt” file,
 * available in the main directory of this software repository.
 * 
 * HANDSONCODE PROVIDES THIS SOFTWARE ON AN “AS IS” BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND. IN NO EVENT
 * AND UNDER NO LEGAL THEORY, SHALL HANDSONCODE BE LIABLE
 * TO YOU FOR DAMAGES, INCLUDING ANY DIRECT, INDIRECT, SPECIAL,
 * INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY CHARACTER ARISING
 * FROM USE OR INABILITY TO USE THIS SOFTWARE.
 * 
 * Version: 2.0.1
 * Release date: 14/06/2022 (built at 14/07/2022 17:33:52)
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("chevrotain"),require("unorm"),require("tiny-emitter")):"function"==typeof define&&define.amd?define("HyperFormula",["chevrotain","unorm","tiny-emitter"],t):"object"==typeof exports?exports.HyperFormula=t(require("chevrotain"),require("unorm"),require("tiny-emitter")):e.HyperFormula=t(e.chevrotain,e.unorm,e.TinyEmitter)}("undefined"!=typeof self?self:this,(function(e,t,r){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var s=r(1);t.CellError=s.CellError,t.CellType=s.CellType,t.CellValueDetailedType=s.CellValueDetailedType,t.CellValueType=s.CellValueType,t.ErrorType=s.ErrorType;var n=r(53);t.DetailedCellError=n.DetailedCellError;var a=r(54),o=r(58);t.AlwaysDense=o.AlwaysDense,t.AlwaysSparse=o.AlwaysSparse,t.DenseSparseChooseBasedOnThreshold=o.DenseSparseChooseBasedOnThreshold;var i=r(5);t.ConfigValueTooBigError=i.ConfigValueTooBigError,t.ConfigValueTooSmallError=i.ConfigValueTooSmallError,t.EvaluationSuspendedError=i.EvaluationSuspendedError,t.ExpectedOneOfValuesError=i.ExpectedOneOfValuesError,t.ExpectedValueOfTypeError=i.ExpectedValueOfTypeError,t.FunctionPluginValidationError=i.FunctionPluginValidationError,t.InvalidAddressError=i.InvalidAddressError,t.InvalidArgumentsError=i.InvalidArgumentsError,t.LanguageAlreadyRegisteredError=i.LanguageAlreadyRegisteredError,t.LanguageNotRegisteredError=i.LanguageNotRegisteredError,t.MissingTranslationError=i.MissingTranslationError,t.NamedExpressionDoesNotExistError=i.NamedExpressionDoesNotExistError,t.NamedExpressionNameIsAlreadyTakenError=i.NamedExpressionNameIsAlreadyTakenError,t.NamedExpressionNameIsInvalidError=i.NamedExpressionNameIsInvalidError,t.NoOperationToRedoError=i.NoOperationToRedoError,t.NoOperationToUndoError=i.NoOperationToUndoError,t.NoRelativeAddressesAllowedError=i.NoRelativeAddressesAllowedError,t.NoSheetWithIdError=i.NoSheetWithIdError,t.NoSheetWithNameError=i.NoSheetWithNameError,t.NotAFormulaError=i.NotAFormulaError,t.NothingToPasteError=i.NothingToPasteError,t.ProtectedFunctionTranslationError=i.ProtectedFunctionTranslationError,t.SheetNameAlreadyTakenError=i.SheetNameAlreadyTakenError,t.SheetSizeLimitExceededError=i.SheetSizeLimitExceededError,t.SourceLocationHasArrayError=i.SourceLocationHasArrayError,t.TargetLocationHasArrayError=i.TargetLocationHasArrayError,t.UnableToParseError=i.UnableToParseError;var u=r(81);t.ExportedCellChange=u.ExportedCellChange,t.ExportedNamedExpressionChange=u.ExportedNamedExpressionChange;var l=r(63);t.HyperFormula=l.HyperFormula;var h,d=(h=r(99))&&h.__esModule?h:{default:h},p=r(100);t.FunctionPlugin=p.FunctionPlugin;var c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}s.default=e,r&&r.set(e,s);return s}(r(101)),m=r(25);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}t.SimpleRangeValue=m.SimpleRangeValue;
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class E extends l.HyperFormula{}E.HyperFormula=l.HyperFormula,E.ErrorType=s.ErrorType,E.CellType=s.CellType,E.CellValueType=s.CellValueType,E.CellValueDetailedType=s.CellValueDetailedType,E.DetailedCellError=n.DetailedCellError,E.ExportedCellChange=u.ExportedCellChange,E.ExportedNamedExpressionChange=u.ExportedNamedExpressionChange,E.ConfigValueTooBigError=i.ConfigValueTooBigError,E.ConfigValueTooSmallError=i.ConfigValueTooSmallError,E.EvaluationSuspendedError=i.EvaluationSuspendedError,E.ExpectedOneOfValuesError=i.ExpectedOneOfValuesError,E.ExpectedValueOfTypeError=i.ExpectedValueOfTypeError,E.FunctionPlugin=p.FunctionPlugin,E.FunctionPluginValidationError=i.FunctionPluginValidationError,E.InvalidAddressError=i.InvalidAddressError,E.InvalidArgumentsError=i.InvalidArgumentsError,E.LanguageNotRegisteredError=i.LanguageNotRegisteredError,E.LanguageAlreadyRegisteredError=i.LanguageAlreadyRegisteredError,E.MissingTranslationError=i.MissingTranslationError,E.NamedExpressionDoesNotExistError=i.NamedExpressionDoesNotExistError,E.NamedExpressionNameIsAlreadyTakenError=i.NamedExpressionNameIsAlreadyTakenError,E.NamedExpressionNameIsInvalidError=i.NamedExpressionNameIsInvalidError,E.NoOperationToRedoError=i.NoOperationToRedoError,E.NoOperationToUndoError=i.NoOperationToUndoError,E.NoRelativeAddressesAllowedError=i.NoRelativeAddressesAllowedError,E.NoSheetWithIdError=i.NoSheetWithIdError,E.NoSheetWithNameError=i.NoSheetWithNameError,E.NotAFormulaError=i.NotAFormulaError,E.NothingToPasteError=i.NothingToPasteError,E.ProtectedFunctionTranslationError=i.ProtectedFunctionTranslationError,E.SheetNameAlreadyTakenError=i.SheetNameAlreadyTakenError,E.SheetSizeLimitExceededError=i.SheetSizeLimitExceededError,E.SourceLocationHasArrayError=i.SourceLocationHasArrayError,E.TargetLocationHasArrayError=i.TargetLocationHasArrayError,E.UnableToParseError=i.UnableToParseError;const T=a.Config.defaultConfig.language;l.HyperFormula.registerLanguage(T,d.default),l.HyperFormula.languages[d.default.langCode]=d.default;for(const e of Object.getOwnPropertyNames(c))e.startsWith("_")||l.HyperFormula.registerFunctionPlugin(c[e]);var y=E;t.default=y},function(e,t,r){"use strict";t.__esModule=!0,t.invalidSimpleRowAddress=t.invalidSimpleColumnAddress=t.invalidSimpleCellAddress=t.getCellValueType=t.getCellValueFormat=t.getCellValueDetailedType=t.getCellType=t.equalSimpleCellAddress=t.addressKey=t.absoluteSheetReference=t.ErrorType=t.CellValueTypeOrd=t.CellValueType=t.CellValueNoNumber=t.CellValueJustNumber=t.CellValueDetailedType=t.CellType=t.CellError=void 0,t.isSimpleCellAddress=function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("col"in e&&"number"==typeof e.col&&"row"in e&&"number"==typeof e.row&&"sheet"in e&&"number"==typeof e.sheet)},t.simpleRowAddress=t.simpleColumnAddress=t.simpleCellAddress=t.movedSimpleCellAddress=void 0;var s,n,a=r(2),o=r(18),i=r(32),u=r(25);t.ErrorType=s,function(e){e.DIV_BY_ZERO="DIV_BY_ZERO",e.NAME="NAME",e.VALUE="VALUE",e.NUM="NUM",e.NA="NA",e.CYCLE="CYCLE",e.REF="REF",e.SPILL="SPILL",e.LIC="LIC",e.ERROR="ERROR"}(s||(t.ErrorType=s={})),t.CellType=n,function(e){e.FORMULA="FORMULA",e.VALUE="VALUE",e.ARRAY="ARRAY",e.EMPTY="EMPTY",e.ARRAYFORMULA="ARRAYFORMULA"}(n||(t.CellType=n={}));var l,h;t.getCellType=(e,t)=>e instanceof a.ArrayVertex?e.isLeftCorner(t)?n.ARRAYFORMULA:n.ARRAY:e instanceof a.FormulaCellVertex||e instanceof a.ParsingErrorVertex?n.FORMULA:e instanceof a.ValueCellVertex?n.VALUE:n.EMPTY,t.CellValueNoNumber=l,function(e){e.EMPTY="EMPTY",e.NUMBER="NUMBER",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.ERROR="ERROR"}(l||(t.CellValueNoNumber=l={})),t.CellValueJustNumber=h,function(e){e.NUMBER="NUMBER"}(h||(t.CellValueJustNumber=h={}));const d=Object.assign(Object.assign({},l),h);t.CellValueType=d;const p=Object.assign(Object.assign({},l),i.NumberType);t.CellValueDetailedType=p;t.CellValueTypeOrd=e=>{switch(e){case d.EMPTY:return 0;case d.NUMBER:return 1;case d.STRING:return 2;case d.BOOLEAN:return 3;case d.ERROR:return 4}throw new Error("Cell value not computed")};const c=e=>{if(e===i.EmptyValue)return d.EMPTY;if(e instanceof m||e instanceof u.SimpleRangeValue)return d.ERROR;if("string"==typeof e)return d.STRING;if((0,i.isExtendedNumber)(e))return d.NUMBER;if("boolean"==typeof e)return d.BOOLEAN;throw new Error("Cell value not computed")};t.getCellValueType=c;t.getCellValueDetailedType=e=>(0,i.isExtendedNumber)(e)?(0,i.getTypeOfExtendedNumber)(e):c(e);t.getCellValueFormat=e=>(0,i.isExtendedNumber)(e)?(0,i.getFormatOfExtendedNumber)(e):void 0;class m{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(){return new m(s.ERROR,o.ErrorMessage.ParseError)}attachRootVertex(e){return void 0===this.root?new m(this.type,this.message,e):this}}t.CellError=m;t.simpleRowAddress=(e,t)=>({sheet:e,row:t});t.invalidSimpleRowAddress=e=>e.row<0;t.simpleColumnAddress=(e,t)=>({sheet:e,col:t});t.invalidSimpleColumnAddress=e=>e.col<0;const g=(e,t,r)=>({sheet:e,col:t,row:r});t.simpleCellAddress=g;t.invalidSimpleCellAddress=e=>e.col<0||e.row<0;t.movedSimpleCellAddress=(e,t,r,s)=>g(t,e.col+r,e.row+s);t.addressKey=e=>`${e.sheet},${e.row},${e.col}`;t.absoluteSheetReference=(e,t)=>{var r;return null!==(r=e.sheet)&&void 0!==r?r:t.sheet};t.equalSimpleCellAddress=(e,t)=>e.sheet===t.sheet&&e.col===t.col&&e.row===t.row},function(e,t,r){"use strict";t.__esModule=!0,t.ValueCellVertex=t.SparseStrategy=t.SheetMapping=t.RangeVertex=t.RangeMapping=t.ParsingErrorVertex=t.Graph=t.FormulaCellVertex=t.EmptyCellVertex=t.DependencyGraph=t.DenseStrategy=t.ArrayVertex=t.ArrayMapping=t.AddressMapping=void 0;var s=r(3);t.DependencyGraph=s.DependencyGraph;var n=r(37);t.AddressMapping=n.AddressMapping;var a=r(43);t.Graph=a.Graph;var o=r(44);t.RangeMapping=o.RangeMapping;var i=r(45);t.SheetMapping=i.SheetMapping;var u=r(38);t.ArrayMapping=u.ArrayMapping;var l=r(40);t.FormulaCellVertex=l.FormulaCellVertex,t.ArrayVertex=l.ArrayVertex;var h=r(48);t.EmptyCellVertex=h.EmptyCellVertex;var d=r(49);t.ValueCellVertex=d.ValueCellVertex;var p=r(50);t.ParsingErrorVertex=p.ParsingErrorVertex;var c=r(42);t.RangeVertex=c.RangeVertex;var m=r(51);t.SparseStrategy=m.SparseStrategy;var g=r(52);t.DenseStrategy=g.DenseStrategy},function(e,t,r){"use strict";t.__esModule=!0,t.DependencyGraph=void 0;var s=r(4),n=r(23),a=r(1),o=r(24),i=r(18),u=r(32),l=r(25),h=r(6),d=r(22),p=r(33),c=r(2),m=r(37),g=r(38),E=r(39),T=r(40),y=r(43),A=r(44),f=r(45);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class R{constructor(e,t,r,i,u,l,d,p){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=i,this.stats=u,this.lazilyTransformingAstService=l,this.functionRegistry=d,this.namedExpressions=p,this.changes=o.ContentChanges.empty(),this.dependencyQueryAddresses=e=>{if(e instanceof c.RangeVertex)return this.rangeDependencyQuery(e).map(([e,t])=>e);{const t=this.formulaDependencyQuery(e);if(void 0!==t){const[e,r]=t;return r.map(t=>t instanceof h.NamedExpressionDependency?this.namedExpressions.namedExpressionOrPlaceholder(t.name,e.sheet).address:(0,a.isSimpleCellAddress)(t)?t:(0,s.simpleCellRange)(t.start,t.end))}return[]}},this.dependencyQueryVertices=e=>{if(e instanceof c.RangeVertex)return this.rangeDependencyQuery(e).map(([e,t])=>t);{const t=this.formulaDependencyQuery(e);if(void 0!==t){const[e,r]=t;return r.map(t=>{if(t instanceof s.AbsoluteCellRange)return this.rangeMapping.fetchRange(t.start,t.end);if(t instanceof h.NamedExpressionDependency){const r=this.namedExpressions.namedExpressionOrPlaceholder(t.name,e.sheet);return this.addressMapping.fetchCell(r.address)}return this.addressMapping.fetchCell(t)})}return[]}},this.rangeDependencyQuery=e=>{const t=[],{smallerRangeVertex:r,restRange:n}=this.rangeMapping.findSmallerRange(e.range);let a;void 0!==r&&this.graph.adjacentNodes(r).has(e)?(a=n,t.push([new s.AbsoluteCellRange(r.start,r.end),r])):a=e.range;for(const e of a.addresses(this)){const r=this.addressMapping.getCell(e);r instanceof c.EmptyCellVertex&&(r.address=e),void 0!==r&&t.push([e,r])}return t},this.formulaDependencyQuery=e=>{let t,r;if(!(e instanceof T.FormulaVertex))return;r=e.getAddress(this.lazilyTransformingAstService),t=e.getFormula(this.lazilyTransformingAstService);const s=(0,h.collectDependencies)(t,this.functionRegistry);return[r,(0,n.absolutizeDependencies)(s,r)]},this.graph=new y.Graph(this.dependencyQueryVertices)}static buildEmpty(e,t,r,s,n){return new R(new m.AddressMapping(t.chooseAddressMappingPolicy),new A.RangeMapping,new f.SheetMapping(t.translationPackage),new g.ArrayMapping,n,e,r,s)}setFormulaToCell(e,t,r,s,n,a){const o=T.FormulaVertex.fromAst(t,e,s,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(o),this.processCellDependencies(r,o),this.graph.markNodeAsSpecialRecentlyChanged(o),n&&this.markAsVolatile(o),a&&this.markAsDependentOnStructureChange(o),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsSpecialRecentlyChanged(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof c.ArrayVertex&&this.arrayMapping.removeArray(r.getRange()),r instanceof c.ValueCellVertex){r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsSpecialRecentlyChanged(r))}else{const s=new c.ValueCellVertex(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,s),this.addressMapping.setCell(e,s),this.graph.markNodeAsSpecialRecentlyChanged(s)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(void 0===t)return o.ContentChanges.empty();if(this.graph.adjacentNodes(t).size>0){const r=new c.EmptyCellVertex(e);this.exchangeGraphNode(t,r),0===this.graph.adjacentNodesCount(r)?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsSpecialRecentlyChanged(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}ensureThatVertexIsNonArrayCellVertex(e){if(e instanceof c.ArrayVertex)throw new Error("Illegal operation")}clearRecentlyChangedVertices(){this.graph.clearSpecialNodesRecentlyChanged()}verticesToRecompute(){return new Set([...this.graph.specialNodesRecentlyChanged,...this.volatileVertices()])}processCellDependencies(e,t){e.forEach(e=>{if(e instanceof s.AbsoluteCellRange){const r=e;let s=this.getRange(r.start,r.end);void 0===s&&(s=new c.RangeVertex(r),this.rangeMapping.setRange(s)),this.graph.addNode(s),r.isFinite()||this.graph.markNodeAsInfiniteRange(s);const{smallerRangeVertex:n,restRange:a}=this.rangeMapping.findSmallerRange(r);if(void 0!==n){if(this.graph.addEdge(n,s),s.bruteForce){s.bruteForce=!1;for(const e of r.addresses(this))this.graph.removeEdge(this.fetchCell(e),s)}}else s.bruteForce=!0;const o=this.arrayMapping.getArray(a);if(void 0!==o)this.graph.addEdge(o,s);else for(const e of a.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(e),s);this.graph.addEdge(s,t),r.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(s)}else if(e instanceof h.NamedExpressionDependency){const r=t.getAddress(this.lazilyTransformingAstService).sheet,s=this.fetchNamedExpressionVertex(e.name,r);this.graph.addEdge(s,t)}else this.graph.addEdge(this.fetchCellOrCreateEmpty(e),t)})}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e),s=this.fetchCellOrCreateEmpty(t);this.addressMapping.removeCell(e),this.exchangeGraphNode(r,s)}correctInfiniteRangesDependency(e){let t=void 0;for(const r of this.graph.infiniteRanges){const s=r;s.range.addressInRange(e)&&(t=null!=t?t:this.fetchCellOrCreateEmpty(e),this.graph.addEdge(t,s))}}fetchCellOrCreateEmpty(e){let t=this.addressMapping.getCell(e);return void 0===t&&(t=new c.EmptyCellVertex(e),this.graph.addNode(t),this.addressMapping.setCell(e,t)),t}removeRows(e){this.stats.measure(p.StatType.ADJUSTING_GRAPH,()=>{for(const[t,r]of this.addressMapping.entriesFromRowsSpan(e)){for(const e of this.graph.adjacentNodes(r))this.graph.markNodeAsSpecialRecentlyChanged(e);if(r instanceof c.ArrayVertex){if(!r.isLeftCorner(t))continue;this.shrinkArrayToCorner(r),this.arrayMapping.removeArray(r.getRange())}this.removeVertex(r)}}),this.stats.measure(p.StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(e)});const t=this.stats.measure(p.StatType.ADJUSTING_RANGES,()=>{const t=this.truncateRanges(e,e=>e.row);return this.getArrayVerticesRelatedToRanges(t)});return this.stats.measure(p.StatType.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){const t=new Set;for(const[r,s]of this.addressMapping.sheetEntries(e)){if(s instanceof c.ArrayVertex){if(t.has(s))continue;t.add(s)}for(const e of this.graph.adjacentNodes(s))this.graph.markNodeAsSpecialRecentlyChanged(e);this.removeVertex(s),this.addressMapping.removeCell(r)}this.stats.measure(p.StatType.ADJUSTING_ARRAY_MAPPING,()=>{for(const e of t.values())this.arrayMapping.removeArray(e.getRange())}),this.stats.measure(p.StatType.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const e of t)this.removeVertex(e);this.stats.measure(p.StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(e)})}),this.addStructuralNodesToChangeSet()}clearSheet(e){const t=new Set;for(const[r,s]of this.addressMapping.sheetEntries(e))s instanceof c.ArrayVertex?t.add(s):this.setCellEmpty(r);for(const e of t.values())this.setArrayEmpty(e);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(p.StatType.ADJUSTING_GRAPH,()=>{for(const[t,r]of this.addressMapping.entriesFromColumnsSpan(e)){for(const e of this.graph.adjacentNodes(r))this.graph.markNodeAsSpecialRecentlyChanged(e);if(r instanceof c.ArrayVertex){if(!r.isLeftCorner(t))continue;this.shrinkArrayToCorner(r),this.arrayMapping.removeArray(r.getRange())}this.removeVertex(r)}}),this.stats.measure(p.StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(e)});const t=this.stats.measure(p.StatType.ADJUSTING_RANGES,()=>{const t=this.truncateRanges(e,e=>e.col);return this.getArrayVerticesRelatedToRanges(t)});return this.stats.measure(p.StatType.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(p.StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)});const t=this.stats.measure(p.StatType.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(t.verticesWithChangedSize)});this.stats.measure(p.StatType.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)});for(const t of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsSpecialRecentlyChanged(t);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(p.StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)});const t=this.stats.measure(p.StatType.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(t.verticesWithChangedSize)});this.stats.measure(p.StatType.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns));for(const t of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsSpecialRecentlyChanged(t);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}ensureNoArrayInRange(e){if(this.arrayMapping.isFormulaArrayInRange(e))throw Error("It is not possible to move / replace cells with array")}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(void 0===t)return!1;for(const r of t.addresses(this)){const t=this.addressMapping.getCell(r);if(void 0!==t&&!(t instanceof c.EmptyCellVertex)&&t!==e)return!1}return!0}moveCells(e,t,r,s){for(const n of e.addressesWithDirection(t,r,this)){const o=(0,a.simpleCellAddress)(s,n.col+t,n.row+r);let i=this.addressMapping.getCell(n);const u=this.addressMapping.getCell(o);if(this.addressMapping.removeCell(n),void 0!==i){this.graph.markNodeAsSpecialRecentlyChanged(i),this.addressMapping.setCell(o,i);let t=void 0;for(const r of this.graph.adjacentNodes(i))r instanceof c.RangeVertex&&!e.containsRange(r.range)&&(t=null!=t?t:this.fetchCellOrCreateEmpty(n),this.graph.addEdge(t,r),this.graph.removeEdge(i,r));t&&(this.graph.markNodeAsSpecialRecentlyChanged(t),this.addressMapping.setCell(n,t))}if(void 0!==u){void 0===i&&this.addressMapping.removeCell(o);for(const e of this.graph.adjacentNodes(u))i=null!=i?i:this.fetchCellOrCreateEmpty(o),this.graph.addEdge(i,e),this.graph.markNodeAsSpecialRecentlyChanged(i);this.removeVertex(u)}}for(const t of this.rangeMapping.rangeVerticesContainedInRange(e))for(const r of this.graph.adjacentNodes(t))if(r instanceof c.RangeVertex&&!e.containsRange(r.range)){this.graph.removeEdge(t,r);for(const e of t.range.addresses(this)){const t=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(t,r),this.addressMapping.setCell(e,t),this.graph.markNodeAsSpecialRecentlyChanged(t)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,s)}setArrayEmpty(e){const t=s.AbsoluteCellRange.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const e of t.addresses(this))this.addressMapping.removeCell(e);for(const t of r.values()){const r=(0,E.collectAddressesDependentToRange)(this.functionRegistry,t,e.getRange(),this.lazilyTransformingAstService,this);for(const e of r){const r=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(r,t)}r.length>0&&this.graph.markNodeAsSpecialRecentlyChanged(t)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNode(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNode(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.nodes)e instanceof c.ArrayVertex&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}existsVertex(e){return this.addressMapping.has(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof l.SimpleRangeValue?new a.CellError(a.ErrorType.VALUE,i.ErrorMessage.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}setArray(e,t){this.arrayMapping.setArray(e,t)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsSpecial(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.nodes.values())e instanceof c.FormulaCellVertex&&e.ensureRecentData(this.lazilyTransformingAstService)}volatileVertices(){return this.graph.specialNodes}getArrayVerticesRelatedToRanges(e){const t=e.map(e=>this.graph.hasNode(e)?Array.from(this.graph.adjacentNodes(e)).filter(e=>e instanceof c.ArrayVertex):[]);return new Set(...t)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const e=this.getScalarValue(t);e!==u.EmptyValue&&(yield[(0,u.getRawValue)(e),t])}}*entriesFromRange(e){for(const t of e.addresses(this))yield[t,this.getCell(t)]}exchangeGraphNode(e,t){this.graph.addNode(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach(e=>{this.graph.hasNode(e)&&this.graph.addEdge(t,e)})}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNode(t)}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const e=this.getScalarValue(r);t.push(e)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;r=t instanceof T.FormulaVertex?this.formulaDirectDependenciesToArray(t,e):this.rangeDirectDependenciesToArray(t,e);let s=!1;for(const[n,a]of r)e.isLeftCorner(n)&&(s=!0),this.graph.addEdge(a,t),this.graph.markNodeAsSpecialRecentlyChanged(a);s||this.graph.removeEdge(e,t)}this.graph.markNodeAsSpecialRecentlyChanged(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof c.ArrayVertex&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=o.ContentChanges.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach(e=>{const t=e;t instanceof c.RangeVertex?r.push((0,s.simpleCellRange)(t.start,t.end)):r.push(t.getAddress(this.lazilyTransformingAstService))}),r}correctInfiniteRangesDependenciesByRangeVertex(e){for(const t of this.graph.infiniteRanges){const r=t,s=e.range.intersectionWith(r.range);if(void 0!==s)for(const e of s.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(e),t)}}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const t=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new a.CellError(a.ErrorType.REF),r,t):(this.addressMapping.removeCell(r),this.changes.addChange(u.EmptyValue,r,t)):this.changes.addChange(u.EmptyValue,r,t)}}*formulaDirectDependenciesToArray(e,t){var r;const[,n]=null!==(r=this.formulaDependencyQuery(e))&&void 0!==r?r:[];if(void 0!==n)for(const e of n)if(!(e instanceof h.NamedExpressionDependency||e instanceof s.AbsoluteCellRange)&&t.getRange().addressInRange(e)){const t=this.fetchCellOrCreateEmpty(e);yield[e,t]}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const e of r.addresses(this))if(t.getRange().addressInRange(e)){const t=this.fetchCellOrCreateEmpty(e);yield[e,t]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const e of t)(e instanceof T.FormulaVertex||e instanceof c.RangeVertex)&&(yield e)}addStructuralNodesToChangeSet(){for(const e of this.graph.specialNodesStructuralChanges)this.graph.markNodeAsSpecialRecentlyChanged(e)}fixRangesWhenAddingRows(e,t,r){const n=Array.from(this.rangeMapping.rangesInSheet(e));for(const e of n)if(e.range.includesRow(t+r))if(e.bruteForce){const s=e.range.rangeWithSameWidth(t,r);for(const t of s.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(t),e)}else{let t=e,r=this.rangeMapping.findSmallerRange(t.range);if(void 0!==r.smallerRangeVertex)continue;for(;void 0===r.smallerRangeVertex;){const e=new c.RangeVertex(s.AbsoluteCellRange.spanFrom(t.range.start,t.range.width(),t.range.height()-1));this.rangeMapping.setRange(e),this.graph.addNode(e);const n=new s.AbsoluteCellRange((0,a.simpleCellAddress)(t.range.start.sheet,t.range.start.col,t.range.end.row),t.range.end);this.addAllFromRange(n,t),this.graph.addEdge(e,t),t=e,r=this.rangeMapping.findSmallerRange(t.range)}this.graph.addEdge(r.smallerRangeVertex,t),this.addAllFromRange(r.restRange,t),this.graph.removeEdge(r.smallerRangeVertex,e)}}addAllFromRange(e,t){for(const r of e.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(r),t)}fixRangesWhenAddingColumns(e,t,r){for(const n of this.rangeMapping.rangesInSheet(e))if(n.range.includesColumn(t+r)){let o;o=n.bruteForce?n.range.rangeWithSameHeight(t,r):s.AbsoluteCellRange.spanFrom((0,a.simpleCellAddress)(e,t,n.range.end.row),r,1);for(const e of o.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(e),n)}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=s.AbsoluteCellRange.spanFrom(t,e.width,e.height),n=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof c.ArrayVertex&&this.setArray(r,e),this.exchangeOrAddGraphNode(n,e),this.addressMapping.setCell(t,e),e instanceof c.ArrayVertex){if(!this.isThereSpaceForArray(e))return;for(const t of r.addresses(this)){if(e.isLeftCorner(t))continue;const r=this.getCell(t);this.exchangeOrAddGraphNode(r,e)}}for(const t of r.addresses(this))this.addressMapping.setCell(t,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof c.ArrayVertex))return;const r=s.AbsoluteCellRange.spanFromOrUndef(t,e.width,e.height);if(void 0!==r&&(this.setArray(r,e),this.isThereSpaceForArray(e)))for(const t of r.addresses(this))this.addressMapping.setCell(t,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:s,verticesWithChangedSize:n}=this.rangeMapping.truncateRanges(e,t);for(const[e,t]of s)this.mergeRangeVertices(e,t);for(const e of r)this.removeVertexAndCleanupDependencies(e);return n}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,s]of this.arrayMapping.arraysInRows(d.RowsSpan.fromRowStartAndEnd(e,t-1,t-1))){const n=s.getRange();for(let o=n.start.col;o<=n.end.col;++o)for(let i=t;i<=n.end.row;++i){const t=(0,a.simpleCellAddress)(e,o,i),n=(0,a.simpleCellAddress)(e,o,i+r),l=s.getArrayCellValue(t);this.addressMapping.moveCell(n,t),this.changes.addChange(u.EmptyValue,n,l)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,r]of this.arrayMapping.arraysInRows(d.RowsSpan.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(r))for(const e of r.getRange().addresses(this))this.addressMapping.setCell(e,r);else this.setNoSpaceIfArray(r)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,s]of this.arrayMapping.arraysInCols(d.ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1))){const n=s.getRange();for(let o=n.start.row;o<=n.end.row;++o)for(let i=t;i<=n.end.col;++i){const t=(0,a.simpleCellAddress)(e,i,o),n=(0,a.simpleCellAddress)(e,i+r,o),l=s.getArrayCellValue(t);this.addressMapping.moveCell(n,t),this.changes.addChange(u.EmptyValue,n,l)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,r]of this.arrayMapping.arraysInCols(d.ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(r))for(const e of r.getRange().addresses(this))this.addressMapping.setCell(e,r);else this.setNoSpaceIfArray(r)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof c.ArrayVertex?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof c.ArrayVertex&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof c.RangeVertex&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.softRemoveEdge(e,t),r.forEach(t=>{this.graph.hasNode(t)&&this.graph.addEdge(e,t)})}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const e=t.values().next().value;t.delete(e),this.graph.hasNode(e)&&0===this.graph.adjacentNodesCount(e)&&((e instanceof c.RangeVertex||e instanceof c.EmptyCellVertex)&&this.graph.removeNode(e).forEach(e=>t.add(e)),e instanceof c.RangeVertex?this.rangeMapping.removeRange(e):e instanceof c.EmptyCellVertex&&this.addressMapping.removeCell(e.address))}}}t.DependencyGraph=R},function(e,t,r){"use strict";t.__esModule=!0,t.WRONG_RANGE_SIZE=t.AbsoluteRowRange=t.AbsoluteColumnRange=t.AbsoluteCellRange=void 0,t.isSimpleCellRange=function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("start"in e&&(0,s.isSimpleCellAddress)(e.start)&&"end"in e&&(0,s.isSimpleCellAddress)(e.end))},t.simpleCellRange=void 0;var s=r(1),n=r(5),a=r(6),o=r(22);t.WRONG_RANGE_SIZE="AbsoluteCellRange: Wrong range size";t.simpleCellRange=(e,t)=>({start:e,end:t});class i{constructor(e,t){if(e.sheet!==t.sheet)throw new n.SheetsNotEqual(e.sheet,t.sheet);this.start=(0,s.simpleCellAddress)(e.sheet,e.col,e.row),this.end=(0,s.simpleCellAddress)(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromAst(e,t){return e.type===a.AstNodeType.CELL_RANGE?i.fromCellRange(e,t):e.type===a.AstNodeType.COLUMN_RANGE?u.fromColumnRange(e,t):l.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return i.fromAst(e,t)}catch(e){return}}static fromCellRange(e,t){return new i(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const s=i.spanFromOrUndef(e,t,r);if(void 0===s)throw new Error("AbsoluteCellRange: Wrong range size");return s}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r)){if(0!==e.col)return;return new l(e.sheet,e.row,e.row+r-1)}if(!Number.isFinite(r)&&Number.isFinite(t)){if(0!==e.row)return;return new u(e.sheet,e.col,e.col+t-1)}if(Number.isFinite(r)&&Number.isFinite(t))return new i(e,(0,s.simpleCellAddress)(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,n,a){return new i((0,s.simpleCellAddress)(e,t,r),(0,s.simpleCellAddress)(e,n,a))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return this.start.sheet==e.start.sheet&&(!(this.end.row<e.start.row||this.start.row>e.end.row)&&!(this.end.col<e.start.col||this.start.col>e.end.col))}addressInRange(e){return this.sheet===e.sheet&&(this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col)}columnInRange(e){return this.sheet===e.sheet&&(this.start.col<=e.col&&this.end.col>=e.col)}rowInRange(e){return this.sheet===e.sheet&&(this.start.row<=e.row&&this.end.row>=e.row)}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),n=Math.max(this.start.col,e.start.col),a=Math.min(this.end.col,e.end.col);return t>r||n>a?void 0:new i((0,s.simpleCellAddress)(this.sheet,n,t),(0,s.simpleCellAddress)(this.sheet,a,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return i.spanFrom((0,s.simpleCellAddress)(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof o.RowsSpan?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return i.spanFrom((0,s.simpleCellAddress)(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return i.spanFrom((0,s.simpleCellAddress)(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const n=(0,s.simpleCellAddress)(this.sheet,this.start.col+r,this.start.row+t);e[t].push(n)}}return e}withStart(e){return new i(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return(0,s.equalSimpleCellAddress)(this.start,e.start)&&(0,s.equalSimpleCellAddress)(this.end,e.end)}addressesArrayMap(e,t){const r=[];let n=this.start.row;for(;n<=this.effectiveEndRow(e);){let a=this.start.col;const o=[];for(;a<=this.effectiveEndColumn(e);)o.push(t((0,s.simpleCellAddress)(this.start.sheet,a,n))),a++;r.push(o),n++}return r}addresses(e){const t=[];let r=this.start.row;const n=this.effectiveEndRow(e),a=this.effectiveEndColumn(e);for(;r<=n;){let e=this.start.col;for(;e<=a;)t.push((0,s.simpleCellAddress)(this.start.sheet,e,r)),e++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let e=this.effectiveEndRow(r);for(;e>=this.start.row;){let t=this.effectiveEndColumn(r);for(;t>=this.start.col;)yield(0,s.simpleCellAddress)(this.start.sheet,t,e),t-=1;e-=1}}else{let e=this.start.row;for(;e<=this.effectiveEndRow(r);){let t=this.effectiveEndColumn(r);for(;t>=this.start.col;)yield(0,s.simpleCellAddress)(this.start.sheet,t,e),t-=1;e+=1}}else if(t>0){let e=this.effectiveEndRow(r);for(;e>=this.start.row;){let t=this.start.col;for(;t<=this.effectiveEndColumn(r);)yield(0,s.simpleCellAddress)(this.start.sheet,t,e),t+=1;e-=1}}else{let e=this.start.row;for(;e<=this.effectiveEndRow(r);){let t=this.start.col;for(;t<=this.effectiveEndColumn(r);)yield(0,s.simpleCellAddress)(this.start.sheet,t,e),t+=1;e+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return(0,s.simpleCellAddress)(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}t.AbsoluteCellRange=i;class u extends i{constructor(e,t,r){super((0,s.simpleCellAddress)(e,t,0),(0,s.simpleCellAddress)(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),s=e.end.toSimpleColumnAddress(t);if(r.sheet!==s.sheet)throw new n.SheetsNotEqual(r.sheet,s.sheet);return new u(r.sheet,r.col,s.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new u(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new u(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}t.AbsoluteColumnRange=u;class l extends i{constructor(e,t,r){super((0,s.simpleCellAddress)(e,0,t),(0,s.simpleCellAddress)(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),s=e.end.toSimpleRowAddress(t);if(r.sheet!==s.sheet)throw new n.SheetsNotEqual(r.sheet,s.sheet);return new l(r.sheet,r.row,s.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new l(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new l(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}t.AbsoluteRowRange=l},function(e,t,r){"use strict";t.__esModule=!0,t.UnableToParseError=t.TargetLocationHasArrayError=t.SourceLocationHasArrayError=t.SheetsNotEqual=t.SheetSizeLimitExceededError=t.SheetNameAlreadyTakenError=t.ProtectedFunctionTranslationError=t.ProtectedFunctionError=t.NothingToPasteError=t.NotAFormulaError=t.NoSheetWithNameError=t.NoSheetWithIdError=t.NoRelativeAddressesAllowedError=t.NoOperationToUndoError=t.NoOperationToRedoError=t.NamedExpressionNameIsInvalidError=t.NamedExpressionNameIsAlreadyTakenError=t.NamedExpressionDoesNotExistError=t.MissingTranslationError=t.LanguageNotRegisteredError=t.LanguageAlreadyRegisteredError=t.InvalidArgumentsError=t.InvalidAddressError=t.FunctionPluginValidationError=t.ExpectedValueOfTypeError=t.ExpectedOneOfValuesError=t.EvaluationSuspendedError=t.ConfigValueTooSmallError=t.ConfigValueTooBigError=t.ConfigValueEmpty=t.AliasAlreadyExisting=void 0;
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class s extends Error{constructor(e){super("There's no sheet with id = "+e)}}t.NoSheetWithIdError=s;class n extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}t.NoSheetWithNameError=n;class a extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}t.SheetNameAlreadyTakenError=a;class o extends Error{constructor(){super("Sheet size limit exceeded")}}t.SheetSizeLimitExceededError=o;class i extends Error{constructor(){super("This is not a formula")}}t.NotAFormulaError=i;class u extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}t.InvalidAddressError=u;class l extends Error{constructor(e){super("Invalid arguments, expected "+e)}}t.InvalidArgumentsError=l;class h extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}t.SheetsNotEqual=h;class d extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}t.NamedExpressionNameIsAlreadyTakenError=d;class p extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}t.NamedExpressionNameIsInvalidError=p;class c extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}t.NamedExpressionDoesNotExistError=c;class m extends Error{constructor(){super("There is no operation to undo")}}t.NoOperationToUndoError=m;class g extends Error{constructor(){super("There is no operation to redo")}}t.NoOperationToRedoError=g;class E extends Error{constructor(){super("There is nothing to paste")}}function T(e,t){switch(typeof t){case"function":case"symbol":return t.toString();case"bigint":return"BigInt("+t.toString()+")";default:return t instanceof RegExp?"RegExp("+t.toString()+")":t}}t.NothingToPasteError=E;class y extends Error{constructor(e){super("Unable to parse value: "+JSON.stringify(e,T,4))}}t.UnableToParseError=y;class A extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}t.ExpectedValueOfTypeError=A;class f extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}t.ConfigValueEmpty=f;class R extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}t.ConfigValueTooSmallError=R;class N extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}t.ConfigValueTooBigError=N;class C extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}t.ExpectedOneOfValuesError=C;class S extends Error{constructor(){super("Computations are suspended")}}t.EvaluationSuspendedError=S;class M extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}t.MissingTranslationError=M;class w extends Error{constructor(e){super("Cannot register translation for function with id: "+e)}}t.ProtectedFunctionTranslationError=w;class v extends Error{constructor(){super("Language not registered.")}}t.LanguageNotRegisteredError=v;class O extends Error{constructor(){super("Language already registered.")}}t.LanguageAlreadyRegisteredError=O;class I extends Error{static functionNotDeclaredInPlugin(e,t){return new I(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new I(`Function method ${e} not found in plugin ${t}`)}}t.FunctionPluginValidationError=I;class b extends Error{static cannotRegisterFunctionWithId(e){return new b("Cannot register function with id "+e)}static cannotUnregisterFunctionWithId(e){return new b("Cannot unregister function with id "+e)}static cannotUnregisterProtectedPlugin(){return new b("Cannot unregister protected plugin")}}t.ProtectedFunctionError=b;class F extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}t.SourceLocationHasArrayError=F;class V extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}t.TargetLocationHasArrayError=V;class U extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}t.NoRelativeAddressesAllowedError=U;class x extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}t.AliasAlreadyExisting=x},function(e,t,r){"use strict";t.__esModule=!0,t.simpleCellRangeToString=t.simpleCellRangeFromString=t.simpleCellAddressToString=t.simpleCellAddressFromString=t.collectDependencies=t.cellAddressFromString=t.buildProcedureAst=t.buildParsingErrorAst=t.buildLexerConfig=t.buildCellRangeAst=t.buildCellErrorAst=t.Unparser=t.RowRangeDependency=t.ParsingErrorType=t.ParserWithCaching=t.NamedExpressionDependency=t.FormulaLexer=t.ColumnRangeDependency=t.CellRangeDependency=t.CellAddress=t.AstNodeType=t.AddressDependency=void 0;var s=r(7);t.cellAddressFromString=s.cellAddressFromString,t.simpleCellAddressFromString=s.simpleCellAddressFromString,t.simpleCellAddressToString=s.simpleCellAddressToString,t.simpleCellRangeFromString=s.simpleCellRangeFromString,t.simpleCellRangeToString=s.simpleCellRangeToString;var n=r(8);t.CellAddress=n.CellAddress;var a=r(13);t.ParserWithCaching=a.ParserWithCaching;var o=r(20);t.collectDependencies=o.collectDependencies;var i=r(11);t.buildLexerConfig=i.buildLexerConfig;var u=r(17);t.FormulaLexer=u.FormulaLexer;var l=r(14);t.AstNodeType=l.AstNodeType,t.ParsingErrorType=l.ParsingErrorType,t.buildProcedureAst=l.buildProcedureAst,t.buildCellRangeAst=l.buildCellRangeAst,t.buildParsingErrorAst=l.buildParsingErrorAst,t.buildCellErrorAst=l.buildCellErrorAst;var h=r(19);t.Unparser=h.Unparser;var d=r(21);t.AddressDependency=d.AddressDependency,t.CellRangeDependency=d.CellRangeDependency,t.ColumnRangeDependency=d.ColumnRangeDependency,t.RowRangeDependency=d.RowRangeDependency,t.NamedExpressionDependency=d.NamedExpressionDependency},function(e,t,r){"use strict";t.__esModule=!0,t.columnAddressFromString=t.cellAddressFromString=void 0,t.columnIndexToLabel=E,t.rowAddressFromString=void 0,t.sheetIndexToString=T,t.simpleCellRangeToString=t.simpleCellRangeFromString=t.simpleCellAddressToString=t.simpleCellAddressFromString=void 0;var s=r(4),n=r(1),a=r(8),o=r(9),i=r(11),u=r(10);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const l=new RegExp(`^(${i.sheetNameRegexp})?(\\${i.ABSOLUTE_OPERATOR}?)([A-Za-z]+)(\\${i.ABSOLUTE_OPERATOR}?)([0-9]+)$`),h=new RegExp(`^(${i.sheetNameRegexp})?(\\${i.ABSOLUTE_OPERATOR}?)([A-Za-z]+)$`),d=new RegExp(`^(${i.sheetNameRegexp})?(\\${i.ABSOLUTE_OPERATOR}?)([0-9]+)$`),p=new RegExp(`^${i.simpleSheetName}$`);t.cellAddressFromString=(e,t,r)=>{const s=l.exec(t),n=g(s[6]);let o=y(s,e);if(void 0===o)return;null===o&&(o=void 0);const u=Number(s[8])-1;return s[5]===i.ABSOLUTE_OPERATOR&&s[7]===i.ABSOLUTE_OPERATOR?a.CellAddress.absolute(n,u,o):s[5]===i.ABSOLUTE_OPERATOR?a.CellAddress.absoluteCol(n,u-r.row,o):s[7]===i.ABSOLUTE_OPERATOR?a.CellAddress.absoluteRow(n-r.col,u,o):a.CellAddress.relative(u-r.row,n-r.col,o)};t.columnAddressFromString=(e,t,r)=>{const s=h.exec(t);let n=y(s,e);if(void 0===n)return;null===n&&(n=void 0);const a=g(s[6]);return s[5]===i.ABSOLUTE_OPERATOR?o.ColumnAddress.absolute(a,n):o.ColumnAddress.relative(a-r.col,n)};t.rowAddressFromString=(e,t,r)=>{const s=d.exec(t);let n=y(s,e);if(void 0===n)return;null===n&&(n=void 0);const a=Number(s[6])-1;return s[5]===i.ABSOLUTE_OPERATOR?u.RowAddress.absolute(a,n):u.RowAddress.relative(a-r.row,n)};const c=(e,t,r)=>{const s=l.exec(t),a=g(s[6]);let o=y(s,e);if(void 0===o)return;null===o&&(o=r);const i=Number(s[8])-1;return(0,n.simpleCellAddress)(o,a,i)};t.simpleCellAddressFromString=c;t.simpleCellRangeFromString=(e,t,r)=>{const n=t.split(i.RANGE_OPERATOR);if(2!==n.length)return;const[a,o]=n,u=c(e,a,r);if(void 0===u)return;const l=c(e,o,u.sheet);return void 0!==l&&u.sheet===l.sheet?(0,s.simpleCellRange)(u,l):void 0};const m=(e,t,r)=>{const s=E(t.col),n=T(t.sheet,e);if(void 0!==n)return r!==t.sheet?`${n}!${s}${t.row+1}`:`${s}${t.row+1}`};t.simpleCellAddressToString=m;function g(e){return 1===e.length?e.toUpperCase().charCodeAt(0)-65:e.split("").reduce((e,t)=>26*e+(t.toUpperCase().charCodeAt(0)-64),0)-1}function E(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}function T(e,t){let r=t(e);if(void 0!==r)return p.test(r)?r:(r=r.replace(/'/g,"''"),`'${r}'`)}function y(e,t){var r;let s=null!==(r=e[3])&&void 0!==r?r:e[2];return s?(s=s.replace(/''/g,"'"),t(s)):null}t.simpleCellRangeToString=(e,t,r)=>{const s=m(e,t.start,r),n=m(e,t.end,t.start.sheet);return void 0===s||void 0===n?void 0:`${s}${i.RANGE_OPERATOR}${n}`}},function(e,t,r){"use strict";t.__esModule=!0,t.CellReferenceType=t.CellAddress=void 0;var s,n=r(1),a=r(7),o=r(9),i=r(10);t.CellReferenceType=s,function(e){e.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",e.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",e.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",e.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"}(s||(t.CellReferenceType=s={}));class u{constructor(e,t,r,s){this.col=e,this.row=t,this.type=r,this.sheet=s}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?u.absolute.bind(this):e.isColumnAbsolute()?u.absoluteCol.bind(this):t.isRowAbsolute()?u.absoluteRow.bind(this):(e,t,r)=>u.relative(t,e,r))(e.col,t.row,r)}static relative(e,t,r){return new u(t,e,s.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new u(e,t,s.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new u(e,t,s.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new u(e,t,s.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=(0,n.absoluteSheetReference)(this,e);return this.type===s.CELL_REFERENCE_ABSOLUTE?(0,n.simpleCellAddress)(t,this.col,this.row):this.type===s.CELL_REFERENCE_ABSOLUTE_ROW?(0,n.simpleCellAddress)(t,e.col+this.col,this.row):this.type===s.CELL_REFERENCE_ABSOLUTE_COL?(0,n.simpleCellAddress)(t,this.col,e.row+this.row):(0,n.simpleCellAddress)(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?o.ReferenceType.RELATIVE:o.ReferenceType.ABSOLUTE;return new o.ColumnAddress(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?o.ReferenceType.RELATIVE:o.ReferenceType.ABSOLUTE;return new i.RowAddress(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=(0,n.absoluteSheetReference)(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),(0,n.simpleColumnAddress)(t,r)}toSimpleRowAddress(e){const t=(0,n.absoluteSheetReference)(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),(0,n.simpleRowAddress)(t,r)}isRowAbsolute(){return this.type===s.CELL_REFERENCE_ABSOLUTE||this.type===s.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===s.CELL_REFERENCE_ABSOLUTE||this.type===s.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===s.CELL_REFERENCE_RELATIVE||this.type===s.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===s.CELL_REFERENCE_RELATIVE||this.type===s.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===s.CELL_REFERENCE_ABSOLUTE&&void 0!==this.sheet}shiftedByRows(e){return new u(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new u(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const s=void 0===this.sheet?void 0:e;return new u(this.col+t,this.row+r,this.type,s)}withSheet(e){return new u(this.col,this.row,this.type,e)}isInvalid(e){return(0,n.invalidSimpleCellAddress)(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,s=this.isRowAbsolute()?this.row:this.row+t;return new u(r,s,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,s=this.isRowRelative()?this.row:this.row+t;return new u(r,s,this.type,this.sheet)}hash(e){const t=e&&void 0!==this.sheet?"#"+this.sheet:"";switch(this.type){case s.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case s.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case s.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case s.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if((0,n.invalidSimpleCellAddress)(t))return;const r=(0,a.columnIndexToLabel)(t.col),o=this.type===s.CELL_REFERENCE_ABSOLUTE||this.type===s.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===s.CELL_REFERENCE_ABSOLUTE||this.type===s.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${o}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}t.CellAddress=u},function(e,t,r){"use strict";t.__esModule=!0,t.ReferenceType=t.ColumnAddress=void 0;var s,n=r(1),a=r(7);t.ReferenceType=s,function(e){e.RELATIVE="RELATIVE",e.ABSOLUTE="ABSOLUTE"}(s||(t.ReferenceType=s={}));class o{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new o(s.ABSOLUTE,e,t)}static relative(e,t){return new o(s.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===s.ABSOLUTE}isColumnRelative(){return this.type===s.RELATIVE}isAbsolute(){return this.type===s.ABSOLUTE&&void 0!==this.sheet}moved(e,t,r){const s=void 0===this.sheet?void 0:e;return new o(this.type,this.col+t,s)}shiftedByColumns(e){return new o(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=(0,n.absoluteSheetReference)(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),(0,n.simpleColumnAddress)(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new o(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new o(this.type,r,this.sheet)}withSheet(e){return new o(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&void 0!==this.sheet?"#"+this.sheet:"";switch(this.type){case s.RELATIVE:return`${t}#COLR${this.col}`;case s.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if((0,n.invalidSimpleColumnAddress)(t))return;const r=(0,a.columnIndexToLabel)(t.col);return`${this.type===s.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}t.ColumnAddress=o},function(e,t,r){"use strict";t.__esModule=!0,t.RowAddress=void 0;var s=r(1),n=r(9);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new a(n.ReferenceType.ABSOLUTE,e,t)}static relative(e,t){return new a(n.ReferenceType.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===n.ReferenceType.ABSOLUTE}isRowRelative(){return this.type===n.ReferenceType.RELATIVE}isAbsolute(){return this.type===n.ReferenceType.ABSOLUTE&&void 0!==this.sheet}moved(e,t,r){const s=void 0===this.sheet?void 0:e;return new a(this.type,this.row+r,s)}shiftedByRows(e){return new a(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=(0,s.absoluteSheetReference)(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),(0,s.simpleRowAddress)(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new a(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new a(this.type,r,this.sheet)}withSheet(e){return new a(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&void 0!==this.sheet?"#"+this.sheet:"";switch(this.type){case n.ReferenceType.RELATIVE:return`${t}#ROWR${this.row}`;case n.ReferenceType.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);if((0,s.invalidSimpleRowAddress)(t))return;return`${this.type===n.ReferenceType.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}t.RowAddress=a},function(e,t,r){"use strict";t.__esModule=!0,t.simpleSheetName=t.sheetNameRegexp=t.quotedSheetName=t.buildLexerConfig=t.TimesOp=t.StringLiteral=t.RowRange=t.RangeSeparator=t.RParen=t.RANGE_OPERATOR=t.ProcedureName=t.PowerOp=t.PlusOp=t.PercentOp=t.ODFF_WHITESPACE_REGEXP=t.NotEqualOp=t.NamedExpression=t.MultiplicationOp=t.MinusOp=t.LessThanOrEqualOp=t.LessThanOp=t.LParen=t.GreaterThanOrEqualOp=t.GreaterThanOp=t.ErrorLiteral=t.EqualsOp=t.DivOp=t.ConcatenateOp=t.ColumnRange=t.CellReference=t.BooleanOp=t.ArrayRParen=t.ArrayLParen=t.AdditionOp=t.ALL_WHITESPACE_REGEXP=t.ABSOLUTE_OPERATOR=void 0;var s=r(12);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.RANGE_OPERATOR=":";t.ABSOLUTE_OPERATOR="$";const n=/\s+/;t.ALL_WHITESPACE_REGEXP=n;const a=/[ \t\n\r]+/;t.ODFF_WHITESPACE_REGEXP=a;const o=(0,s.createToken)({name:"AdditionOp",pattern:s.Lexer.NA});t.AdditionOp=o;const i=(0,s.createToken)({name:"PlusOp",pattern:/\+/,categories:o});t.PlusOp=i;const u=(0,s.createToken)({name:"MinusOp",pattern:/-/,categories:o});t.MinusOp=u;const l=(0,s.createToken)({name:"MultiplicationOp",pattern:s.Lexer.NA});t.MultiplicationOp=l;const h=(0,s.createToken)({name:"TimesOp",pattern:/\*/,categories:l});t.TimesOp=h;const d=(0,s.createToken)({name:"DivOp",pattern:/\//,categories:l});t.DivOp=d;const p=(0,s.createToken)({name:"PowerOp",pattern:/\^/});t.PowerOp=p;const c=(0,s.createToken)({name:"PercentOp",pattern:/%/});t.PercentOp=c;const m=(0,s.createToken)({name:"BooleanOp",pattern:s.Lexer.NA});t.BooleanOp=m;const g=(0,s.createToken)({name:"EqualsOp",pattern:/=/,categories:m});t.EqualsOp=g;const E=(0,s.createToken)({name:"NotEqualOp",pattern:/<>/,categories:m});t.NotEqualOp=E;const T=(0,s.createToken)({name:"GreaterThanOp",pattern:/>/,categories:m});t.GreaterThanOp=T;const y=(0,s.createToken)({name:"LessThanOp",pattern:/</,categories:m});t.LessThanOp=y;const A=(0,s.createToken)({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:m});t.GreaterThanOrEqualOp=A;const f=(0,s.createToken)({name:"LessThanOrEqualOp",pattern:/<=/,categories:m});t.LessThanOrEqualOp=f;const R=(0,s.createToken)({name:"ConcatenateOp",pattern:/&/});t.ConcatenateOp=R;t.simpleSheetName="[A-Za-z0-9_À-ʯ]+";t.quotedSheetName="'(((?!').|'')*)'";const N="([A-Za-z0-9_À-ʯ]+|'(((?!').|'')*)')!";t.sheetNameRegexp=N;const C=(0,s.createToken)({name:"CellReference",pattern:new RegExp(`(${N})?\\$?[A-Za-z]+\\$?[0-9]+`)});t.CellReference=C;const S=(0,s.createToken)({name:"ColumnRange",pattern:new RegExp(`(${N})?\\$?[A-Za-z]+:(${N})?\\$?[A-Za-z]+`)});t.ColumnRange=S;const M=(0,s.createToken)({name:"RowRange",pattern:new RegExp(`(${N})?\\$?[0-9]+:(${N})?\\$?[0-9]+`)});t.RowRange=M;const w=(0,s.createToken)({name:"RangeSeparator",pattern:":"});t.RangeSeparator=w;const v=(0,s.createToken)({name:"LParen",pattern:/\(/});t.LParen=v;const O=(0,s.createToken)({name:"RParen",pattern:/\)/});t.RParen=O;const I=(0,s.createToken)({name:"ArrayLParen",pattern:/{/});t.ArrayLParen=I;const b=(0,s.createToken)({name:"ArrayRParen",pattern:/}/});t.ArrayRParen=b;const F=(0,s.createToken)({name:"ProcedureName",pattern:/([A-Za-z\u00C0-\u02AF][A-Za-z0-9\u00C0-\u02AF._]*)\(/});t.ProcedureName=F;const V=(0,s.createToken)({name:"NamedExpression",pattern:/[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF._]*/});t.NamedExpression=V;const U=(0,s.createToken)({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/});t.StringLiteral=U;const x=(0,s.createToken)({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/});t.ErrorLiteral=x;t.buildLexerConfig=e=>{const t=e.translationPackage.getFunctionTranslation("OFFSET"),r=e.errorMapping,N=e.translationPackage.buildFunctionMapping(),L="standard"===e.ignoreWhiteSpace?a:n,P=(0,s.createToken)({name:"WhiteSpace",pattern:L}),_=(0,s.createToken)({name:"ArrayRowSep",pattern:e.arrayRowSeparator}),B=(0,s.createToken)({name:"ArrayColSep",pattern:e.arrayColumnSeparator});let D,G;e.functionArgSeparator===e.arrayColumnSeparator?(D=B,G=[]):e.functionArgSeparator===e.arrayRowSeparator?(D=_,G=[]):(D=(0,s.createToken)({name:"ArgSeparator",pattern:e.functionArgSeparator}),G=[D]);const H=(0,s.createToken)({name:"NumberLiteral",pattern:new RegExp(`(([${e.decimalSeparator}]\\d+)|(\\d+([${e.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),W=(0,s.createToken)({name:"OffsetProcedureName",pattern:new RegExp(t,"i")});return{ArgSeparator:D,NumberLiteral:H,OffsetProcedureName:W,ArrayRowSeparator:_,ArrayColSeparator:B,WhiteSpace:P,allTokens:[P,i,u,h,d,p,g,E,c,A,f,T,y,v,O,I,b,W,F,w,...G,S,M,H,U,x,R,m,o,l,C,V,_,B],errorMapping:r,functionMapping:N,decimalSeparator:e.decimalSeparator,maxColumns:e.maxColumns,maxRows:e.maxRows}}},function(t,r){t.exports=e},function(e,t,r){"use strict";t.__esModule=!0,t.ParserWithCaching=void 0;var s=r(12),n=r(1),a=r(6),o=r(7),i=r(14),u=r(15),l=r(16),h=r(17),d=r(11),p=r(19);t.ParserWithCaching=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=(0,d.buildLexerConfig)(e),this.lexer=new h.FormulaLexer(this.lexerConfig),this.formulaParser=new h.FormulaParser(this.lexerConfig,this.sheetMapping),this.cache=new l.Cache(this.functionRegistry)}parse(e,t){const r=this.tokenizeFormula(e);if(r.errors.length>0){const e=r.errors.map(e=>({type:i.ParsingErrorType.LexingError,message:e.message}));return{ast:(0,a.buildParsingErrorAst)(),errors:e,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const s=this.computeHashFromTokens(r.tokens,t);let n=this.cache.get(s);if(void 0!==n)++this.statsCacheUsed;else{const e=this.bindWhitespacesToTokens(r.tokens),a=this.formulaParser.parseFromTokens(e,t);if(a.errors.length>0)return Object.assign(Object.assign({},a),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});n=this.cache.set(s,a.ast)}const{ast:o,hasVolatileFunction:u,hasStructuralChangeFunction:l,relativeDependencies:h}=n;return{ast:o,errors:[],hasVolatileFunction:u,hasStructuralChangeFunction:l,dependencies:h}}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(void 0===t)throw new Error("There is no AST with such key in the cache");{const{ast:e,hasVolatileFunction:r,hasStructuralChangeFunction:s,relativeDependencies:n}=t;return{ast:e,errors:[],hasVolatileFunction:r,hasStructuralChangeFunction:s,dependencies:n}}}computeHashFromTokens(e,t){var r;let n="",a=0;for(;a<e.length;){const i=e[a];if((0,s.tokenMatcher)(i,d.CellReference)){const e=(0,o.cellAddressFromString)(this.sheetMapping,i.image,t);n=void 0===e?n.concat(i.image):n.concat(e.hash(!0))}else if((0,s.tokenMatcher)(i,d.ProcedureName)){const e=i.image.toUpperCase().slice(0,-1),t=null!==(r=this.lexerConfig.functionMapping[e])&&void 0!==r?r:e;n=n.concat(t,"(")}else if((0,s.tokenMatcher)(i,d.ColumnRange)){const[e,r]=i.image.split(":"),s=(0,o.columnAddressFromString)(this.sheetMapping,e,t),a=(0,o.columnAddressFromString)(this.sheetMapping,r,t);n=void 0===s||void 0===a?n.concat("!REF"):n.concat(s.hash(!0),":",a.hash(!0))}else if((0,s.tokenMatcher)(i,d.RowRange)){const[e,r]=i.image.split(":"),s=(0,o.rowAddressFromString)(this.sheetMapping,e,t),a=(0,o.rowAddressFromString)(this.sheetMapping,r,t);n=void 0===s||void 0===a?n.concat("!REF"):n.concat(s.hash(!0),":",a.hash(!0))}else n=n.concat(i.image);a++}return n}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case a.AstNodeType.EMPTY:return e.leadingWhitespace||"";case a.AstNodeType.NUMBER:return(0,i.imageWithWhitespace)((0,p.formatNumber)(e.value,this.config.decimalSeparator),e.leadingWhitespace);case a.AstNodeType.STRING:return(0,i.imageWithWhitespace)('"'+e.value+'"',e.leadingWhitespace);case a.AstNodeType.NAMED_EXPRESSION:return(0,i.imageWithWhitespace)(e.expressionName,e.leadingWhitespace);case a.AstNodeType.FUNCTION_CALL:{const t=e.args.map(e=>this.computeHashOfAstNode(e)).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+(0,i.imageWithWhitespace)(")",e.internalWhitespace);return(0,i.imageWithWhitespace)(r,e.leadingWhitespace)}case a.AstNodeType.CELL_REFERENCE:return(0,i.imageWithWhitespace)(e.reference.hash(!0),e.leadingWhitespace);case a.AstNodeType.COLUMN_RANGE:case a.AstNodeType.ROW_RANGE:case a.AstNodeType.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==i.RangeSheetReferenceType.RELATIVE),r=e.end.hash(e.sheetReferenceType===i.RangeSheetReferenceType.BOTH_ABSOLUTE);return(0,i.imageWithWhitespace)(t+":"+r,e.leadingWhitespace)}case a.AstNodeType.MINUS_UNARY_OP:return(0,i.imageWithWhitespace)("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case a.AstNodeType.PLUS_UNARY_OP:return(0,i.imageWithWhitespace)("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case a.AstNodeType.PERCENT_OP:return this.computeHashOfAstNode(e.value)+(0,i.imageWithWhitespace)("%",e.leadingWhitespace);case a.AstNodeType.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:n.ErrorType.ERROR);return(0,i.imageWithWhitespace)(t,e.leadingWhitespace)}case a.AstNodeType.ERROR_WITH_RAW_INPUT:return(0,i.imageWithWhitespace)(e.rawInput,e.leadingWhitespace);case a.AstNodeType.ARRAY:{const t=e.args.map(e=>e.map(e=>this.computeHashOfAstNode(e)).join(",")).join(";");return(0,i.imageWithWhitespace)("{"+t+(0,i.imageWithWhitespace)("}",e.internalWhitespace),e.leadingWhitespace)}case a.AstNodeType.PARENTHESIS:{const t="("+this.computeHashOfAstNode(e.expression)+(0,i.imageWithWhitespace)(")",e.internalWhitespace);return(0,i.imageWithWhitespace)(t,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+(0,i.imageWithWhitespace)(u.binaryOpTokenMap[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];(0,s.tokenMatcher)(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let r=1;r<e.length;++r){const n=e[r];if((0,s.tokenMatcher)(n,this.lexerConfig.WhiteSpace))continue;const a=e[r-1];(0,s.tokenMatcher)(a,this.lexerConfig.WhiteSpace)&&(n.leadingWhitespace=a),t.push(n)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}},function(e,t,r){"use strict";t.__esModule=!0,t.buildTimesOpAst=t.buildStringAst=t.buildRowRangeAst=t.buildProcedureAst=t.buildPowerOpAst=t.buildPlusUnaryOpAst=t.buildPlusOpAst=t.buildPercentOpAst=t.buildParsingErrorAst=t.buildParenthesisAst=t.buildNumberAst=t.buildNotEqualOpAst=t.buildNamedExpressionAst=t.buildMinusUnaryOpAst=t.buildMinusOpAst=t.buildLessThanOrEqualOpAst=t.buildLessThanOpAst=t.buildGreaterThanOrEqualOpAst=t.buildGreaterThanOpAst=t.buildErrorWithRawInputAst=t.buildEqualsOpAst=t.buildEmptyArgAst=t.buildDivOpAst=t.buildConcatenateOpAst=t.buildColumnRangeAst=t.buildCellReferenceAst=t.buildCellRangeAst=t.buildCellErrorAst=t.buildArrayAst=t.RangeSheetReferenceType=t.ParsingErrorType=t.AstNodeType=void 0,t.imageWithWhitespace=function(e,t){return(null!=t?t:"")+e},t.parsingError=void 0;var s=r(1);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */var n,a,o;t.parsingError=(e,t)=>({type:e,message:t}),t.ParsingErrorType=n,function(e){e.LexingError="LexingError",e.ParserError="ParsingError",e.StaticOffsetError="StaticOffsetError",e.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",e.RangeOffsetNotAllowed="RangeOffsetNotAllowed"}(n||(t.ParsingErrorType=n={})),t.AstNodeType=a,function(e){e.EMPTY="EMPTY",e.NUMBER="NUMBER",e.STRING="STRING",e.MINUS_UNARY_OP="MINUS_UNARY_OP",e.PLUS_UNARY_OP="PLUS_UNARY_OP",e.PERCENT_OP="PERCENT_OP",e.CONCATENATE_OP="CONCATENATE_OP",e.EQUALS_OP="EQUALS_OP",e.NOT_EQUAL_OP="NOT_EQUAL_OP",e.GREATER_THAN_OP="GREATER_THAN_OP",e.LESS_THAN_OP="LESS_THAN_OP",e.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",e.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",e.PLUS_OP="PLUS_OP",e.MINUS_OP="MINUS_OP",e.TIMES_OP="TIMES_OP",e.DIV_OP="DIV_OP",e.POWER_OP="POWER_OP",e.FUNCTION_CALL="FUNCTION_CALL",e.NAMED_EXPRESSION="NAMED_EXPRESSION",e.PARENTHESIS="PARENTHESES",e.CELL_REFERENCE="CELL_REFERENCE",e.CELL_RANGE="CELL_RANGE",e.COLUMN_RANGE="COLUMN_RANGE",e.ROW_RANGE="ROW_RANGE",e.ERROR="ERROR",e.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",e.ARRAY="ARRAY"}(a||(t.AstNodeType=a={})),t.RangeSheetReferenceType=o,function(e){e[e.RELATIVE=0]="RELATIVE",e[e.START_ABSOLUTE=1]="START_ABSOLUTE",e[e.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"}(o||(t.RangeSheetReferenceType=o={}));t.buildEmptyArgAst=e=>({type:a.EMPTY,leadingWhitespace:null==e?void 0:e.image});t.buildNumberAst=(e,t)=>({type:a.NUMBER,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildStringAst=e=>{var t;return{type:a.STRING,value:e.image.slice(1,-1),leadingWhitespace:null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image}};t.buildCellReferenceAst=(e,t)=>({type:a.CELL_REFERENCE,reference:e,leadingWhitespace:null==t?void 0:t.image});t.buildCellRangeAst=(e,t,r,s)=>(i(e,t,r),{type:a.CELL_RANGE,start:e,end:t,sheetReferenceType:r,leadingWhitespace:s});t.buildColumnRangeAst=(e,t,r,s)=>(i(e,t,r),{type:a.COLUMN_RANGE,start:e,end:t,sheetReferenceType:r,leadingWhitespace:null==s?void 0:s.image});t.buildRowRangeAst=(e,t,r,s)=>(i(e,t,r),{type:a.ROW_RANGE,start:e,end:t,sheetReferenceType:r,leadingWhitespace:null==s?void 0:s.image});t.buildConcatenateOpAst=(e,t,r)=>({type:a.CONCATENATE_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildEqualsOpAst=(e,t,r)=>({type:a.EQUALS_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildNotEqualOpAst=(e,t,r)=>({type:a.NOT_EQUAL_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildGreaterThanOpAst=(e,t,r)=>({type:a.GREATER_THAN_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildLessThanOpAst=(e,t,r)=>({type:a.LESS_THAN_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildGreaterThanOrEqualOpAst=(e,t,r)=>({type:a.GREATER_THAN_OR_EQUAL_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildLessThanOrEqualOpAst=(e,t,r)=>({type:a.LESS_THAN_OR_EQUAL_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildPlusOpAst=(e,t,r)=>({type:a.PLUS_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildMinusOpAst=(e,t,r)=>({type:a.MINUS_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildTimesOpAst=(e,t,r)=>({type:a.TIMES_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildDivOpAst=(e,t,r)=>({type:a.DIV_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildPowerOpAst=(e,t,r)=>({type:a.POWER_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildMinusUnaryOpAst=(e,t)=>({type:a.MINUS_UNARY_OP,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildPlusUnaryOpAst=(e,t)=>({type:a.PLUS_UNARY_OP,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildPercentOpAst=(e,t)=>({type:a.PERCENT_OP,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildProcedureAst=(e,t,r,s)=>({type:a.FUNCTION_CALL,procedureName:e,args:t,leadingWhitespace:null==r?void 0:r.image,internalWhitespace:null==s?void 0:s.image});t.buildArrayAst=(e,t,r)=>({type:a.ARRAY,args:e,leadingWhitespace:null==t?void 0:t.image,internalWhitespace:null==r?void 0:r.image});t.buildNamedExpressionAst=(e,t)=>({type:a.NAMED_EXPRESSION,expressionName:e,leadingWhitespace:null==t?void 0:t.image});t.buildParenthesisAst=(e,t,r)=>({type:a.PARENTHESIS,expression:e,leadingWhitespace:null==t?void 0:t.image,internalWhitespace:null==r?void 0:r.image});t.buildCellErrorAst=(e,t)=>({type:a.ERROR,error:e,leadingWhitespace:null==t?void 0:t.image});t.buildErrorWithRawInputAst=(e,t,r)=>({type:a.ERROR_WITH_RAW_INPUT,error:t,rawInput:e,leadingWhitespace:null==r?void 0:r.image});function i(e,t,r){if(void 0!==e.sheet&&void 0===t.sheet||void 0===e.sheet&&void 0!==t.sheet)throw new Error("Start address inconsistent with end address");if(void 0===e.sheet&&r!==o.RELATIVE||void 0!==e.sheet&&r===o.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}t.buildParsingErrorAst=()=>({type:a.ERROR,error:s.CellError.parsingError()})},function(e,t,r){"use strict";t.__esModule=!0,t.binaryOpTokenMap=void 0;var s=r(14);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */const n={[s.AstNodeType.PLUS_OP]:"+",[s.AstNodeType.MINUS_OP]:"-",[s.AstNodeType.TIMES_OP]:"*",[s.AstNodeType.DIV_OP]:"/",[s.AstNodeType.CONCATENATE_OP]:"&",[s.AstNodeType.POWER_OP]:"^",[s.AstNodeType.EQUALS_OP]:"=",[s.AstNodeType.NOT_EQUAL_OP]:"<>",[s.AstNodeType.GREATER_THAN_OP]:">",[s.AstNodeType.GREATER_THAN_OR_EQUAL_OP]:">=",[s.AstNodeType.LESS_THAN_OP]:"<",[s.AstNodeType.LESS_THAN_OR_EQUAL_OP]:"<="};t.binaryOpTokenMap=n},function(e,t,r){"use strict";t.__esModule=!0,t.doesContainFunctions=t.Cache=void 0;var s=r(6);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.Cache=class{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=((e,t,r,s)=>({ast:e,relativeDependencies:t,hasVolatileFunction:r,hasStructuralChangeFunction:s}))(t,(0,s.collectDependencies)(t,this.functionRegistry),n(t,this.functionRegistry.isFunctionVolatile),n(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,r),r}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return void 0!==r?r.ast:(this.set(e,t),t)}};const n=(e,t)=>{switch(e.type){case s.AstNodeType.EMPTY:case s.AstNodeType.NUMBER:case s.AstNodeType.STRING:case s.AstNodeType.ERROR:case s.AstNodeType.ERROR_WITH_RAW_INPUT:case s.AstNodeType.CELL_REFERENCE:case s.AstNodeType.CELL_RANGE:case s.AstNodeType.COLUMN_RANGE:case s.AstNodeType.ROW_RANGE:case s.AstNodeType.NAMED_EXPRESSION:return!1;case s.AstNodeType.PERCENT_OP:case s.AstNodeType.PLUS_UNARY_OP:case s.AstNodeType.MINUS_UNARY_OP:return n(e.value,t);case s.AstNodeType.CONCATENATE_OP:case s.AstNodeType.EQUALS_OP:case s.AstNodeType.NOT_EQUAL_OP:case s.AstNodeType.LESS_THAN_OP:case s.AstNodeType.GREATER_THAN_OP:case s.AstNodeType.LESS_THAN_OR_EQUAL_OP:case s.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case s.AstNodeType.MINUS_OP:case s.AstNodeType.PLUS_OP:case s.AstNodeType.TIMES_OP:case s.AstNodeType.DIV_OP:case s.AstNodeType.POWER_OP:return n(e.left,t)||n(e.right,t);case s.AstNodeType.PARENTHESIS:return n(e.expression,t);case s.AstNodeType.FUNCTION_CALL:return!!t(e.procedureName)||e.args.some(e=>n(e,t));case s.AstNodeType.ARRAY:return e.args.some(e=>e.some(e=>n(e,t)))}};t.doesContainFunctions=n},function(e,t,r){"use strict";t.__esModule=!0,t.FormulaParser=t.FormulaLexer=void 0;var s=r(12),n=r(1),a=r(18),o=r(7),i=r(14),u=r(8),l=r(11),h=r(10),d=r(9);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class p extends s.EmbeddedActionsParser{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:(0,s.EMPTY_ALT)((0,i.buildEmptyArgAst)())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var e;const t=this.CONSUME(l.ProcedureName),r=t.image.toUpperCase().slice(0,-1),s=null!==(e=this.lexerConfig.functionMapping[r])&&void 0!==e?e:r,n=[];let a=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var e;const t=this.CONSUME(this.lexerConfig.ArgSeparator);a.type===i.AstNodeType.EMPTY&&(a.leadingWhitespace=null===(e=t.leadingWhitespace)||void 0===e?void 0:e.image),n.push(a),a=this.SUBRULE2(this.booleanExpressionOrEmpty)}),n.push(a),1===n.length&&n[0].type===i.AstNodeType.EMPTY&&(n.length=0);const o=this.CONSUME(l.RParen);return(0,i.buildProcedureAst)(s,n,t.leadingWhitespace,o.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const e=this.CONSUME(l.NamedExpression);return(0,i.buildNamedExpressionAst)(e.image,e.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const e=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(l.LParen),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{e.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(l.RParen),this.handleOffsetHeuristic(e)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const e=this.CONSUME(l.ColumnRange),[t,r]=e.image.split(":"),s=this.ACTION(()=>(0,o.columnAddressFromString)(this.sheetMapping,t,this.formulaAddress)),a=this.ACTION(()=>(0,o.columnAddressFromString)(this.sheetMapping,r,this.formulaAddress));if(void 0===s||void 0===a)return(0,i.buildCellErrorAst)(new n.CellError(n.ErrorType.REF));if(s.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return(0,i.buildErrorWithRawInputAst)(e.image,new n.CellError(n.ErrorType.NAME),e.leadingWhitespace);if(void 0===s.sheet&&void 0!==a.sheet)return this.parsingError(i.ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:h,sheetRefType:d}=p.fixSheetIdsForRangeEnds(s,a),{start:c,end:m}=this.orderColumnRangeEnds(u,h);return(0,i.buildColumnRangeAst)(c,m,d,e.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const e=this.CONSUME(l.RowRange),[t,r]=e.image.split(":"),s=this.ACTION(()=>(0,o.rowAddressFromString)(this.sheetMapping,t,this.formulaAddress)),a=this.ACTION(()=>(0,o.rowAddressFromString)(this.sheetMapping,r,this.formulaAddress));if(void 0===s||void 0===a)return(0,i.buildCellErrorAst)(new n.CellError(n.ErrorType.REF));if(s.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||a.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return(0,i.buildErrorWithRawInputAst)(e.image,new n.CellError(n.ErrorType.NAME),e.leadingWhitespace);if(void 0===s.sheet&&void 0!==a.sheet)return this.parsingError(i.ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:h,sheetRefType:d}=p.fixSheetIdsForRangeEnds(s,a),{start:c,end:m}=this.orderRowRangeEnds(u,h);return(0,i.buildRowRangeAst)(c,m,d,e.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const e=this.CONSUME(l.CellReference),t=this.ACTION(()=>(0,o.cellAddressFromString)(this.sheetMapping,e.image,this.formulaAddress));return void 0===t?(0,i.buildErrorWithRawInputAst)(e.image,new n.CellError(n.ErrorType.REF),e.leadingWhitespace):t.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?(0,i.buildErrorWithRawInputAst)(e.image,new n.CellError(n.ErrorType.NAME),e.leadingWhitespace):(0,i.buildCellReferenceAst)(t,e.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",e=>{var t;const r=this.CONSUME(l.CellReference),s=this.ACTION(()=>(0,o.cellAddressFromString)(this.sheetMapping,e.image,this.formulaAddress)),a=this.ACTION(()=>(0,o.cellAddressFromString)(this.sheetMapping,r.image,this.formulaAddress));return void 0===s||void 0===a?this.ACTION(()=>(0,i.buildErrorWithRawInputAst)(`${e.image}:${r.image}`,new n.CellError(n.ErrorType.REF),e.leadingWhitespace)):s.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>(0,i.buildErrorWithRawInputAst)(`${e.image}:${r.image}`,new n.CellError(n.ErrorType.NAME),e.leadingWhitespace)):this.buildCellRange(s,a,null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",e=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[e]})},{ALT:()=>{var t;const r=this.SUBRULE(this.offsetProcedureExpression),s=this.ACTION(()=>(0,o.cellAddressFromString)(this.sheetMapping,e.image,this.formulaAddress));return void 0===s?(0,i.buildCellErrorAst)(new n.CellError(n.ErrorType.REF)):r.type===i.AstNodeType.CELL_REFERENCE?this.buildCellRange(s,r.reference,null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image):this.parsingError(i.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const e=this.CONSUME(l.CellReference);return this.CONSUME2(l.RangeSeparator),this.SUBRULE(this.endOfRangeExpression,{ARGS:[e]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",e=>{const t=this.CONSUME(l.CellReference),r=this.ACTION(()=>(0,o.cellAddressFromString)(this.sheetMapping,t.image,this.formulaAddress));return void 0===r?this.ACTION(()=>(0,i.buildCellErrorAst)(new n.CellError(n.ErrorType.REF))):this.buildCellRange(e.reference,r,e.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",e=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[e]})},{ALT:()=>{const t=this.SUBRULE(this.offsetProcedureExpression);return t.type===i.AstNodeType.CELL_REFERENCE?this.buildCellRange(e.reference,t.reference,e.leadingWhitespace):this.parsingError(i.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const e=this.SUBRULE(this.offsetProcedureExpression);let t;return this.OPTION(()=>{this.CONSUME(l.RangeSeparator),t=e.type===i.AstNodeType.CELL_RANGE?this.parsingError(i.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[e]})}),void 0!==t?t:e}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const e=[[]];return e[e.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),e[e.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),e.push([]),e[e.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),(0,i.buildArrayAst)(e)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const e=this.CONSUME(l.LParen),t=this.SUBRULE(this.booleanExpression),r=this.CONSUME(l.RParen);return(0,i.buildParenthesisAst)(t,e.leadingWhitespace,r.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const e=this.CONSUME(l.ArrayLParen),t=this.SUBRULE(this.insideArrayExpression),r=this.CONSUME(l.ArrayRParen);return(0,i.buildArrayAst)(t.args,e.leadingWhitespace,r.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=e=>{const t=e.replace(this.lexerConfig.decimalSeparator,".");return Number(t)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var e;return this.OR(null!==(e=this.atomicExpCache)&&void 0!==e?e:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const e=this.CONSUME(this.lexerConfig.NumberLiteral);return(0,i.buildNumberAst)(this.numericStringToNumber(e.image),e.leadingWhitespace)}},{ALT:()=>{const e=this.CONSUME(l.StringLiteral);return(0,i.buildStringAst)(e)}},{ALT:()=>{const e=this.CONSUME(l.ErrorLiteral),t=e.image.toUpperCase(),r=this.lexerConfig.errorMapping[t];return r?(0,i.buildCellErrorAst)(new n.CellError(r),e.leadingWhitespace):this.parsingError(i.ParsingErrorType.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const e=this.SUBRULE(this.positiveAtomicExpression),t=this.OPTION(()=>this.CONSUME(l.PercentOp));return t?(0,i.buildPercentOpAst)(e,t.leadingWhitespace):e}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const e=this.CONSUME(l.AdditionOp),t=this.SUBRULE(this.atomicExpression);return(0,s.tokenMatcher)(e,l.PlusOp)?(0,i.buildPlusUnaryOpAst)(t,e.leadingWhitespace):(0,s.tokenMatcher)(e,l.MinusOp)?(0,i.buildMinusUnaryOpAst)(t,e.leadingWhitespace):(this.customParsingError=(0,i.parsingError)(i.ParsingErrorType.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let e=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const t=this.CONSUME(l.PowerOp),r=this.SUBRULE2(this.atomicExpression);(0,s.tokenMatcher)(t,l.PowerOp)?e=(0,i.buildPowerOpAst)(e,r,t.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),e}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let e=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const t=this.CONSUME(l.MultiplicationOp),r=this.SUBRULE2(this.powerExpression);(0,s.tokenMatcher)(t,l.TimesOp)?e=(0,i.buildTimesOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.DivOp)?e=(0,i.buildDivOpAst)(e,r,t.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),e}),this.additionExpression=this.RULE("additionExpression",()=>{let e=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const t=this.CONSUME(l.AdditionOp),r=this.SUBRULE2(this.multiplicationExpression);(0,s.tokenMatcher)(t,l.PlusOp)?e=(0,i.buildPlusOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.MinusOp)?e=(0,i.buildMinusOpAst)(e,r,t.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),e}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let e=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const t=this.CONSUME(l.ConcatenateOp),r=this.SUBRULE2(this.additionExpression);e=(0,i.buildConcatenateOpAst)(e,r,t.leadingWhitespace)}),e}),this.booleanExpression=this.RULE("booleanExpression",()=>{let e=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const t=this.CONSUME(l.BooleanOp),r=this.SUBRULE2(this.concatenateExpression);(0,s.tokenMatcher)(t,l.EqualsOp)?e=(0,i.buildEqualsOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.NotEqualOp)?e=(0,i.buildNotEqualOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.GreaterThanOp)?e=(0,i.buildGreaterThanOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.LessThanOp)?e=(0,i.buildLessThanOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.GreaterThanOrEqualOp)?e=(0,i.buildGreaterThanOrEqualOpAst)(e,r,t.leadingWhitespace):(0,s.tokenMatcher)(t,l.LessThanOrEqualOp)?e=(0,i.buildLessThanOrEqualOpAst)(e,r,t.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),e}),this.formula=this.RULE("formula",()=>(this.CONSUME(l.EqualsOp),this.SUBRULE(this.booleanExpression))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=(0,n.simpleCellAddress)(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),s=[];return this.customParsingError&&s.push(this.customParsingError),s=s.concat(this.errors.map(e=>({type:i.ParsingErrorType.ParserError,message:e.message}))),s.length>0&&(r=(0,i.buildParsingErrorAst)()),{ast:r,errors:s}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(void 0===e.sheet&&void 0!==t.sheet)return this.parsingError(i.ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:s,secondEnd:n,sheetRefType:a}=p.fixSheetIdsForRangeEnds(e,t),{start:o,end:u}=this.orderCellRangeEnds(s,n);return(0,i.buildCellRangeAst)(o,u,a,r)}static fixSheetIdsForRangeEnds(e,t){const r=p.rangeSheetReferenceType(e.sheet,t.sheet);return{firstEnd:e,secondEnd:void 0!==e.sheet&&void 0===t.sheet?t.withSheet(e.sheet):t,sheetRefType:r}}orderCellRangeEnds(e,t){const r=[e,t],[s,n]=r.map(e=>e.toColumnAddress()).sort(d.ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(e=>e.toRowAddress()).sort(h.RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[i,l]=r.map(e=>e.sheet).sort(p.compareSheetIds.bind(this));return{start:u.CellAddress.fromColAndRow(s,a,i),end:u.CellAddress.fromColAndRow(n,o,l)}}orderColumnRangeEnds(e,t){const r=[e,t],[s,n]=r.sort(d.ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(e=>e.sheet).sort(p.compareSheetIds.bind(this));return{start:new d.ColumnAddress(s.type,s.col,a),end:new d.ColumnAddress(n.type,n.col,o)}}orderRowRangeEnds(e,t){const r=[e,t],[s,n]=r.sort(h.RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(e=>e.sheet).sort(p.compareSheetIds.bind(this));return{start:new h.RowAddress(s.type,s.row,a),end:new h.RowAddress(n.type,n.row,o)}}static compareSheetIds(e,t){return(e=null!=e?e:1/0)-(t=null!=t?t:1/0)}handleOffsetHeuristic(e){const t=e[0];if(t.type!==i.AstNodeType.CELL_REFERENCE)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");const r=e[1];let s;if(r.type===i.AstNodeType.NUMBER&&Number.isInteger(r.value))s=r.value;else if(r.type===i.AstNodeType.PLUS_UNARY_OP&&r.value.type===i.AstNodeType.NUMBER&&Number.isInteger(r.value.value))s=r.value.value;else{if(r.type!==i.AstNodeType.MINUS_UNARY_OP||r.value.type!==i.AstNodeType.NUMBER||!Number.isInteger(r.value.value))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");s=-r.value.value}const o=e[2];let l;if(o.type===i.AstNodeType.NUMBER&&Number.isInteger(o.value))l=o.value;else if(o.type===i.AstNodeType.PLUS_UNARY_OP&&o.value.type===i.AstNodeType.NUMBER&&Number.isInteger(o.value.value))l=o.value.value;else{if(o.type!==i.AstNodeType.MINUS_UNARY_OP||o.value.type!==i.AstNodeType.NUMBER||!Number.isInteger(o.value.value))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");l=-o.value.value}const h=e[3];let d;if(void 0===h)d=1;else{if(h.type!==i.AstNodeType.NUMBER)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");if(d=h.value,d<1)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(d))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}const p=e[4];let c;if(void 0===p)c=1;else{if(p.type!==i.AstNodeType.NUMBER)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");if(c=p.value,c<1)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(c))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}const m=new u.CellAddress(t.reference.col+l,t.reference.row+s,t.reference.type);let g=m.col,E=m.row;if(t.reference.type!==u.CellReferenceType.CELL_REFERENCE_RELATIVE&&t.reference.type!==u.CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL||(E+=this.formulaAddress.row),t.reference.type!==u.CellReferenceType.CELL_REFERENCE_RELATIVE&&t.reference.type!==u.CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW||(g+=this.formulaAddress.col),g<0||E<0)return(0,i.buildCellErrorAst)(new n.CellError(n.ErrorType.REF,a.ErrorMessage.OutOfSheet));if(1===c&&1===d)return(0,i.buildCellReferenceAst)(m);{const e=new u.CellAddress(m.col+c-1,m.row+d-1,m.type);return(0,i.buildCellRangeAst)(m,e,i.RangeSheetReferenceType.RELATIVE)}}parsingError(e,t){return this.customParsingError=(0,i.parsingError)(e,t),(0,i.buildParsingErrorAst)()}static rangeSheetReferenceType(e,t){return void 0===e?i.RangeSheetReferenceType.RELATIVE:void 0===t?i.RangeSheetReferenceType.START_ABSOLUTE:i.RangeSheetReferenceType.BOTH_ABSOLUTE}}t.FormulaParser=p;class c{constructor(e){this.lexerConfig=e,this.lexer=new s.Lexer(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return c.filterTokensByNeighbors(e,(e,t,r)=>((0,s.tokenMatcher)(e,l.CellReference)||(0,s.tokenMatcher)(e,l.RangeSeparator))&&(0,s.tokenMatcher)(t,this.lexerConfig.WhiteSpace)&&((0,s.tokenMatcher)(r,l.CellReference)||(0,s.tokenMatcher)(r,l.RangeSeparator)))}skipWhitespacesBeforeArgSeparators(e){return c.filterTokensByNeighbors(e,(e,t,r)=>!(0,s.tokenMatcher)(e,this.lexerConfig.ArgSeparator)&&(0,s.tokenMatcher)(t,this.lexerConfig.WhiteSpace)&&(0,s.tokenMatcher)(r,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const s=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||s.push(e[r]),++r;return s.push(e[r]),s}trimTrailingWhitespaces(e){return e.length>0&&(0,s.tokenMatcher)(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}t.FormulaLexer=c},function(e,t,r){"use strict";t.__esModule=!0,t.ErrorMessage=void 0;
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class s{}t.ErrorMessage=s,s.DistinctSigns="Distinct signs.",s.WrongArgNumber="Wrong number of arguments.",s.EmptyArg="Empty function argument.",s.EmptyArray="Empty array not allowed.",s.ArrayDimensions="Array dimensions are not compatible.",s.NoSpaceForArrayResult="No space for array result.",s.ValueSmall="Value too small.",s.ValueLarge="Value too large.",s.BadCriterion="Incorrect criterion.",s.RangeManySheets="Range spans more than one sheet.",s.CellRangeExpected="Cell range expected.",s.WrongDimension="Wrong range dimension.",s.ScalarExpected="Cell range not allowed.",s.NumberCoercion="Value cannot be coerced to number.",s.NumberExpected="Number argument expected.",s.IntegerExpected="Value needs to be an integer.",s.BadMode="Mode not recognized.",s.DateBounds="Date outside of bounds.",s.OutOfSheet="Resulting reference is out of the sheet.",s.WrongType="Wrong type of argument.",s.NaN="NaN or infinite value encountered.",s.EqualLength="Ranges need to be of equal length.",s.Negative="Value cannot be negative.",s.NotBinary="String does not represent a binary number.",s.NotOctal="String does not represent an octal number.",s.NotHex="String does not represent a hexadecimal number.",s.EndStartPeriod="End period needs to be at least start period.",s.CellRefExpected="Cell reference expected.",s.EmptyRange="Empty range not allowed.",s.BadRef="Address is not correct.",s.NumberRange="Number-only range expected.",s.ValueNotFound="Value not found.",s.ValueBaseLarge="Value in base too large.",s.ValueBaseSmall="Value in base too small.",s.ValueBaseLong="Value in base too long.",s.NegativeLength="Length cannot be negative.",s.PatternNotFound="Pattern not found.",s.OneValue="Needs at least one value.",s.TwoValues="Range needs to contain at least two elements.",s.ThreeValues="Range needs to contain at least three elements.",s.IndexBounds="Index out of bounds.",s.IndexLarge="Index too large.",s.Formula="Expected formula.",s.NegativeCount="Count cannot be negative.",s.ParseError="Parsing error.",s.SheetRef="Sheet does not exist.",s.PeriodLong="Period number cannot exceed life length.",s.InvalidDate="Invalid date.",s.BitshiftLong="Result of bitshift is too long.",s.EmptyString="Empty-string argument not allowed.",s.LengthBounds="Length out of bounds.",s.NegativeTime="Time cannot be negative.",s.NoDefault="No default option.",s.Selector="Selector cannot exceed the number of arguments.",s.StartEndDate="Start date needs to be earlier than end date.",s.IncorrectDateTime="String does not represent correct DateTime.",s.CharacterCodeBounds="Character code out of bounds.",s.NonZero="Argument cannot be 0.",s.LessThanOne="Argument cannot be less than 1.",s.WeekendString="Incorrect weekend bitmask string.",s.InvalidRoman="Invalid roman numeral.",s.WrongOrder="Wrong order of values.",s.ComplexNumberExpected="Complex number expected.",s.ShouldBeIorJ="Should be 'i' or 'j'.",s.SizeMismatch="Array dimensions mismatched.",s.FunctionName=e=>`Function name ${e} not recognized.`,s.NamedExpressionName=e=>`Named expression ${e} not recognized.`,s.LicenseKey=e=>`License key is ${e}.`},function(e,t,r){"use strict";t.__esModule=!0,t.Unparser=void 0,t.formatNumber=u;var s=r(1),n=r(0),a=r(7),o=r(14),i=r(15);function u(e,t){return e.toString().replace(".",t)}t.Unparser=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r,s){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=s}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,n;switch(e.type){case o.AstNodeType.EMPTY:return(0,o.imageWithWhitespace)("",e.leadingWhitespace);case o.AstNodeType.NUMBER:return(0,o.imageWithWhitespace)(u(e.value,this.config.decimalSeparator),e.leadingWhitespace);case o.AstNodeType.STRING:return(0,o.imageWithWhitespace)('"'+e.value+'"',e.leadingWhitespace);case o.AstNodeType.FUNCTION_CALL:{const r=e.args.map(e=>void 0!==e?this.unparseAst(e,t):"").join(this.config.functionArgSeparator),s=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+r+(0,o.imageWithWhitespace)(")",e.internalWhitespace);return(0,o.imageWithWhitespace)(s,e.leadingWhitespace)}case o.AstNodeType.NAMED_EXPRESSION:{const s=null===(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))||void 0===r?void 0:r.displayName;return(0,o.imageWithWhitespace)(s||e.expressionName,e.leadingWhitespace)}case o.AstNodeType.CELL_REFERENCE:{let r;return r=void 0!==e.reference.sheet?this.unparseSheetName(e.reference.sheet)+"!":"",r+=null!==(n=e.reference.unparse(t))&&void 0!==n?n:this.config.translationPackage.getErrorTranslation(s.ErrorType.REF),(0,o.imageWithWhitespace)(r,e.leadingWhitespace)}case o.AstNodeType.COLUMN_RANGE:case o.AstNodeType.ROW_RANGE:case o.AstNodeType.CELL_RANGE:return(0,o.imageWithWhitespace)(this.formatRange(e,t),e.leadingWhitespace);case o.AstNodeType.PLUS_UNARY_OP:{const r=this.unparseAst(e.value,t);return(0,o.imageWithWhitespace)("+",e.leadingWhitespace)+r}case o.AstNodeType.MINUS_UNARY_OP:{const r=this.unparseAst(e.value,t);return(0,o.imageWithWhitespace)("-",e.leadingWhitespace)+r}case o.AstNodeType.PERCENT_OP:return this.unparseAst(e.value,t)+(0,o.imageWithWhitespace)("%",e.leadingWhitespace);case o.AstNodeType.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:s.ErrorType.ERROR);return(0,o.imageWithWhitespace)(t,e.leadingWhitespace)}case o.AstNodeType.ERROR_WITH_RAW_INPUT:return(0,o.imageWithWhitespace)(e.rawInput,e.leadingWhitespace);case o.AstNodeType.PARENTHESIS:{const r="("+this.unparseAst(e.expression,t)+(0,o.imageWithWhitespace)(")",e.internalWhitespace);return(0,o.imageWithWhitespace)(r,e.leadingWhitespace)}case o.AstNodeType.ARRAY:{const r="{"+e.args.map(e=>e.map(e=>this.unparseAst(e,t)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+(0,o.imageWithWhitespace)("}",e.internalWhitespace);return(0,o.imageWithWhitespace)(r,e.leadingWhitespace)}default:{const r=this.unparseAst(e.left,t),s=this.unparseAst(e.right,t);return r+(0,o.imageWithWhitespace)(i.binaryOpTokenMap[e.type],e.leadingWhitespace)+s}}}unparseSheetName(e){const t=(0,a.sheetIndexToString)(e,this.sheetMappingFn);if(void 0===t)throw new n.NoSheetWithIdError(e);return t}formatRange(e,t){let r="",n="";void 0!==e.start.sheet&&e.sheetReferenceType!==o.RangeSheetReferenceType.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),void 0!==e.end.sheet&&e.sheetReferenceType===o.RangeSheetReferenceType.BOTH_ABSOLUTE&&(n=this.unparseSheetName(e.end.sheet)+"!");const a=e.start.unparse(t),i=e.end.unparse(t);return void 0===a||void 0===i?this.config.translationPackage.getErrorTranslation(s.ErrorType.REF):`${r}${a}:${n}${i}`}}},function(e,t,r){"use strict";t.__esModule=!0,t.collectDependencies=void 0;var s=r(6);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */const n=(e,t,r,a)=>{switch(e.type){case s.AstNodeType.EMPTY:case s.AstNodeType.NUMBER:case s.AstNodeType.STRING:case s.AstNodeType.ERROR:return;case s.AstNodeType.NAMED_EXPRESSION:return void(a&&r.push(new s.NamedExpressionDependency(e.expressionName)));case s.AstNodeType.CELL_REFERENCE:return void(a&&r.push(new s.AddressDependency(e.reference)));case s.AstNodeType.CELL_RANGE:return void(a&&e.start.sheet===e.end.sheet&&r.push(new s.CellRangeDependency(e.start,e.end)));case s.AstNodeType.COLUMN_RANGE:return void(a&&e.start.sheet===e.end.sheet&&r.push(new s.ColumnRangeDependency(e.start,e.end)));case s.AstNodeType.ROW_RANGE:return void(a&&e.start.sheet===e.end.sheet&&r.push(new s.RowRangeDependency(e.start,e.end)));case s.AstNodeType.PERCENT_OP:case s.AstNodeType.PLUS_UNARY_OP:case s.AstNodeType.MINUS_UNARY_OP:return void n(e.value,t,r,!0);case s.AstNodeType.CONCATENATE_OP:case s.AstNodeType.EQUALS_OP:case s.AstNodeType.NOT_EQUAL_OP:case s.AstNodeType.LESS_THAN_OP:case s.AstNodeType.GREATER_THAN_OP:case s.AstNodeType.LESS_THAN_OR_EQUAL_OP:case s.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case s.AstNodeType.MINUS_OP:case s.AstNodeType.PLUS_OP:case s.AstNodeType.TIMES_OP:case s.AstNodeType.DIV_OP:case s.AstNodeType.POWER_OP:return n(e.left,t,r,!0),void n(e.right,t,r,!0);case s.AstNodeType.PARENTHESIS:return void n(e.expression,t,r,a);case s.AstNodeType.FUNCTION_CALL:{const s=!t.doesFunctionNeedArgumentToBeComputed(e.procedureName);return void e.args.forEach(e=>n(e,t,r,s))}}};t.collectDependencies=(e,t)=>{const r=new Array;return n(e,t,r,!0),r}},function(e,t,r){"use strict";t.__esModule=!0,t.RowRangeDependency=t.NamedExpressionDependency=t.ColumnRangeDependency=t.CellRangeDependency=t.AddressDependency=void 0;var s=r(4);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.AddressDependency=class{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}};t.CellRangeDependency=class{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new s.AbsoluteCellRange(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}};t.ColumnRangeDependency=class{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new s.AbsoluteColumnRange(t.sheet,t.col,r.col)}};t.RowRangeDependency=class{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new s.AbsoluteRowRange(t.sheet,t.row,r.row)}};t.NamedExpressionDependency=class{constructor(e){this.name=e}absolutize(e){return this}}},function(e,t,r){"use strict";t.__esModule=!0,t.RowsSpan=t.ColumnsSpan=void 0;
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class s{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new s(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new s(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new s(this.sheet,t,r)}firstRow(){return new s(this.sheet,this.rowStart,this.rowStart)}}t.RowsSpan=s;class n{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new n(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new n(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new n(this.sheet,t,r)}firstColumn(){return new n(this.sheet,this.columnStart,this.columnStart)}}t.ColumnsSpan=n},function(e,t,r){"use strict";t.__esModule=!0,t.filterDependenciesOutOfScope=t.absolutizeDependencies=void 0;var s=r(4),n=r(1),a=r(6);t.absolutizeDependencies=(e,t)=>e.map(e=>e.absolutize(t));t.filterDependenciesOutOfScope=e=>e.filter(e=>e instanceof a.NamedExpressionDependency||(e instanceof s.AbsoluteCellRange?!((0,n.invalidSimpleCellAddress)(e.start)||(0,n.invalidSimpleCellAddress)(e.end)):!(0,n.invalidSimpleCellAddress)(e)))},function(e,t,r){"use strict";t.__esModule=!0,t.ContentChanges=void 0;var s=r(1),n=r(25);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a{constructor(){this.changes=new Map}static empty(){return new a}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach(r=>{const s=e.exportChange(r);Array.isArray(s)?t=t.concat(s):t.push(s)}),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return 0===this.changes.size}add(e,t){const r=t.value;if(r instanceof n.SimpleRangeValue)for(const t of r.effectiveAddressesFromData(e))this.changes.delete(`${t.sheet},${t.col},${t.row}`);this.changes.set((0,s.addressKey)(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}t.ContentChanges=a},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleRangeValue=void 0;var s=r(26),n=r(1),a=r(18),o=r(32);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i{constructor(e,t,r,n){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=n,this.size=void 0===e?new s.ArraySize(t.effectiveWidth(r),t.effectiveHeight(r)):new s.ArraySize(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new i(e,t,r,!0)}static onlyNumbers(e){return new i(e,void 0,void 0,!0)}static onlyValues(e){return new i(e,void 0,void 0,void 0)}static onlyRange(e,t){return new i(void 0,e,t,void 0)}static fromScalar(e){return new i([[e]],void 0,void 0,void 0)}isAdHoc(){return void 0===this.range}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let s=0;s<r.length;++s)yield(0,n.simpleCellAddress)(e.sheet,e.col+s,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],(0,n.simpleCellAddress)(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(void 0===this._hasOnlyNumbers){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if("number"!=typeof t)return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),null!==(e=this._data)&&void 0!==e?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){void 0===this._data&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof i?(this._hasOnlyNumbers=!1,new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.ScalarExpected)):((0,o.isExtendedNumber)(t)||(this._hasOnlyNumbers=!1),t)}))}}t.SimpleRangeValue=i},function(e,t,r){"use strict";t.__esModule=!0,t.ArraySizePredictor=t.ArraySize=void 0;var s=r(4),n=r(27),a=r(28),o=r(6);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i{constructor(e,t,r=!1){if(this.width=e,this.height=t,this.isRef=r,e<=0||t<=0)throw Error("Incorrect array size")}static fromArray(e){return new i(e.length>0?e[0].length:0,e.length)}static error(){return new i(1,1,!0)}static scalar(){return new i(1,1,!1)}isScalar(){return this.width<=1&&this.height<=1||this.isRef}}t.ArraySize=i;t.ArraySizePredictor=class{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case o.AstNodeType.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case o.AstNodeType.COLUMN_RANGE:case o.AstNodeType.ROW_RANGE:case o.AstNodeType.CELL_RANGE:{const r=s.AbsoluteCellRange.fromAstOrUndef(e,t.formulaAddress);return void 0===r?i.error():new i(r.width(),r.height(),!0)}case o.AstNodeType.ARRAY:{const r=[],s=[];for(const n of e.args){const e=n.map(e=>this.checkArraySizeForAst(e,t)),a=Math.min(...e.map(e=>e.height)),o=e.reduce((e,t)=>e+t.width,0);r.push(a),s.push(o)}const n=r.reduce((e,t)=>e+t,0),a=Math.min(...s);return new i(a,n)}case o.AstNodeType.STRING:case o.AstNodeType.NUMBER:return i.scalar();case o.AstNodeType.CELL_REFERENCE:return new i(1,1,!0);case o.AstNodeType.DIV_OP:case o.AstNodeType.CONCATENATE_OP:case o.AstNodeType.EQUALS_OP:case o.AstNodeType.GREATER_THAN_OP:case o.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case o.AstNodeType.LESS_THAN_OP:case o.AstNodeType.LESS_THAN_OR_EQUAL_OP:case o.AstNodeType.MINUS_OP:case o.AstNodeType.NOT_EQUAL_OP:case o.AstNodeType.PLUS_OP:case o.AstNodeType.POWER_OP:case o.AstNodeType.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),s=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||s.height>1||s.width>1)?i.error():(n=r,a=s,new i(Math.max(n.width,a.width),Math.max(n.height,a.height)))}case o.AstNodeType.MINUS_UNARY_OP:case o.AstNodeType.PLUS_UNARY_OP:case o.AstNodeType.PERCENT_OP:{const s=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(s.height>1||s.width>1)?i.error():new i((r=s).width,r.height)}case o.AstNodeType.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case o.AstNodeType.EMPTY:default:return i.error()}var r,n,a}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getMetadata(e.procedureName),s=this.functionRegistry.getArraySizeFunction(e.procedureName);if(void 0!==s)return s(e,t);const o=e.args.map(e=>{var s;return this.checkArraySizeForAst(e,new n.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))});if(void 0===r||r.expandRanges||!t.arraysFlag||r.vectorizationForbidden||void 0===r.parameters)return new i(1,1);const u=[...r.parameters];if(void 0===r.repeatLastArgs&&u.length<o.length)return i.error();if(void 0!==r.repeatLastArgs&&u.length<o.length&&(o.length-u.length)%r.repeatLastArgs!=0)return i.error();for(;u.length<o.length;)u.push(...u.slice(u.length-r.repeatLastArgs));let l=1,h=1;for(let e=0;e<o.length;e++)u[e].argumentType!==a.ArgumentTypes.RANGE&&u[e].argumentType!==a.ArgumentTypes.ANY&&(h=Math.max(h,o[e].height),l=Math.max(l,o[e].width));return new i(l,h)}}},function(e,t,r){"use strict";t.__esModule=!0,t.InterpreterState=void 0;t.InterpreterState=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}},function(e,t,r){"use strict";t.__esModule=!0,t.FunctionPlugin=t.ArgumentTypes=void 0;var s,n=r(4),a=r(1),o=r(18),i=r(6),u=r(29),l=r(32),h=r(25);t.ArgumentTypes=s,function(e){e.STRING="STRING",e.NUMBER="NUMBER",e.BOOLEAN="BOOLEAN",e.SCALAR="SCALAR",e.NOERROR="NOERROR",e.RANGE="RANGE",e.INTEGER="INTEGER",e.COMPLEX="COMPLEX",e.ANY="ANY"}(s||(t.ArgumentTypes=s={}));t.FunctionPlugin=class{constructor(e){this.coerceScalarToNumberOrError=e=>this.arithmeticHelper.coerceScalarToNumberOrError(e),this.runFunction=(e,t,r,n)=>{var i,u,l,d,p;let c,m=r.parameters||[];if(c=r.expandRanges?this.listOfScalarValues(e,t):e.map(e=>[this.evaluateAst(e,t),!1]),void 0===r.repeatLastArgs&&m.length<c.length)return new a.CellError(a.ErrorType.NA,o.ErrorMessage.WrongArgNumber);if(void 0!==r.repeatLastArgs&&m.length<c.length&&(c.length-m.length)%r.repeatLastArgs!=0)return new a.CellError(a.ErrorType.NA,o.ErrorMessage.WrongArgNumber);for(m=[...m];m.length<c.length;)m.push(...m.slice(m.length-r.repeatLastArgs));let g=1,E=1;if(!r.vectorizationForbidden&&t.arraysFlag)for(let e=0;e<c.length;e++){const[t]=c[e];t instanceof h.SimpleRangeValue&&m[e].argumentType!==s.RANGE&&m[e].argumentType!==s.ANY&&(E=Math.max(E,t.height()),g=Math.max(g,t.width()))}for(let e=c.length;e<m.length;e++)if(void 0===(null===(i=m[e])||void 0===i?void 0:i.defaultValue)&&!(null===(u=m[e])||void 0===u?void 0:u.optionalArg))return new a.CellError(a.ErrorType.NA,o.ErrorMessage.WrongArgNumber);const T=[];for(let e=0;e<E;e++){const i=[];for(let u=0;u<g;u++){let T=void 0;const y=[];for(let n=0;n<m.length;n++){let[i,g]=null!==(l=c[n])&&void 0!==l?l:[void 0,void 0];i instanceof h.SimpleRangeValue&&m[n].argumentType!==s.RANGE&&m[n].argumentType!==s.ANY&&!r.vectorizationForbidden&&t.arraysFlag&&(i=null===(d=i.data[1!==i.height()?e:0])||void 0===d?void 0:d[1!==i.width()?u:0]);const E=null!=i?i:null===(p=m[n])||void 0===p?void 0:p.defaultValue;if(void 0===E)y.push(void 0);else{const e=void 0!==i?this.coerceToType(E,m[n],t):E;void 0!==e?(e instanceof a.CellError&&m[n].argumentType!==s.SCALAR&&(T=null!=T?T:e),y.push(e)):g||(T=null!=T?T:new a.CellError(a.ErrorType.VALUE,o.ErrorMessage.WrongType))}}const A=null!=T?T:this.returnNumberWrapper(n(...y),r.returnNumberType);if(1===E&&1===g)return A;if(A instanceof h.SimpleRangeValue)throw"Function returning array cannot be vectorized.";i.push(A)}T.push(i)}return h.SimpleRangeValue.onlyValues(T)},this.runFunctionWithReferenceArgument=(e,t,r,s,u,l=(()=>new a.CellError(a.ErrorType.NA,o.ErrorMessage.CellRefExpected)))=>{if(0===e.length)return this.returnNumberWrapper(s(),r.returnNumberType);if(e.length>1)return new a.CellError(a.ErrorType.NA,o.ErrorMessage.WrongArgNumber);let h,d=e[0];for(;d.type===i.AstNodeType.PARENTHESIS;)d=d.expression;if(d.type===i.AstNodeType.CELL_REFERENCE)h=d.reference.toSimpleCellAddress(t.formulaAddress);else if(d.type===i.AstNodeType.CELL_RANGE||d.type===i.AstNodeType.COLUMN_RANGE||d.type===i.AstNodeType.ROW_RANGE)try{h=n.AbsoluteCellRange.fromAst(d,t.formulaAddress).start}catch(e){return new a.CellError(a.ErrorType.REF,o.ErrorMessage.CellRefExpected)}return void 0!==h?this.returnNumberWrapper(u(h),r.returnNumberType):this.runFunction(e,t,r,l)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const s of e){const e=this.evaluateAst(s,t);if(e instanceof h.SimpleRangeValue)for(const t of e.valuesFromTopLeftCorner())r.push([t,!0]);else r.push([e,!1])}return r}coerceToType(e,t,r){let n;if(e instanceof h.SimpleRangeValue)switch(t.argumentType){case s.RANGE:case s.ANY:n=e;break;default:{const t=(0,u.coerceRangeToScalar)(e,r);if(void 0===t)return;e=t}}if(!(e instanceof h.SimpleRangeValue))switch(t.argumentType){case s.INTEGER:case s.NUMBER:const r=this.coerceScalarToNumberOrError(e);if(!(0,l.isExtendedNumber)(r)){n=r;break}const i=(0,l.getRawValue)(r);if(void 0!==t.maxValue&&i>t.maxValue)return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ValueLarge);if(void 0!==t.minValue&&i<t.minValue)return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ValueSmall);if(void 0!==t.lessThan&&i>=t.lessThan)return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ValueLarge);if(void 0!==t.greaterThan&&i<=t.greaterThan)return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ValueSmall);if(t.argumentType===s.INTEGER&&!Number.isInteger(i))return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.IntegerExpected);n=r;break;case s.STRING:n=(0,u.coerceScalarToString)(e);break;case s.BOOLEAN:n=(0,u.coerceScalarToBoolean)(e);break;case s.SCALAR:case s.NOERROR:case s.ANY:n=e;break;case s.RANGE:if(e instanceof a.CellError)return e;n=(0,u.coerceToRange)(e);break;case s.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex((0,l.getRawValue)(e))}return t.passSubtype||void 0===n?n:(0,l.getRawValue)(n)}metadata(e){const t=this.constructor.implementedFunctions[e];if(void 0!==t)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return void 0!==t&&(0,l.isExtendedNumber)(e)?this.arithmeticHelper.ExtendedNumberFactory((0,l.getRawValue)(e),{type:t,format:r}):e}}},function(e,t,r){"use strict";t.__esModule=!0,t.ArithmeticHelper=void 0,t.coerceBooleanToNumber=d,t.coerceComplexToString=function([e,t],r){if(!isFinite(e)||!isFinite(t))return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.NaN);if(r=null!=r?r:"i",0===t)return""+e;const s=`${-1===t||1===t?"":Math.abs(t)}${r}`;if(0===e)return`${t<0?"-":""}${s}`;return`${e}${t<0?"-":"+"}${s}`},t.coerceEmptyToValue=p,t.coerceRangeToScalar=function(e,t){var r;if(e.isAdHoc())return null===(r=e.data[0])||void 0===r?void 0:r[0];const s=e.range;if(t.formulaAddress.sheet===s.sheet)if(1===s.width()){const r=t.formulaAddress.row-s.start.row;if(r>=0&&r<s.height())return e.data[r][0]}else if(1===s.height()){const r=t.formulaAddress.col-s.start.col;if(r>=0&&r<s.width())return e.data[0][r]}return},t.coerceScalarToBoolean=function(e){if(e instanceof a.CellError||"boolean"==typeof e)return e;if(e===u.EmptyValue)return!1;if((0,u.isExtendedNumber)(e))return 0!==(0,u.getRawValue)(e);{const t=e.toUpperCase();return"TRUE"===t||"FALSE"!==t&&(""!==t&&void 0)}},t.coerceScalarToString=function(e){return e instanceof a.CellError||"string"==typeof e?e:e===u.EmptyValue?"":(0,u.isExtendedNumber)(e)?(0,u.getRawValue)(e).toString():e?"TRUE":"FALSE"},t.coerceToRange=function(e){return e instanceof l.SimpleRangeValue?e:l.SimpleRangeValue.fromScalar(e)},t.coerceToRangeNumbersOrError=function(e){return e instanceof l.SimpleRangeValue&&e.hasOnlyNumbers()||e instanceof a.CellError?e:(0,u.isExtendedNumber)(e)?l.SimpleRangeValue.fromScalar(e):null},t.fixNegativeZero=function(e){return 0===e?0:e},t.forceNormalizeString=function(e){return A(e.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")},t.isNumberOverflow=function(e){return isNaN(e)||e===1/0||e===-1/0},t.normalizeString=A,t.numberCmp=c,t.zeroIfEmpty=function(e){return e===u.EmptyValue?0:e};var s,n=(s=r(30))&&s.__esModule?s:{default:s},a=r(1),o=r(18),i=r(31),u=r(32),l=r(25);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const h=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;function d(e){return Number(e)}function p(e){return"string"==typeof e?"":(0,u.isExtendedNumber)(e)?0:"boolean"!=typeof e&&u.EmptyValue}function c(e,t){const r=(0,u.getRawValue)(e),s=(0,u.getRawValue)(t);return r>s?1:r<s?-1:0}function m(e){return["*","?"].includes(e)}t.ArithmeticHelper=class{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(e,t)=>this.compare(e,t)<0,this.leq=(e,t)=>this.compare(e,t)<=0,this.gt=(e,t)=>this.compare(e,t)>0,this.geq=(e,t)=>this.compare(e,t)>=0,this.eq=(e,t)=>0===this.compare(e,t),this.neq=(e,t)=>0!==this.compare(e,t),this.pow=(e,t)=>Math.pow((0,u.getRawValue)(e),(0,u.getRawValue)(t)),this.addWithEpsilonRaw=(e,t)=>{const r=e+t;return Math.abs(r)<this.actualEps*Math.abs(e)?0:r},this.addWithEpsilon=(e,t)=>{const r=T(e,t);return this.ExtendedNumberFactory(this.addWithEpsilonRaw((0,u.getRawValue)(e),(0,u.getRawValue)(t)),r)},this.unaryMinus=e=>(0,u.cloneNumber)(e,-(0,u.getRawValue)(e)),this.unaryPlus=e=>e,this.unaryPercent=e=>new u.PercentNumber((0,u.getRawValue)(e)/100),this.concat=(e,t)=>e.concat(t),this.nonstrictadd=(e,t)=>e instanceof a.CellError?e:t instanceof a.CellError?t:"number"==typeof e?"number"==typeof t?this.addWithEpsilonRaw(e,t):e:"number"==typeof t?t:0,this.subtract=(e,t)=>{const r=T(e,t),s=(0,u.getRawValue)(e);let n=s-(0,u.getRawValue)(t);return Math.abs(n)<this.actualEps*Math.abs(s)&&(n=0),this.ExtendedNumberFactory(n,r)},this.divide=(e,t)=>{const r=(0,u.getRawValue)(e),s=(0,u.getRawValue)(t);if(0===s)return new a.CellError(a.ErrorType.DIV_BY_ZERO);{const n=y(e,t);return this.ExtendedNumberFactory(r/s,n)}},this.multiply=(e,t)=>{const r=y(e,t);return this.ExtendedNumberFactory((0,u.getRawValue)(e)*(0,u.getRawValue)(t),r)},this.manyToExactComplex=e=>{const t=[];for(const r of e){if(r instanceof a.CellError)return r;if((0,u.isExtendedNumber)(r)||"string"==typeof r){const e=this.coerceScalarToComplex(r);e instanceof a.CellError||t.push(e)}}return t},this.coerceNumbersExactRanges=e=>this.manyToNumbers(e,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=e=>this.manyToNumbers(e,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=e=>{const t=[];for(const r of e){if(r instanceof a.CellError)return r;(0,u.isExtendedNumber)(r)&&t.push((0,u.getRawValue)(r))}return t},this.manyToOnlyNumbersDropNulls=e=>{const t=[];for(const r of e){if(r instanceof a.CellError)return r;if((0,u.isExtendedNumber)(r))t.push((0,u.getRawValue)(r));else if(r!==u.EmptyValue)return new a.CellError(a.ErrorType.VALUE,o.ErrorMessage.NumberExpected)}return t},this.manyToCoercedNumbersDropNulls=e=>{const t=[];for(const r of e){if(r instanceof a.CellError)return r;if(r===u.EmptyValue)continue;const e=this.coerceScalarToNumberOrError(r);(0,u.isExtendedNumber)(e)&&t.push((0,u.getRawValue)(e))}return t},this.collator=(0,i.collatorFromConfig)(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return e=>"string"==typeof e&&t.test(this.normalizeString(e))}neqMatcherFunction(e){const t=this.buildRegex(e);return e=>!("string"==typeof e&&t.test(this.normalizeString(e)))}searchString(e,t){var r;const s=this.buildRegex(e,!1).exec(t);return null!==(r=null==s?void 0:s.index)&&void 0!==r?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if(m(r)||this.config.useRegularExpressions&&E(r))return!0}return!1}floatCmp(e,t){const r=(0,u.getRawValue)(e),s=(0,u.getRawValue)(t),n=1+this.actualEps;return s>=0&&r*n>=s&&r<=s*n||s<=0&&r*n<=s&&r>=s*n?0:r>s?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof a.CellError?e:null!==(t=this.coerceToMaybeNumber(e))&&void 0!==t?t:new a.CellError(a.ErrorType.VALUE,o.ErrorMessage.NumberCoercion)}coerceToMaybeNumber(e){var t;return null!==(t=this.coerceNonDateScalarToMaybeNumber(e))&&void 0!==t?t:"string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){return e===u.EmptyValue?0:"string"==typeof e?""===e?0:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim()):(0,u.isExtendedNumber)(e)?e:"boolean"==typeof e?Number(e):void 0}coerceComplexExactRanges(e){const t=[];for(const r of e)if(r instanceof l.SimpleRangeValue)t.push(r);else if(r!==u.EmptyValue){const e=this.coerceScalarToComplex(r);if(e instanceof a.CellError)return e;t.push(e)}const r=[];for(const e of t)if(e instanceof l.SimpleRangeValue){const t=this.manyToExactComplex(e.valuesFromTopLeftCorner());if(t instanceof a.CellError)return t;r.push(...t)}else r.push(e);return r}coerceScalarToComplex(e){return e instanceof a.CellError?e:e===u.EmptyValue?[0,0]:(0,u.isExtendedNumber)(e)?[(0,u.getRawValue)(e),0]:"string"==typeof e?this.coerceStringToComplex(e):new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:s}=t;switch(r){case u.NumberType.NUMBER_RAW:return e;case u.NumberType.NUMBER_CURRENCY:return new u.CurrencyNumber(e,null!=s?s:this.config.currencySymbol[0]);case u.NumberType.NUMBER_DATE:return new u.DateNumber(e,s);case u.NumberType.NUMBER_DATETIME:return new u.DateTimeNumber(e,s);case u.NumberType.NUMBER_TIME:return new u.TimeNumber(e,s);case u.NumberType.NUMBER_PERCENT:return new u.PercentNumber(e,s)}}buildRegex(e,t=!0){let r;e=this.normalizeString(e);let s=this.config.useWildcards,n=this.config.useRegularExpressions;if(n)try{RegExp(e)}catch(e){n=!1,s=!1}return r=n?function(e,t){let r="";for(let s=0;s<e.length;s++){const n=e.charAt(s);m(n)||E(n)?r+=n:r+=t?n:n.toLowerCase()}return r}(e,this.config.caseSensitive):s?function(e,t){let r="";for(let s=0;s<e.length;s++){const n=e.charAt(s);if("~"===n){if(s==e.length-1){r+="~";continue}const t=e.charAt(s+1);m(t)||E(t)?(r+="\\"+t,s++):(r+=t,s++)}else m(n)?r+="."+n:E(n)?r+="\\"+n:r+=t?n:n.toLowerCase()}return r}(e,this.config.caseSensitive):function(e,t){let r="";for(let s=0;s<e.length;s++){const n=e.charAt(s);m(n)||E(n)?r+="\\"+n:r+=t?n:n.toLowerCase()}return r}(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=A(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if("string"==typeof e||"string"==typeof t){const r="string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):e,s="string"==typeof t?this.dateTimeHelper.dateStringToDateNumber(t):t;if((0,u.isExtendedNumber)(r)&&(0,u.isExtendedNumber)(s))return this.floatCmp(r,s)}return e===u.EmptyValue?e=p(t):t===u.EmptyValue&&(t=p(e)),"string"==typeof e&&"string"==typeof t?this.stringCmp(e,t):"boolean"==typeof e&&"boolean"==typeof t?c(d(e),d(t)):(0,u.isExtendedNumber)(e)&&(0,u.isExtendedNumber)(t)?this.floatCmp(e,t):e===u.EmptyValue&&t===u.EmptyValue?0:c((0,a.CellValueTypeOrd)((0,a.getCellValueType)(e)),(0,a.CellValueTypeOrd)((0,a.getCellValueType)(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const t of e)if(t instanceof l.SimpleRangeValue)r.push(t);else{const e=(0,u.getRawValue)(this.coerceScalarToNumberOrError(t));if(e instanceof a.CellError)return e;r.push(e)}const s=[];for(const e of r)if(e instanceof l.SimpleRangeValue){const r=t(e.valuesFromTopLeftCorner());if(r instanceof a.CellError)return r;s.push(...r)}else s.push(e);return s}coerceStringToComplex(e){const t=h.exec(e);if(null===t)return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ComplexNumberExpected);let r,s;return r=void 0!==t[6]?"-"===t[1]?[0,-1]:[0,1]:this.parseComplexToken(t[1]+t[3],t[5]),r instanceof a.CellError||void 0===t[8]?r:(s=void 0!==t[14]?"-"===t[9]?[0,-1]:[0,1]:this.parseComplexToken(t[9]+t[11],t[13]),s instanceof a.CellError?s:""!==t[5]||""===t[13]?new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ComplexNumberExpected):"+"===t[8]?[r[0]+s[0],r[1]+s[1]]:[r[0]-s[0],r[1]-s[1]])}parseComplexToken(e,t){const r=(0,u.getRawValue)(this.coerceNonDateScalarToMaybeNumber(e));return void 0===r?new a.CellError(a.ErrorType.NUM,o.ErrorMessage.ComplexNumberExpected):""===t?[r,0]:[0,r]}};const g=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function E(e){return g.includes(e)}function T(e,t){const{type:r,format:s}=(0,u.getTypeFormatOfExtendedNumber)(e),{type:n,format:a}=(0,u.getTypeFormatOfExtendedNumber)(t);if(r===u.NumberType.NUMBER_RAW)return{type:n,format:a};if(n===u.NumberType.NUMBER_RAW)return{type:r,format:s};if(!(r!==u.NumberType.NUMBER_DATETIME&&r!==u.NumberType.NUMBER_DATE||n!==u.NumberType.NUMBER_DATETIME&&n!==u.NumberType.NUMBER_DATE))return{type:u.NumberType.NUMBER_RAW};if(r===u.NumberType.NUMBER_TIME){if(n===u.NumberType.NUMBER_DATE)return{type:u.NumberType.NUMBER_DATETIME,format:a+" "+s};if(n===u.NumberType.NUMBER_DATETIME)return{type:u.NumberType.NUMBER_DATETIME,format:a}}if(n===u.NumberType.NUMBER_TIME){if(r===u.NumberType.NUMBER_DATE)return{type:u.NumberType.NUMBER_DATETIME,format:s+" "+a};if(r===u.NumberType.NUMBER_DATETIME)return{type:u.NumberType.NUMBER_DATETIME,format:s}}return{type:r,format:s}}function y(e,t){let{type:r,format:s}=(0,u.getTypeFormatOfExtendedNumber)(e),{type:n,format:a}=(0,u.getTypeFormatOfExtendedNumber)(t);return r===u.NumberType.NUMBER_PERCENT&&(r=u.NumberType.NUMBER_RAW,s=void 0),n===u.NumberType.NUMBER_PERCENT&&(n=u.NumberType.NUMBER_RAW,a=void 0),r===u.NumberType.NUMBER_RAW?{type:n,format:a}:n===u.NumberType.NUMBER_RAW?{type:r,format:s}:{type:u.NumberType.NUMBER_RAW}}function A(e,t){return"function"==typeof e.normalize?e.normalize(t.toUpperCase()):n.default[t](e)}},function(e,r){e.exports=t},function(e,t,r){"use strict";t.__esModule=!0,t.collatorFromConfig=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e){const t=e.caseSensitive?e.accentSensitive?"variant":"case":e.accentSensitive?"accent":"base",r=e.caseFirst,s=e.ignorePunctuation;return new Intl.Collator(e.localeLang,{sensitivity:t,caseFirst:r,ignorePunctuation:s})}},function(e,t,r){"use strict";t.__esModule=!0,t.TimeNumber=t.RichNumber=t.PercentNumber=t.NumberType=t.EmptyValue=t.DateTimeNumber=t.DateNumber=t.CurrencyNumber=void 0,t.cloneNumber=function(e,t){if("number"==typeof e)return t;{const r=e.fromNumber(t);return r.format=e.format,r}},t.getFormatOfExtendedNumber=function(e){return e instanceof n?e.format:void 0},t.getRawValue=function(e){return e instanceof n?e.val:e},t.getTypeFormatOfExtendedNumber=function(e){return e instanceof n?{type:e.getDetailedType(),format:e.format}:{type:a.NUMBER_RAW}},t.getTypeOfExtendedNumber=function(e){return e instanceof n?e.getDetailedType():a.NUMBER_RAW},t.isExtendedNumber=function(e){return"number"==typeof e||e instanceof n};
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const s=Symbol("Empty value");t.EmptyValue=s;class n{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}t.RichNumber=n;t.DateNumber=class extends n{getDetailedType(){return a.NUMBER_DATE}};t.CurrencyNumber=class extends n{getDetailedType(){return a.NUMBER_CURRENCY}};t.TimeNumber=class extends n{getDetailedType(){return a.NUMBER_TIME}};t.DateTimeNumber=class extends n{getDetailedType(){return a.NUMBER_DATETIME}};var a;t.PercentNumber=class extends n{getDetailedType(){return a.NUMBER_PERCENT}},t.NumberType=a,function(e){e.NUMBER_RAW="NUMBER_RAW",e.NUMBER_DATE="NUMBER_DATE",e.NUMBER_TIME="NUMBER_TIME",e.NUMBER_DATETIME="NUMBER_DATETIME",e.NUMBER_CURRENCY="NUMBER_CURRENCY",e.NUMBER_PERCENT="NUMBER_PERCENT"}(a||(t.NumberType=a={}))},function(e,t,r){"use strict";t.__esModule=!0,t.Statistics=t.StatType=t.EmptyStatistics=void 0;var s=r(34);t.EmptyStatistics=s.EmptyStatistics;var n=r(35);t.Statistics=n.Statistics;var a=r(36);t.StatType=a.StatType},function(e,t,r){"use strict";t.__esModule=!0,t.EmptyStatistics=void 0;var s=r(35);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.Statistics{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}t.EmptyStatistics=n},function(e,t,r){"use strict";t.__esModule=!0,t.Statistics=void 0;var s=r(36);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.Statistics=class{constructor(){this.stats=new Map([[s.StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0],[s.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=(null!==(e=this.stats.get(s.StatType.CRITERION_FUNCTION_FULL_CACHE_USED))&&void 0!==e?e:0)+1;this.stats.set(s.StatType.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=(null!==(e=this.stats.get(s.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED))&&void 0!==e?e:0)+1;this.stats.set(s.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(s.StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(s.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),s=this.startTimes.get(e);if(!s)throw Error(`Statistics ${e} not started`);{let n=null!==(t=this.stats.get(e))&&void 0!==t?t:0;n+=r-s,this.stats.set(e,n),this.startTimes.delete(e)}}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}},function(e,t,r){"use strict";
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
var s;t.__esModule=!0,t.StatType=void 0,t.StatType=s,function(e){e.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",e.PARSER="PARSER",e.GRAPH_BUILD="GRAPH_BUILD",e.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",e.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",e.TOP_SORT="TOP_SORT",e.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",e.EVALUATION="EVALUATION",e.VLOOKUP="VLOOKUP",e.TRANSFORM_ASTS="TRANSFORM_ASTS",e.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",e.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",e.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",e.ADJUSTING_RANGES="ADJUSTING_RANGES",e.ADJUSTING_GRAPH="ADJUSTING_GRAPH",e.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",e.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"}(s||(t.StatType=s={}))},function(e,t,r){"use strict";t.__esModule=!0,t.AddressMapping=void 0;var s=r(5),n=r(32),a=r(2);t.AddressMapping=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new s.NoSheetWithIdError(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new s.NoSheetWithIdError(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(void 0===t)throw new s.NoSheetWithIdError(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t,r){const{height:s,width:n,fill:a}=r,o=this.policy.call(a);this.addSheet(e,new o(n,s))}getCellValue(e){const t=this.getCell(e);return void 0===t?n.EmptyValue:t instanceof a.ArrayVertex?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof a.ValueCellVertex?t.getValues().rawValue:t instanceof a.ArrayVertex?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const s=r.getCell(e);if(void 0===s)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,s),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return void 0!==t&&t.has(e)}getHeight(e){const t=this.mapping.get(e);if(void 0===t)throw new s.NoSheetWithIdError(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new s.NoSheetWithIdError(e);return t.getWidth()}addRows(e,t,r){const n=this.mapping.get(e);if(void 0===n)throw new s.NoSheetWithIdError(e);n.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new s.NoSheetWithIdError(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const n=this.mapping.get(e);if(void 0===n)throw new s.NoSheetWithIdError(e);n.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new s.NoSheetWithIdError(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(void 0===t)throw new s.NoSheetWithIdError(e);yield*t.getEntries(e)}}},function(e,t,r){"use strict";t.__esModule=!0,t.ArrayMapping=void 0;var s=r(1);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.ArrayMapping=class{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(null==t?void 0:t.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get((0,s.addressKey)(e))}setArray(e,t){this.arrayMapping.set((0,s.addressKey)(e.start),t)}removeArray(e){"string"==typeof e?this.arrayMapping.delete(e):this.arrayMapping.delete((0,s.addressKey)(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,(e,s)=>{const n=s.getRange();return t<=n.start.row?[n.shifted(0,r),s]:void 0})}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,(e,s)=>{const n=s.getRange();return t<=n.start.col?[n.shifted(r,0),s]:void 0})}updateArrayVerticesInSheet(e,t){const r=Array();for(const[s,n]of this.arrayMapping.entries()){if(n.sheet!==e)continue;const a=t(s,n);void 0!==a&&(this.removeArray(s),r.push(a))}r.forEach(([e,t])=>{this.setArray(e,t)})}}},function(e,t,r){"use strict";t.__esModule=!0,t.collectAddressesDependentToRange=void 0;var s=r(6),n=r(40),a=r(42);t.collectAddressesDependentToRange=(e,t,r,o,i)=>{if(t instanceof a.RangeVertex){const e=t.range.intersectionWith(r);return void 0!==e?Array.from(e.addresses(i)):[]}let u,l;return t instanceof n.FormulaVertex?(u=t.getFormula(o),l=t.getAddress(o),(0,s.collectDependencies)(u,e).filter(e=>e instanceof s.AddressDependency).map(e=>e.dependency.toSimpleCellAddress(l)).filter(e=>r.addressInRange(e))):[]}},function(e,t,r){"use strict";t.__esModule=!0,t.FormulaVertex=t.FormulaCellVertex=t.ArrayVertex=void 0;var s=r(4),n=r(26),a=r(41),o=r(1),i=r(18),u=r(32),l=r(22);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class h{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,s){return r.isScalar()?new p(e,t,s):new d(e,t,r,s)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,s]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=s}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}t.FormulaVertex=h;class d extends h{constructor(e,t,r,s=0){super(e,t,s),r.isRef?this.array=new a.ErroredArray(new o.CellError(o.ErrorType.REF,i.ErrorMessage.NoSpaceForArrayResult),n.ArraySize.error()):this.array=new a.NotComputedArray(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof o.CellError)return this.setErrorValue(e),e;const t=a.ArrayValue.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof a.NotComputedArray)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof a.NotComputedArray))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch(e){return new o.CellError(o.ErrorType.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);return t instanceof o.CellError||t===u.EmptyValue?void 0:(0,u.getRawValue)(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,s=e.row-this.cellAddress.row;this.array instanceof a.ArrayValue&&this.array.set(r,s,t)}setNoSpace(){return this.array=new a.ErroredArray(new o.CellError(o.ErrorType.SPILL,i.ErrorMessage.NoSpaceForArrayResult),n.ArraySize.error()),this.getCellValue()}getRange(){return s.AbsoluteCellRange.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return s.AbsoluteCellRange.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof a.NotComputedArray)}columnsFromArray(){return l.ColumnsSpan.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return l.RowsSpan.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return(0,o.equalSimpleCellAddress)(this.cellAddress,e)}setErrorValue(e){this.array=new a.ErroredArray(e,this.array.size)}}t.ArrayVertex=d;class p extends h{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(void 0!==this.cachedCellValue)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return void 0!==this.cachedCellValue}}t.FormulaCellVertex=p},function(e,t,r){"use strict";t.__esModule=!0,t.NotComputedArray=t.ErroredArray=t.ArrayValue=void 0;var s=r(26),n=r(32),a=r(25);t.NotComputedArray=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}};class o{constructor(e){this.size=new s.ArraySize(e.length>0?e[0].length:0,e.length),this.array=e}static fromInterpreterValue(e){return e instanceof a.SimpleRangeValue?new o(e.data):new o([[e]])}simpleRangeValue(){return a.SimpleRangeValue.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(n.EmptyValue));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const t of this.array)t.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let s=0;s<e;++s)r.push(new Array(t).fill(n.EmptyValue));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height)throw"Resizing to smaller array";if(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width)throw"Resizing to smaller array"}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}t.ArrayValue=o;t.ErroredArray=class{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}},function(e,t,r){"use strict";t.__esModule=!0,t.RangeVertex=void 0;t.RangeVertex=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return null===(r=this.getCriterionFunctionValues(e).get(t))||void 0===r?void 0:r[0]}getCriterionFunctionValues(e){var t;return null!==(t=this.criterionFunctionCache.get(e))&&void 0!==t?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(e=>e.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}},function(e,t,r){"use strict";
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
var s;t.__esModule=!0,t.Graph=void 0,function(e){e[e.ON_STACK=0]="ON_STACK",e[e.PROCESSED=1]="PROCESSED",e[e.POPPED=2]="POPPED"}(s||(s={}));t.Graph=class{constructor(e){this.dependencyQuery=e,this.nodes=new Set,this.specialNodes=new Set,this.specialNodesStructuralChanges=new Set,this.specialNodesRecentlyChanged=new Set,this.infiniteRanges=new Set,this.edges=new Map}addNode(e){this.nodes.add(e),this.edges.has(e)||this.edges.set(e,new Set)}addEdge(e,t){if(!this.nodes.has(e))throw new Error("Unknown node "+e);if(!this.nodes.has(t))throw new Error("Unknown node "+t);this.edges.get(e).add(t)}removeEdge(e,t){if(!this.existsEdge(e,t))throw new Error("Edge does not exist");this.edges.get(e).delete(t)}softRemoveEdge(e,t){var r;null===(r=this.edges.get(e))||void 0===r||r.delete(t)}removeIncomingEdges(e){this.edges.forEach(t=>{t.delete(e)})}adjacentNodes(e){return this.edges.get(e)}adjacentNodesCount(e){return this.adjacentNodes(e).size}hasNode(e){return this.nodes.has(e)}nodesCount(){return this.nodes.size}edgesCount(){let e=0;return this.edges.forEach(t=>e+=t.size),e}removeNode(e){for(const t of this.adjacentNodes(e).values())this.markNodeAsSpecialRecentlyChanged(t);return this.edges.delete(e),this.nodes.delete(e),this.specialNodes.delete(e),this.specialNodesRecentlyChanged.delete(e),this.specialNodesStructuralChanges.delete(e),this.infiniteRanges.delete(e),this.removeDependencies(e)}markNodeAsSpecial(e){this.specialNodes.add(e)}markNodeAsSpecialRecentlyChanged(e){this.nodes.has(e)&&this.specialNodesRecentlyChanged.add(e)}markNodeAsChangingWithStructure(e){this.specialNodesStructuralChanges.add(e)}clearSpecialNodesRecentlyChanged(){this.specialNodesRecentlyChanged.clear()}markNodeAsInfiniteRange(e){this.infiniteRanges.add(e)}existsEdge(e,t){var r,s;return null!==(s=null===(r=this.edges.get(e))||void 0===r?void 0:r.has(t))&&void 0!==s&&s}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(Array.from(this.nodes),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(e,t,r){const n=new Map,a=new Map,o=new Map,i=new Set,u=new Map,l=[];let h=0;const d=new Set;e.reverse(),e.forEach(e=>{if(void 0!==u.get(e))return;const t=[e],r=[];for(u.set(e,s.ON_STACK);t.length>0;){const e=t[t.length-1];switch(u.get(e)){case s.ON_STACK:n.set(e,h),a.set(e,h),r.push(e),h++,this.adjacentNodes(e).forEach(r=>{void 0===n.get(r)&&(t.push(r),o.set(r,e),u.set(r,s.ON_STACK))}),u.set(e,s.PROCESSED);break;case s.PROCESSED:{let h;if(h=n.get(e),this.adjacentNodes(e).forEach(t=>{i.has(t)||(h=o.get(t)===e?Math.min(h,a.get(t)):Math.min(h,n.get(t)))}),a.set(e,h),h===n.get(e)){const t=[];do{t.push(r[r.length-1]),r.pop()}while(t[t.length-1]!==e);t.forEach(e=>{i.add(e)}),l.push(...t),t.length>1&&t.forEach(e=>{d.add(e)})}t.pop(),u.set(e,s.POPPED);break}case s.POPPED:t.pop()}}});const p=new Set(e),c=[],m=[];return l.reverse(),l.forEach(e=>{d.has(e)||this.adjacentNodes(e).has(e)?(m.push(e),r(e),this.adjacentNodes(e).forEach(e=>p.add(e))):(c.push(e),p.has(e)&&t(e)&&this.adjacentNodes(e).forEach(e=>p.add(e)))}),{sorted:c,cycled:m}}getDependencies(e){const t=[];return this.edges.forEach((r,s)=>{r.has(e)&&t.push(s)}),t}removeDependencies(e){const t=this.dependencyQuery(e);for(const r of t)this.softRemoveEdge(r,e);return t}}},function(e,t,r){"use strict";t.__esModule=!0,t.RangeMapping=void 0;var s=r(4),n=r(1);function a(e,t){return`${e.col},${e.row},${t.col},${t.row}`}t.RangeMapping=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return null!==(r=null===(t=this.rangeMapping.get(e))||void 0===t?void 0:t.size)&&void 0!==r?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);void 0===t&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=a(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(void 0===r)return;const s=a(e.getStart(),e.getEnd());r.delete(s),0===r.size&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),s=a(e,t);return null==r?void 0:r.get(s)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),s=Array(),n=Array(),i=e.sheet;for(const[a,o]of this.entriesFromSheet(e.sheet)){const u=o.range;e.start<=t(o.range.end)&&(u.removeSpan(e),u.shouldBeRemoved()?(this.removeByKey(i,a),r.push(o)):s.push([a,o]),n.push(o))}const u=[];s.sort((e,r)=>o(e[1],r[1],t));for(const[e,t]of s){const r=a((l=t.range).start,l.end);if(r===e)continue;const s=this.getByKey(i,r);this.removeByKey(i,e),void 0!==s&&t!=s?u.push([s,t]):this.setRange(t)}var l;return{verticesToRemove:r,verticesToMerge:u,verticesWithChangedSize:n}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,(e,s)=>t<=s.start.row?(s.range.shiftByRows(r),{changedSize:!1,vertex:s}):t>s.start.row&&t<=s.end.row?(s.range.expandByRows(r),{changedSize:!0,vertex:s}):void 0)}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,(e,s)=>t<=s.start.col?(s.range.shiftByColumns(r),{changedSize:!1,vertex:s}):t>s.start.col&&t<=s.end.col?(s.range.expandByColumns(r),{changedSize:!0,vertex:s}):void 0)}moveRangesInsideSourceRange(e,t,r,s){this.updateVerticesFromSheet(e.sheet,(n,a)=>e.containsRange(a.range)?(a.range.shiftByColumns(t),a.range.shiftByRows(r),a.range.moveToSheet(s),{changedSize:!1,vertex:a}):void 0)}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=(0,n.simpleCellAddress)(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(void 0!==r){return{smallerRangeVertex:r,restRange:new s.AbsoluteCellRange((0,n.simpleCellAddress)(e.start.sheet,e.start.col,e.end.row),e.end)}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return null===(r=this.rangeMapping.get(e))||void 0===r?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[s,n]of this.entriesFromSheet(e)){const a=t(s,n);void 0!==a&&(this.removeByKey(e,s),r.push(a))}return r.forEach(e=>{this.setRange(e.vertex)}),{verticesWithChangedSize:r.filter(e=>e.changedSize).map(e=>e.vertex)}}};const o=(e,t,r)=>{const s=r(e.range.start),n=r(e.range.start);if(s===n){return r(e.range.end)-r(t.range.end)}return s-n}},function(e,t,r){"use strict";t.__esModule=!0,t.SheetMapping=void 0;var s=r(5),n=r(46);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function a(e){return e.toLowerCase()}class o{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return a(this.displayName)}}t.SheetMapping=class{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=e=>{const t=this.mappingFromCanonicalName.get(a(e));if(void 0===t)throw new s.NoSheetWithNameError(e);return t.id},this.get=e=>{var t;return null===(t=this.mappingFromCanonicalName.get(a(e)))||void 0===t?void 0:t.id},this.fetchDisplayName=e=>this.fetchSheetById(e).displayName,this.sheetNamePrefix=e.getUITranslation(n.UIElement.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=a(e);if(this.mappingFromCanonicalName.has(t))throw new s.SheetNameAlreadyTakenError(e);this.lastSheetId++;const r=new o(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return null===(t=this.mappingFromId.get(e))||void 0===t?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(a(e))}renameSheet(e,t){const r=this.fetchSheetById(e),n=r.displayName;if(n===t)return;const o=this.mappingFromCanonicalName.get(a(t));if(void 0!==o&&o.id!==r.id)throw new s.SheetNameAlreadyTakenError(t);const i=r.canonicalName;return this.mappingFromCanonicalName.delete(i),r.displayName=t,this.store(r),n}sheetNames(){return Array.from(this.mappingFromId.values()).map(e=>e.displayName)}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(void 0===t)throw new s.NoSheetWithIdError(e);return t}}},function(e,t,r){"use strict";t.__esModule=!0,t.UIElement=void 0;var s,n=r(47);t.buildTranslationPackage=n.buildTranslationPackage,t.TranslationPackage=n.TranslationPackage,t.UIElement=s,function(e){e.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"}(s||(t.UIElement=s={}))},function(e,t,r){"use strict";t.__esModule=!0,t.TranslationPackage=void 0,t.buildTranslationPackage=function(e){return new o(Object.assign({},e.functions),Object.assign({},e.errors),Object.assign({},e.ui))};var s=r(1),n=r(5),a=r(46);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce((e,t)=>(e[this.functions[t]]=t,e),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((e,t)=>(e[this.errors[t]]=t,e),{})}isFunctionTranslated(e){return void 0!==this.functions[e]}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(void 0===t)throw new n.MissingTranslationError("functions."+e);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===s.ErrorType.LIC)return`#${s.ErrorType.LIC}!`;const t=this.errors[e];if(void 0===t)throw new n.MissingTranslationError("errors."+e);return t}getUITranslation(e){const t=this.ui[e];if(void 0===t)throw new n.MissingTranslationError("ui."+e);return t}checkUI(){for(const e of Object.values(a.UIElement))if(!(e in this.ui))throw new n.MissingTranslationError("ui."+e)}checkErrors(){for(const e of Object.values(s.ErrorType))if(!(e in this.errors)&&e!==s.ErrorType.LIC)throw new n.MissingTranslationError("errors."+e)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const e of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(e))throw new n.ProtectedFunctionTranslationError(e)}}t.TranslationPackage=o},function(e,t,r){"use strict";t.__esModule=!0,t.EmptyCellVertex=void 0;var s=r(32);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.EmptyCellVertex=class{constructor(e){this.address=e}getCellValue(){return s.EmptyValue}}},function(e,t,r){"use strict";t.__esModule=!0,t.ValueCellVertex=void 0;t.ValueCellVertex=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}setCellValue(e){throw"SetCellValue is deprecated for ValueCellVertex"}}},function(e,t,r){"use strict";t.__esModule=!0,t.ParsingErrorVertex=void 0;var s=r(1);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.ParsingErrorVertex=class{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){return s.CellError.parsingError()}getFormula(){return this.rawInput}}},function(e,t,r){"use strict";t.__esModule=!0,t.SparseStrategy=void 0;var s=r(1);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.SparseStrategy=class{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return null===(t=this.mapping.get(e.col))||void 0===t?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(null===(t=this.mapping.get(e.col))||void 0===t?void 0:t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;null===(t=this.mapping.get(e.col))||void 0===t||t.delete(e.row)}addRows(e,t){this.mapping.forEach(r=>{const s=new Map;r.forEach((n,a)=>{a>=e&&(s.set(a+t,n),r.delete(a))}),s.forEach((e,t)=>{r.set(t,e)})}),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach((s,n)=>{n>=e&&(r.set(n+t,s),this.mapping.delete(n))}),r.forEach((e,t)=>{this.mapping.set(t,e)}),this.width+=t}removeRows(e){this.mapping.forEach(t=>{const r=new Map;t.forEach((s,n)=>{n>=e.rowStart&&(t.delete(n),n>e.rowEnd&&r.set(n-e.numberOfRows,s))}),r.forEach((e,r)=>{t.set(r,e)})});const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach((r,s)=>{s>=e.columnStart&&(this.mapping.delete(s),s>e.columnEnd&&t.set(s-e.numberOfColumns,r))}),t.forEach((e,t)=>{this.mapping.set(t,e)});const r=Math.min(this.width-1,e.columnEnd),s=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-s)}*getEntries(e){for(const[t,r]of this.mapping)for(const[n,a]of r)yield[(0,s.simpleCellAddress)(e,t,n),a]}*verticesFromColumn(e){const t=this.mapping.get(e);if(void 0!==t)for(const[e,r]of t)yield r}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);void 0!==r&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const e=this.mapping.get(t);if(void 0!==e)for(const[t,r]of e)yield r}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const e=t.get(r);void 0!==e&&(yield e)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const n of e.rows()){const a=r.get(n);void 0!==a&&(yield[(0,s.simpleCellAddress)(e.sheet,t,n),a])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(void 0!==r)for(const[n,a]of r.entries())yield[(0,s.simpleCellAddress)(e.sheet,t,n),a]}}*vertices(){for(const[e,t]of this.mapping)for(const[e,r]of t)void 0!==r&&(yield r)}}},function(e,t,r){"use strict";t.__esModule=!0,t.DenseStrategy=void 0;var s=r(1);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.DenseStrategy=class{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return!!t&&!!t[e.col]}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){void 0!==this.mapping[e.row]&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let e=0;e<t;e++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let t=0;t<this.height;t++)this.mapping[t].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const n=this.getCellVertex(r,t);n&&(yield[(0,s.simpleCellAddress)(e,r,t),n])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let e=0;e<this.height;++e){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const e=this.getCellVertex(t,r);e&&(yield e)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield[(0,s.simpleCellAddress)(e.sheet,t,r),n])}}*entriesFromColumnsSpan(e){for(let t=0;t<this.height;++t)for(let r=e.columnStart;r<=e.columnEnd;++r){const n=this.getCellVertex(r,t);n&&(yield[(0,s.simpleCellAddress)(e.sheet,r,t),n])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return null===(r=this.mapping[t])||void 0===r?void 0:r[e]}}},function(e,t,r){"use strict";t.__esModule=!0,t.DetailedCellError=void 0;t.DetailedCellError=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r){var s;this.value=t,this.address=r,this.type=e.type,this.message=null!==(s=e.message)&&void 0!==s?s:""}toString(){return this.value}valueOf(){return this.value}}},function(e,t,r){"use strict";t.__esModule=!0,t.Config=void 0,t.getDefaultConfig=function(){return c({})};var s=r(55),n=r(56),a=r(57),o=r(58),i=r(5),u=r(59),l=r(61),h=r(63);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const d=new WeakMap;class p{constructor(e={},t=!0){const{accentSensitive:r,binarySearchThreshold:n,caseSensitive:o,caseFirst:i,chooseAddressMappingPolicy:u,currencySymbol:c,dateFormats:m,decimalSeparator:g,evaluateNullToZero:E,functionArgSeparator:T,functionPlugins:y,ignorePunctuation:A,leapYear1900:f,localeLang:R,language:N,ignoreWhiteSpace:C,licenseKey:S,matchWholeCell:M,arrayColumnSeparator:w,arrayRowSeparator:v,maxRows:O,maxColumns:I,nullYear:b,nullDate:F,parseDateTime:V,precisionEpsilon:U,precisionRounding:x,stringifyDateTime:L,stringifyDuration:P,smartRounding:_,timeFormats:B,thousandSeparator:D,useArrayArithmetic:G,useStats:H,undoLimit:W,useColumnIndex:k,useRegularExpressions:z,useWildcards:Y}=e;t&&p.warnDeprecatedOptions(e),this.useArrayArithmetic=(0,s.configValueFromParam)(G,"boolean","useArrayArithmetic"),this.accentSensitive=(0,s.configValueFromParam)(r,"boolean","accentSensitive"),this.caseSensitive=(0,s.configValueFromParam)(o,"boolean","caseSensitive"),this.caseFirst=(0,s.configValueFromParam)(i,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=(0,s.configValueFromParam)(A,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=null!=u?u:p.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...(0,s.configValueFromParamCheck)(m,Array.isArray,"array","dateFormats")],this.timeFormats=[...(0,s.configValueFromParamCheck)(B,Array.isArray,"array","timeFormats")],this.functionArgSeparator=(0,s.configValueFromParam)(T,"string","functionArgSeparator"),this.decimalSeparator=(0,s.configValueFromParam)(g,[".",","],"decimalSeparator"),this.language=(0,s.configValueFromParam)(N,"string","language"),this.ignoreWhiteSpace=(0,s.configValueFromParam)(C,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=(0,s.configValueFromParam)(S,"string","licenseKey"),this.thousandSeparator=(0,s.configValueFromParam)(D,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=(0,s.configValueFromParam)(w,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=(0,s.configValueFromParam)(v,[";","|"],"arrayRowSeparator"),this.localeLang=(0,s.configValueFromParam)(R,"string","localeLang"),this.functionPlugins=[...null!=y?y:p.defaultConfig.functionPlugins],this.smartRounding=(0,s.configValueFromParam)(_,"boolean","smartRounding"),this.evaluateNullToZero=(0,s.configValueFromParam)(E,"boolean","evaluateNullToZero"),this.nullYear=(0,s.configValueFromParam)(b,"number","nullYear"),(0,s.validateNumberToBeAtLeast)(this.nullYear,"nullYear",0),(0,s.validateNumberToBeAtMost)(this.nullYear,"nullYear",100),this.precisionRounding=(0,s.configValueFromParam)(x,"number","precisionRounding"),(0,s.validateNumberToBeAtLeast)(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=(0,s.configValueFromParam)(U,"number","precisionEpsilon"),(0,s.validateNumberToBeAtLeast)(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=(0,s.configValueFromParam)(k,"boolean","useColumnIndex"),this.useStats=(0,s.configValueFromParam)(H,"boolean","useStats"),this.binarySearchThreshold=null!=n?n:p.defaultConfig.binarySearchThreshold,this.parseDateTime=(0,s.configValueFromParam)(V,"function","parseDateTime"),this.stringifyDateTime=(0,s.configValueFromParam)(L,"function","stringifyDateTime"),this.stringifyDuration=(0,s.configValueFromParam)(P,"function","stringifyDuration"),this.translationPackage=h.HyperFormula.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=(0,s.configValueFromParamCheck)(F,a.instanceOfSimpleDate,"IDate","nullDate"),this.leapYear1900=(0,s.configValueFromParam)(f,"boolean","leapYear1900"),this.undoLimit=(0,s.configValueFromParam)(W,"number","undoLimit"),this.useRegularExpressions=(0,s.configValueFromParam)(z,"boolean","useRegularExpressions"),this.useWildcards=(0,s.configValueFromParam)(Y,"boolean","useWildcards"),this.matchWholeCell=(0,s.configValueFromParam)(M,"boolean","matchWholeCell"),(0,s.validateNumberToBeAtLeast)(this.undoLimit,"undoLimit",0),this.maxRows=(0,s.configValueFromParam)(O,"number","maxRows"),(0,s.validateNumberToBeAtLeast)(this.maxRows,"maxRows",1),this.maxColumns=(0,s.configValueFromParam)(I,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(c),(0,s.validateNumberToBeAtLeast)(this.maxColumns,"maxColumns",1),d.set(this,{licenseKeyValidityState:(0,l.checkLicenseKeyValidity)(this.licenseKey)}),(0,s.configCheckIfParametersNotInConflict)({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),(0,s.configCheckIfParametersNotInConflict)({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...(0,s.configValueFromParamCheck)(e,Array.isArray,"array","currencySymbol")];return t.forEach(e=>{if("string"!=typeof e)throw new i.ExpectedValueOfTypeError("string[]","currencySymbol");if(""===e)throw new i.ConfigValueEmpty("currencySymbol")}),t}get licenseKeyValidityState(){return d.get(this).licenseKeyValidityState}getConfig(){return c(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return p.warnDeprecatedOptions(e),new p(t,!1)}static warnDeprecatedOptions(e){p.warnDeprecatedIfUsed(e.binarySearchThreshold,"binarySearchThreshold","1.1")}static warnDeprecatedIfUsed(e,t,r,s){void 0!==e&&(void 0===s?console.warn(`${t} option is deprecated since ${r}`):console.warn(`${t} option is deprecated since ${r}, please use ${s}`))}}function c(e){var t;const r={};for(const s in p.defaultConfig){const n=null!==(t=e[s])&&void 0!==t?t:p.defaultConfig[s];Array.isArray(n)?r[s]=[...n]:r[s]=n}return r}t.Config=p,p.defaultConfig={accentSensitive:!1,binarySearchThreshold:20,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",chooseAddressMappingPolicy:new o.AlwaysDense,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:n.defaultParseToDateTime,precisionEpsilon:1e-13,precisionRounding:14,smartRounding:!0,stringifyDateTime:u.defaultStringifyDateTime,stringifyDuration:u.defaultStringifyDuration,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1}},function(e,t,r){"use strict";t.__esModule=!0,t.configCheckIfParametersNotInConflict=function(...e){const t=new Map;e.forEach(e=>{const r=t.get(e.value)||[];r.push(e.name),t.set(e.value,r)});const r=[];for(const e of t.values())e.length>1&&r.push(e);if(r.length>0){r.forEach(e=>e.sort());const e=r.map(e=>`[${e}]`).join("; ");throw new Error("Config initialization failed. Parameters in conflict: "+e)}},t.configValueFromParam=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e,t,r){if(void 0===e)return s.Config.defaultConfig[r];if("string"==typeof t){if(typeof e===t)return e;throw new n.ExpectedValueOfTypeError(t,r)}if(t.includes(e))return e;throw new n.ExpectedOneOfValuesError(t.map(e=>`'${e}'`).join(" "),r)},t.configValueFromParamCheck=function(e,t,r,a){if(t(e))return e;if(void 0===e)return s.Config.defaultConfig[a];throw new n.ExpectedValueOfTypeError(r,a)},t.validateArgToType=function(e,t,r){if(typeof e!==t)throw new n.ExpectedValueOfTypeError(t,r)},t.validateNumberToBeAtLeast=function(e,t,r){if(e<r)throw new n.ConfigValueTooSmallError(t,r)},t.validateNumberToBeAtMost=function(e,t,r){if(e>r)throw new n.ConfigValueTooBigError(t,r)};var s=r(54),n=r(5)},function(e,t,r){"use strict";t.__esModule=!0,t.defaultParseToDateTime=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e,t,r){let s=(e=e.replace(/\s\s+/g," ").trim().toLowerCase()).substring(e.length-2);"am"===s||"pm"===s?e=e.substring(0,e.length-2).trim():(s=e.substring(e.length-1),"a"===s||"p"===s?e=e.substring(0,e.length-1).trim():s=void 0);const o=e.split(/[ /.-]/g);o.length>=2&&o[o.length-2].includes(":")&&(o[o.length-2]=o[o.length-2]+"."+o[o.length-1],o.pop());const i=o[o.length-1].split(":");void 0!==s&&i.push(s);if(1===o.length)return n(i,r);if(1===i.length)return a(o,t);const u=a(o.slice(0,o.length-1),t),l=n(i,r);return void 0===u||void 0===l?void 0:Object.assign(Object.assign({},u),l)},t.secondsExtendedRegexp=void 0;const s=/^ss\.(s+|0+)$/;function n(e,t){if(void 0===t)return;(t=t.toLowerCase()).endsWith("am/pm")?t=t.substring(0,t.length-5).trim():t.endsWith("a/p")&&(t=t.substring(0,t.length-3).trim());const r=t.split(":");let n=void 0;"am"===e[e.length-1]||"a"===e[e.length-1]?(n=!1,e.pop()):"pm"!==e[e.length-1]&&"p"!==e[e.length-1]||(n=!0,e.pop());let a=0;if(r.length>=1&&s.test(r[r.length-1])&&(a=r[r.length-1].length-3,r[r.length-1]="ss"),e.length!==r.length)return;const o=r.indexOf("hh"),i=r.indexOf("mm"),u=r.indexOf("ss"),l=-1!==o?e[o]:"0";if(!/^\d+$/.test(l))return;let h=Number(l);if(void 0!==n){if(h<0||h>12)return;h%=12,n&&(h+=12)}const d=-1!==i?e[i]:"0";if(!/^\d+$/.test(d))return;const p=Number(d),c=-1!==u?e[u]:"0";if(!/^\d+(\.\d+)?$/.test(c))return;let m=Number(c);return m=Math.round(m*Math.pow(10,a))/Math.pow(10,a),{hours:h,minutes:p,seconds:m}}function a(e,t){if(void 0===t)return;const r=t.toLowerCase().split(/[ /.-]/g);if(e.length!==r.length)return;const s=r.indexOf("mm"),n=r.indexOf("dd"),a=r.indexOf("yyyy"),o=r.indexOf("yy");if(!(s in e)||!(n in e)||!(a in e)&&!(o in e))return;if(a in e&&o in e)return;let i;if(a in e){const t=e[a];if(!/^\d+$/.test(t))return;if(i=Number(t),i<1e3||i>9999)return}else{const t=e[o];if(!/^\d+$/.test(t))return;if(i=Number(t),i<0||i>99)return}const u=e[s];if(!/^\d+$/.test(u))return;const l=Number(u),h=e[n];if(!/^\d+$/.test(h))return;return{year:i,month:l,day:Number(h)}}t.secondsExtendedRegexp=s},function(e,t,r){"use strict";t.__esModule=!0,t.DateTimeHelper=void 0,t.instanceOfSimpleDate=o,t.instanceOfSimpleTime=i,t.maxDate=void 0,t.numberToSimpleTime=l,t.offsetMonth=function(e,t){const r=12*e.year+e.month-1+t;return{year:Math.floor(r/12),month:r%12+1,day:e.day}},t.roundToNearestSecond=function(e){return Math.round(3600*e*24)/86400},t.timeToNumber=h,t.toBasisEU=function(e){return{year:e.year,month:e.month,day:Math.min(30,e.day)}},t.truncateDayInMonth=function(e){return{year:e.year,month:e.month,day:Math.min(e.day,n[e.month-1])}};var s=r(32);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */const n=[31,28,31,30,31,30,31,31,30,31,30,31],a=[0,31,59,90,120,151,181,212,243,273,304,334];function o(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("year"in e&&"number"==typeof e.year&&"month"in e&&"number"==typeof e.month&&"day"in e&&"number"==typeof e.day)}function i(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("hours"in e&&"number"==typeof e.hours&&"minutes"in e&&"number"==typeof e.minutes&&"seconds"in e&&"number"==typeof e.seconds)}const u={year:9999,month:12,day:31};t.maxDate=u;function l(e){e=Math.round(24*e*60*60*1e5)/864e7,e*=24;const t=Math.floor(e);e-=t,e*=60;const r=Math.floor(e);e-=r,e*=60;return{hours:t,minutes:r,seconds:Math.round(1e5*e)/1e5}}function h(e){return((e.seconds/60+e.minutes)/60+e.hours)/24}t.DateTimeHelper=class{constructor(e){this.config=e,this.minDateAboluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(u),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:n=""}=this.parseDateTimeFromConfigFormats(e);if(void 0!==t)return i(t)?o(t)?new s.DateTimeNumber(h(t)+this.dateToNumber(t),r+" "+n):new s.TimeNumber(h(t),n):o(t)?new s.DateNumber(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return!(isNaN(e.year)||isNaN(e.month)||isNaN(e.day))&&(e.day===Math.round(e.day)&&e.month===Math.round(e.month)&&e.year===Math.round(e.year)&&(!(e.year<1582)&&(!(e.month<1||e.month>12)&&(!(e.day<1)&&(this.isLeapYear(e.year)&&2===e.month?e.day<=29:e.day<=n[e.month-1])))))}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAboluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAboluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAboluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const s=t-this.dateToNumberFromZero({year:r,month:1,day:1}),n=function(e){let t=0;a[t+6]<=e&&(t+=6);a[t+3]<=e&&(t+=3);a[t+2]<=e?t+=2:a[t+1]<=e&&(t+=1);return t}(s-(this.isLeapYear(r)&&s>=59?1:0));return{year:r,month:n+1,day:s-a[n]-(this.isLeapYear(r)&&n>1?1:0)+1}}numberToSimpleDateTime(e){return Object.assign(Object.assign({},this.numberToSimpleDate(Math.floor(e))),l(e%1))}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&2===t?29:n[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return 31===e.day&&(e.day=30),30===e.day&&31===t.day&&(t.day=30),2===e.month&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,2===t.month&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const s=this.parseDateTime(e,t,r);if(!o(s)||(s.year>=0&&s.year<100&&(s.year<this.getNullYear()?s.year+=2e3:s.year+=1900),this.isValidDate(s)))return s}parseDateTimeFromFormats(e,t,r){const s=0===t.length?[void 0]:t,n=0===r.length?[void 0]:r;for(const t of s)for(const r of n){const s=this.parseSingleFormat(e,t,r);if(void 0!==s)return{dateTime:s,timeFormat:r,dateFormat:t}}return{}}countLeapDays(e){return e.month>2||2===e.month&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+a[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return!(e%4)&&(!!(e%100)||(!(e%400)||1900===e&&this.config.leapYear1900))}}},function(e,t,r){"use strict";t.__esModule=!0,t.DenseSparseChooseBasedOnThreshold=t.AlwaysSparse=t.AlwaysDense=void 0;var s=r(52),n=r(51);t.DenseSparseChooseBasedOnThreshold=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.threshold=e}call(e){return e>this.threshold?s.DenseStrategy:n.SparseStrategy}};t.AlwaysSparse=class{call(){return n.SparseStrategy}};t.AlwaysDense=class{call(){return s.DenseStrategy}}},function(e,t,r){"use strict";t.__esModule=!0,t.defaultStringifyDateTime=function(e,t){const r=(0,a.parseForDateTimeFormat)(t);if(void 0===r)return;const n=r.tokens;let i="",u=!1;const l=n.some(e=>e.type===a.TokenType.FORMAT&&("a/p"===e.value||"A/P"===e.value||"am/pm"===e.value||"AM/PM"===e.value));for(let t=0;t<n.length;t++){const r=n[t];if(r.type!==a.TokenType.FREE_TEXT)if(s.secondsExtendedRegexp.test(r.value)){const t=r.value.length-3;i+=(e.seconds<10?"0":"")+Math.round(e.seconds*Math.pow(10,t))/Math.pow(10,t)}else switch(r.value.toLowerCase()){case"h":case"hh":u=!0,i+=o(l?(e.hours+11)%12+1:e.hours,r.value.length);break;case"d":case"dd":i+=o(e.day,r.value.length);break;case"s":case"ss":i+=o(Math.round(e.seconds),r.value.length);break;case"m":case"mm":t+1<n.length&&n[t+1].value.startsWith(":")&&(u=!0),i+=o(u?e.minutes:e.month,r.value.length),u=!0;break;case"yy":i+=o(e.year%100,r.value.length);break;case"yyyy":i+=e.year;break;case"am/pm":case"a/p":{const[t,s]=r.value.split("/");i+=e.hours<12?t:s;break}default:return}else i+=r.value}return i},t.defaultStringifyDuration=function(e,t){const r=(0,a.parseForDateTimeFormat)(t);if(void 0===r)return;const n=r.tokens;let i="";for(const t of n)if(t.type!==a.TokenType.FREE_TEXT)if(s.secondsExtendedRegexp.test(t.value)){const r=t.value.length-3;i+=(e.seconds<10?"0":"")+Math.round(e.seconds*Math.pow(10,r))/Math.pow(10,r)}else switch(t.value.toLowerCase()){case"h":case"hh":i+=o(e.hours,t.value.length),e.hours=0;break;case"[hh]":i+=o(e.hours,t.value.length-2),e.hours=0;break;case"m":case"mm":i+=o(e.minutes,t.value.length),e.minutes=0;break;case"[mm]":i+=o(e.minutes+60*e.hours,t.value.length-2),e.minutes=0,e.hours=0;break;case"s":case"ss":i+=o(e.seconds,t.value.length);break;default:return}else i+=t.value;return i},t.format=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e,t,r,s){const l=r.stringifyDateTime(s.numberToSimpleDateTime(e),t);if(void 0!==l)return l;const h=r.stringifyDuration((0,n.numberToSimpleTime)(e),t);if(void 0!==h)return h;const d=(0,a.parseForNumberFormat)(t);if(void 0!==d)return function(e,t){let r="";for(let s=0;s<e.length;++s){const n=e[s];if(n.type===a.TokenType.FREE_TEXT){r+=n.value;continue}const l=n.value.split("."),h=l[0],d=l[1]||"",p=l[1]?".":"",c=Number(t.toFixed(d.length)).toString().split(".");let m=c[0]||"",g=c[1]||"";if(h.length>m.length){const e=u(h.substr(0,h.length-m.length),"0");m=o(m,e+m.length)}const E=u(d.substr(g.length,d.length-g.length),"0");g=i(g,E+g.length),r+=m+p+g}return r}(d.tokens,e);return t},t.padLeft=o,t.padRight=i;var s=r(56),n=r(57),a=r(60);function o(e,t){let r=e+"";for(;r.length<t;)r="0"+r;return r}function i(e,t){let r=e+"";for(;r.length<t;)r+="0";return r}function u(e,t){return e.split(t).length-1}},function(e,t,r){"use strict";t.__esModule=!0,t.TokenType=t.FormatExpressionType=void 0,t.formatToken=i,t.isEscapeToken=d,t.parse=function(e){var t,r;return null!==(r=null!==(t=l(e))&&void 0!==t?t:h(e))&&void 0!==r?r:{type:o.STRING,tokens:[{type:a.FREE_TEXT,value:e}]}},t.parseForDateTimeFormat=l,t.parseForNumberFormat=h;
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const s=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,n=/(\\.|[#0]+(\.[#0]*)?)/g;var a,o;function i(e,t){return{type:e,value:t}}function u(e,t){const r=[];let s=0;for(let n=0;n<e.length;++n){const o=e[n];if(o.index!==s){const e=t.substr(s,o.index-s);r.push(i(a.FREE_TEXT,e))}o[0].startsWith("\\")?r.push(i(a.FREE_TEXT,o[0])):r.push(i(a.FORMAT,o[0])),s=o.index+o[0].length}const n=e[e.length-1];if(n.index+n[0].length<t.length){const e=t.substr(n.index+n[0].length,t.length);r.push(i(a.FREE_TEXT,e))}return r}function l(e){const t=function(e){s.lastIndex=0;const t=[];let r;do{r=s.exec(e),null!==r&&t.push(r)}while(r);return t}(e);return t.every(e=>d(e))?void 0:{type:o.DATE,tokens:u(t,e)}}function h(e){const t=function(e){n.lastIndex=0;const t=n.exec(e);return null!==t?[t]:[]}(e);return t.every(e=>d(e))?void 0:{type:o.NUMBER,tokens:u(t,e)}}function d(e){return e[0].startsWith("\\")}t.TokenType=a,function(e){e.FORMAT="FORMAT",e.FREE_TEXT="FREE_TEXT"}(a||(t.TokenType=a={})),t.FormatExpressionType=o,function(e){e.DATE="DATE",e.NUMBER="NUMBER",e.STRING="STRING"}(o||(t.FormatExpressionType=o={}))},function(e,t,r){"use strict";t.__esModule=!0,t.checkLicenseKeyValidity=function(e){const t={template:"missing",vars:{}};if("gpl-v3"===e||"internal-use-in-handsontable"===e)t.template="valid";else if("string"==typeof e&&(0,s.checkKeySchema)(e)){const[r,n,a]="14/06/2022".split("/"),o=Math.floor(new Date(`${n}/${r}/${a}`).getTime()/864e5),i=(0,s.extractTime)(e);t.vars.keyValidityDate=function(e){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],r=e.getDate(),s=e.getFullYear();return`${t} ${r}, ${s}`}(new Date(864e5*(i+1))),t.template=o>i?"expired":"valid"}else""!==e&&(t.template="invalid");a||"valid"===t.template||(console.warn(n[t.template](t.vars)),a=!0);return t.template};var s=r(62);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */const n={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:e})=>`The license key for HyperFormula expired on ${e}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let a=!1},function(e,t,r){"use strict";t.__esModule=!0,t.checkKeySchema=function(e){if((e=(e+"").replace(/\-/g,""))[s]!==u("Z"))return!1;let t=0;return[[0,u("G")+1],[u("H"),u("H")-1],[u("G")+u("H"),u("G")]].reduce((r,[s,o],u)=>(r|=(a(""+a(n(i(e,t+s-(0===u?0:2),o+(u?2:0)))+(n(i(e,t+s+o,2))+[]).padStart(2,"0")))%97||2)>>1,t+=2,r),u("A"))===[]+1>>1},t.extractTime=function(e){return 25===o(e)[s]?n(i(o(e),n("12"),u("F")))/(n(i(o(e),u("C"),u("Y")>>4))||1+(~~![][s]<<3)):0};
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const s="length",n=e=>parseInt(e,16),a=e=>parseInt(e,10),o=e=>(e+"").replace(/\-/g,""),i=(e,t,r)=>e.substr(t,r),u=e=>e.codePointAt(0)-65},function(e,t,r){"use strict";t.__esModule=!0,t.HyperFormula=void 0;var s=r(4),n=r(55),a=r(64),o=r(1),i=r(65),u=r(54),l=r(57),h=r(96),d=r(97),p=r(5),c=r(46),m=r(83),g=r(69),E=r(6);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class T{constructor(e,t,r,s,n,a,o,i,u,l,h,p,c,m){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=s,this._parser=n,this._unparser=a,this._cellContentParser=o,this._evaluator=i,this._lazilyTransformingAstService=u,this._crudOperations=l,this._exporter=h,this._namedExpressions=p,this._serialization=c,this._functionRegistry=m,this._emitter=new d.Emitter,this._evaluationSuspended=!1}static get defaultConfig(){return(0,u.getDefaultConfig)()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(a.BuildEngineFactory.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(a.BuildEngineFactory.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(a.BuildEngineFactory.buildEmpty(e,t))}static getLanguage(e){(0,n.validateArgToType)(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(void 0===t)throw new p.LanguageNotRegisteredError;return t}static registerLanguage(e,t){if((0,n.validateArgToType)(e,"string","languageCode"),this.registeredLanguages.has(e))throw new p.LanguageAlreadyRegisteredError;this.registeredLanguages.set(e,(0,c.buildTranslationPackage)(t))}static unregisterLanguage(e){if((0,n.validateArgToType)(e,"string","languageCode"),!this.registeredLanguages.has(e))throw new p.LanguageNotRegisteredError;this.registeredLanguages.delete(e)}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){m.FunctionRegistry.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){m.FunctionRegistry.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){(0,n.validateArgToType)(e,"string","functionId"),m.FunctionRegistry.registerFunction(e,t,r)}static unregisterFunction(e){(0,n.validateArgToType)(e,"string","functionId"),m.FunctionRegistry.unregisterFunction(e)}static unregisterAllFunctions(){m.FunctionRegistry.unregisterAll()}static getRegisteredFunctionNames(e){(0,n.validateArgToType)(e,"string","code");const t=m.FunctionRegistry.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return(0,n.validateArgToType)(e,"string","functionId"),m.FunctionRegistry.getFunctionPlugin(e)}static getAllFunctionPlugins(){return m.FunctionRegistry.getPlugins()}static buildFromEngineState(e){return new T(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellSerialized(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return(0,n.validateArgToType)(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return(0,n.validateArgToType)(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return(0,n.validateArgToType)(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(e=>this.getSheetDimensions(e))}getSheetDimensions(e){return(0,n.validateArgToType)(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),s=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),n=this._serialization.getAllNamedExpressionsSerialized(),o=a.BuildEngineFactory.rebuildWithConfig(t,s,n,this._stats);this._config=o.config,this._stats=o.stats,this._dependencyGraph=o.dependencyGraph,this._columnSearch=o.columnSearch,this._parser=o.parser,this._unparser=o.unparser,this._cellContentParser=o.cellContentParser,this._evaluator=o.evaluator,this._lazilyTransformingAstService=o.lazilyTransformingAstService,this._crudOperations=o.crudOperations,this._exporter=o.exporter,this._namedExpressions=o.namedExpressions,this._serialization=o.serialization,this._functionRegistry=o.functionRegistry}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.updateConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if((0,o.isSimpleCellAddress)(e))t=new s.AbsoluteCellRange(e,e);else{if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange","address");t=new s.AbsoluteCellRange(e.start,e.end)}try{this._crudOperations.ensureRangeInSizeLimits(t);for(const e of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(e)}catch(e){return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){(0,n.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch(e){return!1}}setRowOrder(e,t){(0,n.validateArgToType)(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){(0,n.validateArgToType)(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch(e){return!1}}swapColumnIndexes(e,t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){(0,n.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch(e){return!1}}setColumnOrder(e,t){(0,n.validateArgToType)(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){(0,n.validateArgToType)(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch(e){return!1}}isItPossibleToAddRows(e,...t){(0,n.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeAddedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch(e){return!1}}addRows(e,...t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){(0,n.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeRemovedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch(e){return!1}}removeRows(e,...t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){(0,n.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeAddedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch(e){return!1}}addColumns(e,...t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){(0,n.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeRemovedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch(e){return!1}}removeColumns(e,...t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!(0,o.isSimpleCellAddress)(t))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");try{const r=new s.AbsoluteCellRange(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch(e){return!1}}moveCells(e,t){if(!(0,o.isSimpleCellAddress)(t))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");const r=new s.AbsoluteCellRange(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,s){(0,n.validateArgToType)(e,"number","sheetId"),(0,n.validateArgToType)(t,"number","startRow"),(0,n.validateArgToType)(r,"number","numberOfRows"),(0,n.validateArgToType)(s,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,s),!0}catch(e){return!1}}moveRows(e,t,r,s){return(0,n.validateArgToType)(e,"number","sheetId"),(0,n.validateArgToType)(t,"number","startRow"),(0,n.validateArgToType)(r,"number","numberOfRows"),(0,n.validateArgToType)(s,"number","targetRow"),this._crudOperations.moveRows(e,t,r,s),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,s){(0,n.validateArgToType)(e,"number","sheetId"),(0,n.validateArgToType)(t,"number","startColumn"),(0,n.validateArgToType)(r,"number","numberOfColumns"),(0,n.validateArgToType)(s,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,s),!0}catch(e){return!1}}moveColumns(e,t,r,s){return(0,n.validateArgToType)(e,"number","sheetId"),(0,n.validateArgToType)(t,"number","startColumn"),(0,n.validateArgToType)(r,"number","numberOfColumns"),(0,n.validateArgToType)(s,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,s),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");const t=new s.AbsoluteCellRange(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");const t=new s.AbsoluteCellRange(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");return new s.AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map(e=>e.map(e=>this.getCellValue(e)))}getRangeFormulas(e){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");return new s.AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map(e=>e.map(e=>this.getCellFormula(e)))}getRangeSerialized(e){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");return new s.AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map(e=>e.map(e=>this.getCellSerialized(e)))}getFillRangeData(e,t,r=!1){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","source");if(!(0,s.isSimpleCellRange)(t))throw new p.ExpectedValueOfTypeError("SimpleCellRange","target");const n=new s.AbsoluteCellRange(e.start,e.end),a=new s.AbsoluteCellRange(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),a.arrayOfAddressesInRange().map(s=>s.map(s=>{const a=((s.row-(r?t:e).start.row)%n.height()+n.height())%n.height()+e.start.row,o=((s.col-(r?t:e).start.col)%n.width()+n.width())%n.width()+e.start.col;return this._serialization.getCellSerialized({row:a,col:o,sheet:n.sheet},s)}))}isItPossibleToAddSheet(e){(0,n.validateArgToType)(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch(e){return!1}}addSheet(e){void 0!==e&&(0,n.validateArgToType)(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(d.Events.SheetAdded,t),t}isItPossibleToRemoveSheet(e){(0,n.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch(e){return!1}}removeSheet(e){(0,n.validateArgToType)(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(d.Events.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){(0,n.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch(e){return!1}}clearSheet(e){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){(0,n.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch(e){return!1}}setSheetContent(e,t){return(0,n.validateArgToType)(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return(0,n.validateArgToType)(e,"string","cellAddress"),(0,n.validateArgToType)(t,"number","sheetId"),(0,E.simpleCellAddressFromString)(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return(0,n.validateArgToType)(e,"string","cellRange"),(0,n.validateArgToType)(t,"number","sheetId"),(0,E.simpleCellRangeFromString)(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return(0,n.validateArgToType)(t,"number","sheetId"),(0,E.simpleCellAddressToString)(this.sheetMapping.fetchDisplayName,e,t)}simpleCellRangeToString(e,t){if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellRange","cellRange");return(0,n.validateArgToType)(t,"number","sheetId"),(0,E.simpleCellRangeToString)(this.sheetMapping.fetchDisplayName,e,t)}getCellDependents(e){let t;if((0,o.isSimpleCellAddress)(e))t=this._dependencyGraph.addressMapping.getCell(e);else{if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end)}return void 0===t?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if((0,o.isSimpleCellAddress)(e))t=this._dependencyGraph.addressMapping.getCell(e);else{if(!(0,s.isSimpleCellRange)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end)}return void 0===t?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return(0,n.validateArgToType)(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return(0,n.validateArgToType)(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return(0,n.validateArgToType)(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return(0,o.getCellType)(t,e)}doesCellHaveSimpleValue(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===o.CellType.VALUE}doesCellHaveFormula(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===o.CellType.FORMULA||t===o.CellType.ARRAYFORMULA}isCellEmpty(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===o.CellType.EMPTY}isCellPartOfArray(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===o.CellType.ARRAY||t===o.CellType.ARRAYFORMULA}getCellValueType(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return(0,o.getCellValueType)(t)}getCellValueDetailedType(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return(0,o.getCellValueDetailedType)(t)}getCellValueFormat(e){if(!(0,o.isSimpleCellAddress)(e))throw new p.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return(0,o.getCellValueFormat)(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){(0,n.validateArgToType)(e,"number","sheetId"),(0,n.validateArgToType)(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch(e){return!1}}renameSheet(e,t){(0,n.validateArgToType)(e,"number","sheetId"),(0,n.validateArgToType)(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);void 0!==r&&this._emitter.emit(d.Events.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(e){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),e}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(d.Events.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(d.Events.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,n.validateArgToType)(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch(e){return!1}}addNamedExpression(e,t,r,s){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,n.validateArgToType)(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,s);const a=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(d.Events.NamedExpressionAdded,e,a),a}getNamedExpressionValue(e,t){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,n.validateArgToType)(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);return r?this._serialization.getCellValue(r.address):void 0}getNamedExpressionFormula(e,t){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,n.validateArgToType)(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);return void 0===r?void 0:this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,n.validateArgToType)(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(void 0===r)return;return{name:e,scope:t,expression:this._serialization.getCellFormula(r.address),options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,n.validateArgToType)(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch(e){return!1}}changeNamedExpression(e,t,r,s){return(0,n.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,n.validateArgToType)(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,s),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,n.validateArgToType)(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch(e){return!1}}removeNamedExpression(e,t){(0,n.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,n.validateArgToType)(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(d.Events.NamedExpressionRemoved,r.displayName,e),e}return[]}listNamedExpressions(e){return void 0!==e&&(0,n.validateArgToType)(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){(0,n.validateArgToType)(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(void 0===t)throw new p.NotAFormulaError;return this._unparser.unparse(t,r)}calculateFormula(e,t){(0,n.validateArgToType)(e,"string","formulaString"),(0,n.validateArgToType)(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:s,dependencies:a}=this.extractTemporaryFormula(e,t);if(void 0===r)throw new p.NotAFormulaError;const o=this.evaluator.runAndForget(r,s,a);return this._exporter.exportScalarOrRange(o)}validateFormula(e){(0,n.validateArgToType)(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return void 0!==t&&!(t.type===E.AstNodeType.ERROR&&!t.error)}getRegisteredFunctionNames(){return T.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return(0,n.validateArgToType)(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return(0,n.validateArgToType)(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return(0,n.validateArgToType)(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return(0,n.validateArgToType)(e,"number","val"),(0,l.numberToSimpleTime)(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){(0,h.objectDestroy)(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new p.EvaluationSuspendedError}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),s={sheet:t,col:0,row:0};if(!(r instanceof i.CellContent.Formula))return{address:s,dependencies:[]};const{ast:n,errors:a,dependencies:o}=this._parser.parse(r.formula,s);return a.length>0?{address:s,dependencies:[]}:{ast:n,address:s,dependencies:o}}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=Array.from(this.dependencyGraph.verticesToRecompute());this.dependencyGraph.clearRecentlyChangedVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(d.Events.ValuesUpdated,r),r}}}t.HyperFormula=T,T.version="2.0.1",T.buildDate="14/07/2022 17:33:52",T.releaseDate="14/06/2022",T.languages={},T.registeredLanguages=new Map},function(e,t,r){"use strict";t.__esModule=!0,t.BuildEngineFactory=void 0;var s=r(26),n=r(65),a=r(66),o=r(54),i=r(67),u=r(57),l=r(2),h=r(5),d=r(80),p=r(81),c=r(82),m=r(46),g=r(29),E=r(83),T=r(85),y=r(87),A=r(89),f=r(68),R=r(94),N=r(69),C=r(6),S=r(95),M=r(78),w=r(33),v=r(79);t.BuildEngineFactory=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{static buildFromSheets(e,t={},r=[]){const s=new o.Config(t);return this.buildEngine(s,e,r)}static buildFromSheet(e,t={},r=[]){const s=new o.Config(t),n=s.translationPackage.getUITranslation(m.UIElement.NEW_SHEET_PREFIX)+"1";return this.buildEngine(s,{[n]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new o.Config(e),{},t)}static rebuildWithConfig(e,t,r,s){return this.buildEngine(e,t,r,s)}static buildEngine(e,t={},r=[],o=(e.useStats?new w.Statistics:new w.EmptyStatistics)){o.start(w.StatType.BUILD_ENGINE_TOTAL);const m=new f.NamedExpressions,O=new E.FunctionRegistry(e),I=new y.LazilyTransformingAstService(o),b=l.DependencyGraph.buildEmpty(I,e,O,m,o),F=(0,A.buildColumnSearchStrategy)(b,e,o),V=b.sheetMapping,U=b.addressMapping;for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r];(0,M.validateAsSheet)(s);const n=(0,M.findBoundaries)(s);if(n.height>e.maxRows||n.width>e.maxColumns)throw new h.SheetSizeLimitExceededError;const a=V.addSheet(r);U.autoAddSheet(a,s,n)}const x=new C.ParserWithCaching(e,O,V.get);I.parser=x;const L=new C.Unparser(e,(0,C.buildLexerConfig)(e),V.fetchDisplayName,m),P=new u.DateTimeHelper(e),_=new R.NumberLiteralHelper(e),B=new g.ArithmeticHelper(e,P,_),D=new n.CellContentParser(e,P,_),G=new s.ArraySizePredictor(e,O),H=new N.Operations(e,b,F,D,x,o,I,m,G),W=new v.UndoRedo(e,H);I.undoRedo=W;const k=new a.ClipboardOperations(e,b,H),z=new i.CrudOperations(e,H,W,k,b,F,x,D,I,m);r.forEach(e=>{z.ensureItIsPossibleToAddNamedExpression(e.name,e.expression,e.scope),z.operations.addNamedExpression(e.name,e.expression,e.scope,e.options)});const Y=new p.Exporter(e,m,V.fetchDisplayName,I),q=new S.Serialization(b,L,Y),X=new T.Interpreter(e,b,F,o,B,O,m,q,G,P);o.measure(w.StatType.GRAPH_BUILD,()=>{new c.GraphBuilder(b,F,x,D,o,G).buildGraph(t,o)});const $=new d.Evaluator(e,o,X,I,b,F);return $.run(),o.end(w.StatType.BUILD_ENGINE_TOTAL),{config:e,stats:o,dependencyGraph:b,columnSearch:F,parser:x,unparser:L,cellContentParser:D,evaluator:$,lazilyTransformingAstService:I,crudOperations:z,exporter:Y,namedExpressions:m,serialization:q,functionRegistry:O}}}},function(e,t,r){"use strict";t.__esModule=!0,t.CellContentParser=t.CellContent=void 0,t.isBoolean=d,t.isError=p,t.isFormula=h;var s,n=r(1),a=r(57),o=r(18),i=r(5),u=r(29),l=r(32);function h(e){return e.startsWith("=")}function d(e){const t=e.toLowerCase();return"true"===t||"false"===t}function p(e,t){const r=e.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(r)&&Object.prototype.hasOwnProperty.call(t,r)}t.CellContent=s,function(e){e.Number=class{constructor(e){this.value=e,this.value=(0,l.cloneNumber)(this.value,(0,u.fixNegativeZero)((0,l.getRawValue)(this.value)))}};e.String=class{constructor(e){this.value=e}};e.Boolean=class{constructor(e){this.value=e}};class t{static getSingletonInstance(){return t.instance||(t.instance=new t),t.instance}}e.Empty=t;e.Formula=class{constructor(e){this.formula=e}};e.Error=class{constructor(e,t){this.value=new n.CellError(e,t)}}}(s||(t.CellContent=s={}));t.CellContentParser=class{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(null==e)return s.Empty.getSingletonInstance();if("number"==typeof e)return(0,u.isNumberOverflow)(e)?new s.Error(n.ErrorType.NUM,o.ErrorMessage.ValueLarge):new s.Number(e);if("boolean"==typeof e)return new s.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()})+(0,a.timeToNumber)({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3});return t<0?new s.Error(n.ErrorType.NUM,o.ErrorMessage.DateBounds):t%1==0?new s.Number(new l.DateNumber(t,"Date()")):t<1?new s.Number(new l.TimeNumber(t,"Date()")):new s.Number(new l.DateTimeNumber(t,"Date()"))}if("string"==typeof e){if(d(e))return new s.Boolean("true"===e.toLowerCase());if(h(e))return new s.Formula(e);if(p(e,this.config.errorMapping))return new s.Error(this.config.errorMapping[e.toUpperCase()]);{let t,r=e.trim(),n=0;if(r.endsWith("%"))n=1,r=r.slice(0,r.length-1);else{const e=this.currencyMatcher(r);void 0!==e&&(n=2,[t,r]=e)}const a=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(void 0!==a){let e;return e=1===n?new l.PercentNumber(a/100):2===n?new l.CurrencyNumber(a,t):a,new s.Number(e)}const o=this.dateHelper.dateStringToDateNumber(r);return void 0!==o?new s.Number(o):new s.String(e.startsWith("'")?e.slice(1):e)}}throw new i.UnableToParseError(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}},function(e,t,r){"use strict";t.__esModule=!0,t.ClipboardOperations=t.ClipboardCellType=void 0;var s,n,a=r(4),o=r(1),i=r(5);!function(e){e[e.COPY=0]="COPY",e[e.CUT=1]="CUT"}(s||(s={})),t.ClipboardCellType=n,function(e){e[e.VALUE=0]="VALUE",e[e.EMPTY=1]="EMPTY",e[e.FORMULA=2]="FORMULA",e[e.PARSING_ERROR=3]="PARSING_ERROR"}(n||(t.ClipboardCellType=n={}));class u{constructor(e,t,r,s,n){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=s,this.content=n}*getContent(e){if(void 0!==this.content)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[(0,o.simpleCellAddress)(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}t.ClipboardOperations=class{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new u(e,t,r,s.CUT)}copy(e,t,r){const n=[];for(let s=0;s<r;++s){n[s]=[];for(let r=0;r<t;++r){const t=this.operations.getClipboardCell((0,o.simpleCellAddress)(e.sheet,e.col+r,e.row+s));n[s].push(t)}}this.clipboard=new u(e,t,r,s.COPY,n)}abortCut(){this.clipboard&&this.clipboard.type===s.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(void 0===this.clipboard)return;if((0,o.invalidSimpleCellAddress)(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new i.InvalidArgumentsError("a valid target address.");const t=a.AbsoluteCellRange.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new i.SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return void 0!==this.clipboard&&this.clipboard.type===s.CUT}isCopyClipboard(){return void 0!==this.clipboard&&this.clipboard.type===s.COPY}}},function(e,t,r){"use strict";t.__esModule=!0,t.CrudOperations=void 0;var s=r(4),n=r(1),a=r(65),o=r(5),i=r(68),u=r(69),l=r(78),h=r(22),d=r(79);function p(e){return Number.isInteger(e)&&e>0}function c(e){return Number.isInteger(e)&&e>=0}t.CrudOperations=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r,s,n,a,o,i,u,l){this.operations=t,this.undoRedo=r,this.clipboardOperations=s,this.dependencyGraph=n,this.columnSearch=a,this.parser=o,this.cellContentParser=i,this.lazilyTransformingAstService=u,this.namedExpressions=l,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new u.AddRowsCommand(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new d.AddRowsUndoEntry(r))}removeRows(e,...t){const r=new u.RemoveRowsCommand(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const s=this.operations.removeRows(r);this.undoRedo.saveOperation(new d.RemoveRowsUndoEntry(r,s))}addColumns(e,...t){const r=new u.AddColumnsCommand(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new d.AddColumnsUndoEntry(r))}removeColumns(e,...t){const r=new u.RemoveColumnsCommand(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const s=this.operations.removeColumns(r);this.undoRedo.saveOperation(new d.RemoveColumnsUndoEntry(r,s))}moveCells(e,t,r,s){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:n,overwrittenCellsData:a,addedGlobalNamedExpressions:o}=this.operations.moveCells(e,t,r,s);this.undoRedo.saveOperation(new d.MoveCellsUndoEntry(e,t,r,s,a,o,n))}moveRows(e,t,r,s){this.ensureItIsPossibleToMoveRows(e,t,r,s),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.moveRows(e,t,r,s);this.undoRedo.saveOperation(new d.MoveRowsUndoEntry(e,t,r,s,n))}moveColumns(e,t,r,s){this.ensureItIsPossibleToMoveColumns(e,t,r,s),this.undoRedo.clearRedoStack();const n=this.operations.moveColumns(e,t,r,s);this.undoRedo.saveOperation(new d.MoveColumnsUndoEntry(e,t,r,s,n))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!p(t))throw new o.InvalidArgumentsError("width to be positive integer.");if(!p(r))throw new o.InvalidArgumentsError("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(void 0===t)throw new o.NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=s.AbsoluteCellRange.spanFrom(e,t.width,t.height),n=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const a=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new d.PasteUndoEntry(e,n,t.content,a))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return void 0===this.clipboardOperations.clipboard}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){void 0!==e&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new d.AddSheetUndoEntry(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:s,scopedNamedExpressions:n}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new d.RemoveSheetUndoEntry(t,e,r,n,s))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return void 0!==r&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new d.RenameSheetUndoEntry(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new d.ClearSheetUndoEntry(e,t))}setCellContents(e,t){if(t instanceof Array){for(let e=0;e<t.length;e++)if(!(t[e]instanceof Array))throw new o.InvalidArgumentsError("an array of arrays or a raw cell value.")}else t=[[t]];this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++){const a={sheet:e.sheet,row:e.row+s,col:e.col+n},o=t[s][n];this.clipboardOperations.abortCut();const i=this.operations.setCellContent(a,o);r.push({address:a,newContent:o,oldContent:i})}this.undoRedo.saveOperation(new d.SetCellContentsUndoEntry(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),(0,l.validateAsSheet)(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new d.SetSheetContentUndoEntry(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new d.SetRowOrderUndoEntry(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const t=s.AbsoluteCellRange.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new o.SourceLocationHasArrayError}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new d.SetColumnOrderUndoEntry(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const t=s.AbsoluteCellRange.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new o.SourceLocationHasArrayError}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e);const s="row"===r?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==s)throw new o.InvalidArgumentsError(`number of ${r}s provided to be sheet ${"row"===r?"height":"width"}.`);const n=[];for(let e=0;e<s;e++)t[e]!==e&&n.push([e,t[e]]);return n}undo(){if(this.undoRedo.isUndoStackEmpty())throw new o.NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new o.NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,s){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,s),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new d.AddNamedExpressionUndoEntry(e,t,r,s))}changeNamedExpressionExpression(e,t,r,s){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[n,a]=this.operations.changeNamedExpressionExpression(e,r,t,s);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new d.ChangeNamedExpressionUndoEntry(n,r,a,t,s))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,s]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new d.RemoveNamedExpressionUndoEntry(r,s,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),void 0===this.namedExpressions.namedExpressionForScope(e,r))throw new o.NamedExpressionDoesNotExistError(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),void 0===this.namedExpressions.namedExpressionForScope(e,t))throw new o.NamedExpressionDoesNotExistError(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e);if(this.dependencyGraph.getSheetHeight(e)+t.map(e=>e[1]).reduce((e,t)=>e+t,0)>this.maxRows)throw new o.SheetSizeLimitExceededError;for(const[e,r]of t)if(!c(e)||!p(r))throw new o.InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,s]of t){const t=r+s-1;if(!c(r)||!c(t))throw new o.InvalidArgumentsError("starting and ending row to be nonnegative.");if(t<r)throw new o.InvalidArgumentsError("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e);if(this.dependencyGraph.getSheetWidth(e)+t.map(e=>e[1]).reduce((e,t)=>e+t,0)>this.maxColumns)throw new o.SheetSizeLimitExceededError;for(const[e,r]of t)if(!c(e)||!p(r))throw new o.InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,s]of t){const t=r+s-1;if(!c(r)||!c(t))throw new o.InvalidArgumentsError("starting and ending column to be nonnegative.");if(t<r)throw new o.InvalidArgumentsError("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e)}}ensureItIsPossibleToMoveRows(e,t,r,a){this.ensureItIsPossibleToAddRows(e,[a,r]);const i=(0,n.simpleCellAddress)(e,0,t),u=(0,n.simpleCellAddress)(e,0,a);if(!this.sheetMapping.hasSheetWithId(e)||(0,n.invalidSimpleCellAddress)(i)||(0,n.invalidSimpleCellAddress)(u)||!p(r)||a<=t+r&&a>=t)throw new o.InvalidArgumentsError("a valid range of rows to move.");const l=this.dependencyGraph.getSheetWidth(e),d=s.AbsoluteCellRange.spanFrom(i,l,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(d))throw new o.SourceLocationHasArrayError;if(a>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(h.RowsSpan.fromNumberOfRows(e,a-1,2)))throw new o.TargetLocationHasArrayError}ensureItIsPossibleToMoveColumns(e,t,r,a){this.ensureItIsPossibleToAddColumns(e,[a,r]);const i=(0,n.simpleCellAddress)(e,t,0),u=(0,n.simpleCellAddress)(e,a,0);if(!this.sheetMapping.hasSheetWithId(e)||(0,n.invalidSimpleCellAddress)(i)||(0,n.invalidSimpleCellAddress)(u)||!p(r)||a<=t+r&&a>=t)throw new o.InvalidArgumentsError("a valid range of columns to move.");const l=this.dependencyGraph.getSheetHeight(e),d=s.AbsoluteCellRange.spanFrom(i,r,l);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(d))throw new o.SourceLocationHasArrayError;if(a>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(h.ColumnsSpan.fromNumberOfColumns(e,a-1,2)))throw new o.TargetLocationHasArrayError}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new o.SheetNameAlreadyTakenError(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e);const r=this.sheetMapping.get(t);if(void 0!==r&&r!==e)throw new o.SheetNameAlreadyTakenError(t)}ensureItIsPossibleToChangeContent(e){if((0,n.invalidSimpleCellAddress)(e))throw new o.InvalidAddressError(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new o.NoSheetWithIdError(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=(0,l.findBoundaries)(t),n=s.AbsoluteCellRange.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(n);for(const e of n.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(e)}ensureItIsPossibleToChangeSheetContents(e,t){const r=(0,l.findBoundaries)(t),a=s.AbsoluteCellRange.spanFrom((0,n.simpleCellAddress)(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(a)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new o.SheetSizeLimitExceededError}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(void 0!==e&&!this.sheetMapping.hasSheetWithId(e))throw new o.NoSheetWithIdError(e)}validateRowOrColumnMapping(e,t,r){const s="row"===r?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),n=t.map(([e,t])=>e).sort((e,t)=>e-t),a=t.map(([e,t])=>t).sort((e,t)=>e-t);for(let e=0;e<n.length;e++){if(!c(n[e])||n[e]>=s)throw new o.InvalidArgumentsError(`${r} numbers to be nonnegative integers and less than sheet ${"row"===r?"height":"width"}.`);if(n[e]===n[e+1])throw new o.InvalidArgumentsError(`source ${r} numbers to be unique.`);if(n[e]!==a[e])throw new o.InvalidArgumentsError(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new o.NamedExpressionNameIsInvalidError(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new o.NamedExpressionNameIsAlreadyTakenError(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof a.CellContent.Formula){const e=this.parser.parse(t.formula,(0,n.simpleCellAddress)(-1,0,0));if((0,i.doesContainRelativeReferences)(e.ast))throw new o.NoRelativeAddressesAllowedError}}}},function(e,t,r){"use strict";t.__esModule=!0,t.doesContainRelativeReferences=t.NamedExpressions=t.InternalNamedExpression=void 0;var s=r(1),n=r(6);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a{constructor(e,t,r,s){this.displayName=e,this.address=t,this.added=r,this.options=s}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new a(this.displayName,this.address,this.added,this.options)}}t.InternalNamedExpression=a;class o{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));return t&&t.added?t:void 0}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}normalizeExpressionName(e){return e.toLowerCase()}}class i{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class u{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new o,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,s;return void 0===t?this.workbookStore.isNameAvailable(e):null===(s=null===(r=this.worksheetStore(t))||void 0===r?void 0:r.isNameAvailable(e))||void 0===s||s}namedExpressionInAddress(e){const t=this.addressCache.get(e);return t&&t.added?t:void 0}namedExpressionForScope(e,t){var r;return void 0===t?this.workbookStore.getExisting(e):null===(r=this.worksheetStore(t))||void 0===r?void 0:r.get(e)}nearestNamedExpression(e,t){var r,s;return null!==(s=null===(r=this.worksheetStore(t))||void 0===r?void 0:r.get(e))&&void 0!==s?s:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,s;return null!==(s=null===(r=this.worksheetStore(t))||void 0===r?void 0:r.has(e))&&void 0!==s&&s}isNameValid(e){return!/^[A-Za-z]+[0-9]+$/.test(e)&&/^[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF._]*$/.test(e)}addNamedExpression(e,t,r){const s=void 0===t?this.workbookStore:this.worksheetStoreOrCreate(t);let n=s.get(e);return void 0!==n?(n.added=!0,n.displayName=e,n.options=r):(n=new a(e,this.nextAddress(),!0,r),s.add(n)),this.addressCache.set(n.address.row,n),n}restoreNamedExpression(e,t){const r=void 0===t?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return null!==(r=this.worksheetStoreOrCreate(t).get(e))&&void 0!==r?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return void 0===t&&(t=new a(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;r=void 0===t?this.workbookStore:this.worksheetStore(t);const s=null==r?void 0:r.get(e);if(void 0===r||void 0===s||!s.added)throw"Named expression does not exist";r.remove(e),r instanceof i&&0===r.mapping.size&&this.worksheetStores.delete(t),this.addressCache.delete(s.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter(({scope:t})=>t===e).map(e=>e.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(e=>e.expression.displayName)}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:void 0})}),this.worksheetStores.forEach((t,r)=>{t.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:r})})}),e}getAllNamedExpressionsForScope(e){var t,r;return void 0===e?this.workbookStore.getAllNamedExpressions():null!==(r=null===(t=this.worksheetStores.get(e))||void 0===t?void 0:t.getAllNamedExpressions())&&void 0!==r?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new i,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return(0,s.simpleCellAddress)(u.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}t.NamedExpressions=u,u.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const l=e=>{switch(e.type){case n.AstNodeType.EMPTY:case n.AstNodeType.NUMBER:case n.AstNodeType.STRING:case n.AstNodeType.ERROR:case n.AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case n.AstNodeType.CELL_REFERENCE:return!e.reference.isAbsolute();case n.AstNodeType.CELL_RANGE:case n.AstNodeType.COLUMN_RANGE:case n.AstNodeType.ROW_RANGE:return!e.start.isAbsolute();case n.AstNodeType.NAMED_EXPRESSION:return!1;case n.AstNodeType.PERCENT_OP:case n.AstNodeType.PLUS_UNARY_OP:case n.AstNodeType.MINUS_UNARY_OP:return l(e.value);case n.AstNodeType.CONCATENATE_OP:case n.AstNodeType.EQUALS_OP:case n.AstNodeType.NOT_EQUAL_OP:case n.AstNodeType.LESS_THAN_OP:case n.AstNodeType.GREATER_THAN_OP:case n.AstNodeType.LESS_THAN_OR_EQUAL_OP:case n.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case n.AstNodeType.MINUS_OP:case n.AstNodeType.PLUS_OP:case n.AstNodeType.TIMES_OP:case n.AstNodeType.DIV_OP:case n.AstNodeType.POWER_OP:return l(e.left)||l(e.right);case n.AstNodeType.PARENTHESIS:return l(e.expression);case n.AstNodeType.FUNCTION_CALL:return e.args.some(e=>l(e));case n.AstNodeType.ARRAY:return e.args.some(e=>e.some(e=>l(e)))}};t.doesContainRelativeReferences=l},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveRowsCommand=t.RemoveColumnsCommand=t.Operations=t.AddRowsCommand=t.AddColumnsCommand=void 0,t.normalizeAddedIndexes=v,t.normalizeRemovedIndexes=w;var s=r(4),n=r(23),a=r(26),o=r(1),i=r(65),u=r(66),l=r(24),h=r(2),d=r(40),p=r(70),c=r(72),m=r(73),g=r(74),E=r(75),T=r(76),y=r(77),A=r(5),f=r(32),R=r(68),N=r(6),C=r(78),S=r(22),M=r(33);t.RemoveRowsCommand=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return w(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>S.RowsSpan.fromNumberOfRows(this.sheet,e[0],e[1]))}};t.AddRowsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return v(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>S.RowsSpan.fromNumberOfRows(this.sheet,e[0],e[1]))}};t.AddColumnsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return v(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>S.ColumnsSpan.fromNumberOfColumns(this.sheet,e[0],e[1]))}};t.RemoveColumnsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return w(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>S.ColumnsSpan.fromNumberOfColumns(this.sheet,e[0],e[1]))}};function w(e){if(e.length<=1)return e;const t=[...e].sort(([e],[t])=>e-t),r=t.reduce((e,[t,r])=>{const s=e[e.length-1],n=s[0]+s[1];return t<=n?s[1]+=Math.max(0,r-(n-t)):e.push([t,r]),e},[t[0]]);let s=0;for(let e=0;e<r.length;++e)r[e][0]-=s,s+=r[e][1];return r}function v(e){if(e.length<=1)return e;const t=[...e].sort(([e],[t])=>e-t),r=t.reduce((e,[t,r])=>{const s=e[e.length-1];return t===s[0]?s[1]=Math.max(s[1],r):e.push([t,r]),e},[t[0]]);let s=0;for(let e=0;e<r.length;++e)r[e][0]+=s,s+=r[e][1];return r}function O(e){return Number.isInteger(e)&&e>0}t.Operations=class{constructor(e,t,r,s,n,a,o,i,u){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=s,this.parser=n,this.stats=a,this.lazilyTransformingAstService=o,this.namedExpressions=i,this.arraySizePredictor=u,this.changes=l.ContentChanges.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const e=this.doRemoveRows(r);e&&t.push(e)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const e=this.doRemoveColumns(r);e&&t.push(e)}return t}removeSheet(e){let t;this.dependencyGraph.removeSheet(e),this.stats.measure(M.StatType.TRANSFORM_ASTS,()=>{const r=new y.RemoveSheetTransformer(e);r.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(r)}),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map(t=>this.removeNamedExpression(t.normalizeExpressionName(),e));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e),r=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,r,(0,C.findBoundaries)(r)),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,s){const n=S.RowsSpan.fromNumberOfRows(e,s,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(n),s<t&&(t+=r);const a=(0,o.simpleCellAddress)(e,0,t),i=(0,o.simpleCellAddress)(e,0,s);this.moveCells(a,Number.POSITIVE_INFINITY,r,i);const u=S.RowsSpan.fromNumberOfRows(e,t,r);return this.doRemoveRows(u),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,s){const n=S.ColumnsSpan.fromNumberOfColumns(e,s,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(n),s<t&&(t+=r);const a=(0,o.simpleCellAddress)(e,t,0),i=(0,o.simpleCellAddress)(e,s,0);this.moveCells(a,r,Number.POSITIVE_INFINITY,i);const u=S.ColumnsSpan.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(u),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,n){this.ensureItIsPossibleToMoveCells(e,t,r,n);const a=s.AbsoluteCellRange.spanFrom(e,t,r),o=s.AbsoluteCellRange.spanFrom(n,t,r),i=n.col-e.col,u=n.row-e.row,l=n.sheet,h=this.getRangeClipboardCells(o),d=this.dependencyGraph.rawValuesFromRange(o);this.columnSearch.removeValues(d);const p=this.dependencyGraph.rawValuesFromRange(a);let c;this.columnSearch.moveValues(p,i,u,l),this.stats.measure(M.StatType.TRANSFORM_ASTS,()=>{const e=new g.MoveCellsTransformer(a,i,u,l);e.performEagerTransformations(this.dependencyGraph,this.parser),c=this.lazilyTransformingAstService.addTransformation(e)}),this.dependencyGraph.moveCells(a,i,u,l);const m=this.updateNamedExpressionsForMovedCells(e,t,r,n);return{version:c,overwrittenCellsData:h,addedGlobalNamedExpressions:m}}setRowOrder(e,t){const r=[];let n=[];for(const[a,o]of t)if(a!==o){const t=s.AbsoluteCellRange.spanFrom({sheet:e,col:0,row:a},1/0,1),i=this.getRangeClipboardCells(t);n=n.concat(i),r.push(i.map(([{sheet:e,col:t},r])=>[{sheet:e,col:t,row:o},r]))}return r.forEach(t=>this.restoreClipboardCells(e,t.values())),n}setColumnOrder(e,t){const r=[];let n=[];for(const[a,o]of t)if(a!==o){const t=s.AbsoluteCellRange.spanFrom({sheet:e,col:a,row:0},1,1/0),i=this.getRangeClipboardCells(t);n=n.concat(i),r.push(i.map(([{sheet:e,col:t,row:r},s])=>[{sheet:e,col:o,row:r},s]))}return r.forEach(t=>this.restoreClipboardCells(e,t.values())),n}addNamedExpression(e,t,r,s){const n=this.namedExpressions.addNamedExpression(e,r,s);this.storeNamedExpressionInCell(n.address,t),this.adjustNamedExpressionEdges(n,e,r)}restoreNamedExpression(e,t,r){const s=e.displayName;this.restoreCell(e.address,t);const n=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(n,s,r)}changeNamedExpressionExpression(e,t,r,s){const n=this.namedExpressions.namedExpressionForScope(e,r);if(!n)throw new A.NamedExpressionDoesNotExistError(e);const a=n.copy();n.options=s;const o=this.getClipboardCell(n.address);return this.storeNamedExpressionInCell(n.address,t),[a,o]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new A.NamedExpressionDoesNotExistError(e);this.namedExpressions.remove(r.displayName,t);const s=this.getClipboardCell(r.address);if(void 0!==t){const t=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,t.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,s]}ensureItIsPossibleToMoveCells(e,t,r,n){if((0,o.invalidSimpleCellAddress)(e)||!(O(t)&&O(r)||function(e,t,r){return 0===e.row&&O(t)&&r===Number.POSITIVE_INFINITY||0===e.col&&O(r)&&t===Number.POSITIVE_INFINITY}(e,t,r))||(0,o.invalidSimpleCellAddress)(n)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(n.sheet))throw new A.InvalidArgumentsError("a valid range of cells to move.");const a=s.AbsoluteCellRange.spanFrom(e,t,r),i=s.AbsoluteCellRange.spanFrom(n,t,r);if(i.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new A.SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(a))throw new A.SourceLocationHasArrayError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new A.TargetLocationHasArrayError}restoreClipboardCells(e,t){const r=[];for(const[s,n]of t)if(this.restoreCell(s,n),n.type===u.ClipboardCellType.FORMULA){const{dependencies:t}=this.parser.fetchCachedResult(n.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,s,t))}return r}restoreCell(e,t){switch(t.type){case u.ClipboardCellType.VALUE:this.setValueToCell(t,e);break;case u.ClipboardCellType.FORMULA:this.setFormulaToCellFromCache(t.hash,e);break;case u.ClipboardCellType.EMPTY:this.setCellEmpty(e);break;case u.ClipboardCellType.PARSING_ERROR:this.setParsingErrorToCell(t.rawInput,t.errors,e)}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(void 0===t||t instanceof h.EmptyCellVertex)return[e,{type:u.ClipboardCellType.EMPTY}];if(t instanceof h.ValueCellVertex)return[e,Object.assign({type:u.ClipboardCellType.VALUE},t.getValues())];if(t instanceof d.FormulaVertex)return[t.getAddress(this.lazilyTransformingAstService),{type:u.ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof h.ParsingErrorVertex)return[e,{type:u.ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(void 0===t||t instanceof h.EmptyCellVertex)return{type:u.ClipboardCellType.EMPTY};if(t instanceof h.ValueCellVertex)return Object.assign({type:u.ClipboardCellType.VALUE},t.getValues());if(t instanceof h.ArrayVertex){const r=t.getArrayCellValue(e);return r===f.EmptyValue?{type:u.ClipboardCellType.EMPTY}:{type:u.ClipboardCellType.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}if(t instanceof h.FormulaCellVertex)return{type:u.ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof h.ParsingErrorVertex)return{type:u.ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors};throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),s=new Array(t);for(let n=0;n<t;n++){s[n]=new Array(r);for(let t=0;t<r;t++){const r=(0,o.simpleCellAddress)(e,t,n);s[n][t]=this.getClipboardCell(r)}}return s}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),s=this.getOldContent(e);if(r instanceof i.CellContent.Formula){const t=this.parser.parse(r.formula,e),{ast:s,errors:n}=t;if(n.length>0)this.setParsingErrorToCell(r.formula,n,e);else{const r=this.arraySizePredictor.checkArraySize(s,e);this.setFormulaToCell(e,r,t)}}else r instanceof i.CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return s}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let s=0;s<t[r].length;s++){const n=(0,o.simpleCellAddress)(e,s,r);this.setCellContent(n,t[r][s])}}setParsingErrorToCell(e,t,r){const s=this.dependencyGraph.getCellValue(r),n=new h.ParsingErrorVertex(t,e),a=this.dependencyGraph.setParsingErrorToCell(r,n);this.columnSearch.remove((0,f.getRawValue)(s),r),this.columnSearch.applyChanges(a.getChanges()),this.changes.addAll(a),this.changes.addChange(n.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:s,hasStructuralChangeFunction:a,dependencies:o}){const i=this.dependencyGraph.getCellValue(e),u=this.dependencyGraph.setFormulaToCell(e,r,(0,n.absolutizeDependencies)(o,e),t,s,a);this.columnSearch.remove((0,f.getRawValue)(i),e),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),s=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change((0,f.getRawValue)(r),(0,f.getRawValue)(e.parsedValue),t),this.columnSearch.applyChanges(s.getChanges().filter(e=>!(0,o.equalSimpleCellAddress)(e.address,t))),this.changes.addAll(s),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove((0,f.getRawValue)(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(f.EmptyValue,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:s,hasStructuralChangeFunction:a,dependencies:o}=this.parser.fetchCachedResult(e),i=(0,n.absolutizeDependencies)(o,t),[u]=new m.CleanOutOfScopeDependenciesTransformer(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(u);const l=(0,n.filterDependenciesOutOfScope)(i),h=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,u,l,h,s,a)}rowEffectivelyNotInSheet(e,t){return e>=this.dependencyGraph.addressMapping.getHeight(t)}getAndClearContentChanges(){const e=this.changes;return this.changes=l.ContentChanges.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[r]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:r,cellType:this.getClipboardCell(r)});const{affectedArrays:r,contentChanges:s}=this.dependencyGraph.removeRows(e);let n;return this.columnSearch.applyChanges(s.getChanges()),this.stats.measure(M.StatType.TRANSFORM_ASTS,()=>{const t=new T.RemoveRowsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),n=this.lazilyTransformingAstService.addTransformation(t)}),this.rewriteAffectedArrays(r),{version:n,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[r]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:r,cellType:this.getClipboardCell(r)});const{affectedArrays:r,contentChanges:s}=this.dependencyGraph.removeColumns(e);let n;return this.columnSearch.applyChanges(s.getChanges()),this.columnSearch.removeColumns(e),this.stats.measure(M.StatType.TRANSFORM_ASTS,()=>{const t=new E.RemoveColumnsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),n=this.lazilyTransformingAstService.addTransformation(t)}),this.rewriteAffectedArrays(r),{version:n,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(M.StatType.TRANSFORM_ASTS,()=>{const t=new c.AddRowsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(t)}),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const e=t.getFormula(this.lazilyTransformingAstService),r=t.getAddress(this.lazilyTransformingAstService),s=this.parser.computeHashFromAst(e);this.setFormulaToCellFromCache(s,r)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(M.StatType.TRANSFORM_ASTS,()=>{const t=new p.AddColumnsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(t)}),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){return e>=this.dependencyGraph.addressMapping.getWidth(t)}adjustNamedExpressionEdges(e,t,r){if(void 0===r)return;const s=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),o=this.dependencyGraph.fetchCellOrCreateEmpty(a.address);for(const t of this.dependencyGraph.graph.adjacentNodes(o))if(t instanceof h.FormulaCellVertex&&t.getAddress(this.lazilyTransformingAstService).sheet===r){const r=t.getFormula(this.lazilyTransformingAstService),a=t.getAddress(this.lazilyTransformingAstService),{dependencies:i}=this.parser.fetchCachedResultForAst(r);for(const r of(0,n.absolutizeDependencies)(i,a))r instanceof N.NamedExpressionDependency&&r.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdge(o,t),this.dependencyGraph.graph.addEdge(s,t))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof i.CellContent.Formula){const t=this.parser.parse(r.formula,(0,o.simpleCellAddress)(-1,0,0));if((0,R.doesContainRelativeReferences)(t.ast))throw new A.NoRelativeAddressesAllowedError;const{ast:s,hasVolatileFunction:i,hasStructuralChangeFunction:u,dependencies:l}=t;this.dependencyGraph.setFormulaToCell(e,s,(0,n.absolutizeDependencies)(l,e),a.ArraySize.scalar(),i,u)}else r instanceof i.CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,n){if(e.sheet===n.sheet)return[];const a=[],o=s.AbsoluteCellRange.spanFrom(n,t,r);for(const t of o.addresses(this.dependencyGraph)){const r=this.addressMapping.fetchCell(t);if(r instanceof h.FormulaCellVertex&&t.sheet!==e.sheet){const s=r.getFormula(this.lazilyTransformingAstService),{dependencies:n}=this.parser.fetchCachedResultForAst(s);a.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,t,n))}}return a}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const s=[],a=this.addressMapping.fetchCell(t);for(const o of(0,n.absolutizeDependencies)(r,t)){if(!(o instanceof N.NamedExpressionDependency))continue;const r=o.name,n=this.dependencyGraph.fetchNamedExpressionVertex(r,e),i=this.namedExpressions.isExpressionInScope(r,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(r,t.sheet):this.copyOrFetchGlobalNamedExpressionVertex(r,n,s);i!==n&&(this.dependencyGraph.graph.softRemoveEdge(n,a),this.dependencyGraph.graph.addEdge(i,a))}return s}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(-1,new h.SparseStrategy(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let s=this.namedExpressions.namedExpressionForScope(e);if(void 0===s)if(s=this.namedExpressions.addNamedExpression(e),r.push(s.normalizeExpressionName()),t instanceof h.FormulaCellVertex){const e=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:r,hasVolatileFunction:o,hasStructuralChangeFunction:i,dependencies:u}=e;this.dependencyGraph.setFormulaToCell(s.address,r,(0,n.absolutizeDependencies)(u,s.address),a.ArraySize.scalar(),o,i)}else t instanceof h.EmptyCellVertex?this.setCellEmpty(s.address):t instanceof h.ValueCellVertex&&this.setValueToCell(t.getValues(),s.address);return this.dependencyGraph.fetchCellOrCreateEmpty(s.address)}}},function(e,t,r){"use strict";t.__esModule=!0,t.AddColumnsTransformer=void 0;var s=r(1),n=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.Transformer{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=(0,s.absoluteSheetReference)(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const n=e.toSimpleColumnAddress(t);if(r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return this.columnsSpan.columnStart<=n.col&&e.shiftedByColumns(this.columnsSpan.numberOfColumns);if(t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet)return!e.isColumnAbsolute()&&(!(t.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(-this.columnsSpan.numberOfColumns));if(e.isColumnAbsolute())return!(e.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(this.columnsSpan.numberOfColumns);return e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?!(t.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart&&e.shiftedByColumns(this.columnsSpan.numberOfColumns)}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),a=this.transformCellAddress(t,r);return n===s.ErrorType.REF||a===s.ErrorType.REF?s.ErrorType.REF:!(!n&&!a)&&[n||e,a||t]}}t.AddColumnsTransformer=a},function(e,t,r){"use strict";t.__esModule=!0,t.Transformer=void 0;var s=r(1),n=r(6);t.Transformer=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[s,n]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),a=t.rememberNewAst(s);r.setFormula(a),r.setAddress(n)}}transformSingleAst(e,t){return[this.transformAst(e,t),this.fixNodeAddress(t)]}transformAst(e,t){switch(e.type){case n.AstNodeType.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case n.AstNodeType.CELL_RANGE:return this.transformCellRangeAst(e,t);case n.AstNodeType.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case n.AstNodeType.ROW_RANGE:return this.transformRowRangeAst(e,t);case n.AstNodeType.EMPTY:case n.AstNodeType.ERROR:case n.AstNodeType.NUMBER:case n.AstNodeType.NAMED_EXPRESSION:case n.AstNodeType.ERROR_WITH_RAW_INPUT:case n.AstNodeType.STRING:return e;case n.AstNodeType.PERCENT_OP:case n.AstNodeType.MINUS_UNARY_OP:case n.AstNodeType.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case n.AstNodeType.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map(e=>this.transformAst(e,t))});case n.AstNodeType.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case n.AstNodeType.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map(e=>e.map(e=>this.transformAst(e,t)))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof n.CellAddress?Object.assign(Object.assign({},e),{reference:r}):r===s.ErrorType.REF?(0,n.buildCellErrorAst)(new s.CellError(s.ErrorType.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===s.ErrorType.REF?(0,n.buildCellErrorAst)(new s.CellError(s.ErrorType.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===s.ErrorType.REF?(0,n.buildCellErrorAst)(new s.CellError(s.ErrorType.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===s.ErrorType.REF?(0,n.buildCellErrorAst)(new s.CellError(s.ErrorType.REF)):e}}},function(e,t,r){"use strict";t.__esModule=!0,t.AddRowsTransformer=void 0;var s=r(1),n=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.Transformer{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=(0,s.absoluteSheetReference)(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const n=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=n.row&&e.shiftedByRows(this.rowsSpan.numberOfRows):t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?!e.isRowAbsolute()&&(!(t.row<this.rowsSpan.rowStart)&&e.shiftedByRows(-this.rowsSpan.numberOfRows)):e.isRowAbsolute()?!(e.row<this.rowsSpan.rowStart)&&e.shiftedByRows(this.rowsSpan.numberOfRows):n.row<this.rowsSpan.rowStart?!(t.row<this.rowsSpan.rowStart)&&e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart&&e.shiftedByRows(this.rowsSpan.numberOfRows)}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),a=this.transformCellAddress(t,r);return n===s.ErrorType.REF||a===s.ErrorType.REF?s.ErrorType.REF:!(!n&&!a)&&[n||e,a||t]}}t.AddRowsTransformer=a},function(e,t,r){"use strict";t.__esModule=!0,t.CleanOutOfScopeDependenciesTransformer=void 0;var s=r(1),n=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.Transformer{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return!!e.isInvalid(t)&&s.ErrorType.REF}transformCellRange(e,t,r){return!(!e.isInvalid(r)&&!t.isInvalid(r))&&s.ErrorType.REF}transformColumnRange(e,t,r){return!(!e.isInvalid(r)&&!t.isInvalid(r))&&s.ErrorType.REF}transformRowRange(e,t,r){return!(!e.isInvalid(r)&&!t.isInvalid(r))&&s.ErrorType.REF}}t.CleanOutOfScopeDependenciesTransformer=a},function(e,t,r){"use strict";t.__esModule=!0,t.MoveCellsTransformer=void 0;var s=r(1),n=r(6),a=r(10),o=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.Transformer{constructor(e,t,r,s){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=s,this.dependentFormulaTransformer=new u(e,t,r,s)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){if(this.sourceRange.addressInRange(t)){return[this.transformAst(e,t),this.fixNodeAddress(t)]}return this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return(0,s.simpleCellAddress)(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof n.CellAddress){const s=e.toSimpleCellAddress(t);if(r.addressInRange(s))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const s=this.sourceRange;if(e instanceof n.CellAddress&&t instanceof n.CellAddress){const n=e.toSimpleCellAddress(r),a=t.toSimpleCellAddress(r);if(s.addressInRange(n)&&s.addressInRange(a))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}t.MoveCellsTransformer=i;class u extends o.Transformer{constructor(e,t,r,s){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=s}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return!!this.shouldMove(e,t)&&e.moved(this.toSheet,this.toRight,this.toBottom)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof n.CellAddress?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof a.RowAddress?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const s=this.transformCellAddress(e,r),n=this.transformCellAddress(t,r);return!(!s||!n)&&[s,n]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveColumnsTransformer=void 0;var s=r(1),n=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.Transformer{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=(0,s.absoluteSheetReference)(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const r=e.toSimpleColumnAddress(t);if(r.col<this.columnsSpan.columnStart)return!1;if(r.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const r=e.toSimpleColumnAddress(t);if(r.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(r.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return s.ErrorType.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=(0,s.absoluteSheetReference)(e,r);let a=e,o=t;if(this.columnsSpan.sheet===n){const n=e.toSimpleColumnAddress(r),i=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=n.col&&this.columnsSpan.columnEnd>=i.col)return s.ErrorType.REF;n.col>=this.columnsSpan.columnStart&&n.col<=this.columnsSpan.columnEnd&&(a=e.shiftedByColumns(this.columnsSpan.columnEnd-n.col+1)),i.col>=this.columnsSpan.columnStart&&i.col<=this.columnsSpan.columnEnd&&(o=t.shiftedByColumns(-(i.col-this.columnsSpan.columnStart+1)))}const i=this.transformCellAddress(a,r),u=this.transformCellAddress(o,r);if(!1===i&&!1===u)return[a,o];if(i===s.ErrorType.REF||u===s.ErrorType.REF)throw Error("Cannot happen");return[i||a,u||o]}}t.RemoveColumnsTransformer=a},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveRowsTransformer=void 0;var s=r(1),n=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.Transformer{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=(0,s.absoluteSheetReference)(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const r=e.toSimpleRowAddress(t);if(r.row<this.rowsSpan.rowStart)return!1;if(r.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const r=e.toSimpleRowAddress(t);if(r.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(r.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return s.ErrorType.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=(0,s.absoluteSheetReference)(e,r);let a=e,o=t;if(this.rowsSpan.sheet===n){const n=e.toSimpleRowAddress(r),i=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=n.row&&this.rowsSpan.rowEnd>=i.row)return s.ErrorType.REF;n.row>=this.rowsSpan.rowStart&&n.row<=this.rowsSpan.rowEnd&&(a=e.shiftedByRows(this.rowsSpan.rowEnd-n.row+1)),i.row>=this.rowsSpan.rowStart&&i.row<=this.rowsSpan.rowEnd&&(o=t.shiftedByRows(-(i.row-this.rowsSpan.rowStart+1)))}const i=this.transformCellAddress(a,r),u=this.transformCellAddress(o,r);return!1===i&&!1===u?[a,o]:i===s.ErrorType.REF||u===s.ErrorType.REF?s.ErrorType.REF:[i||a,u||o]}}t.RemoveRowsTransformer=a},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveSheetTransformer=void 0;var s=r(1),n=r(71);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.Transformer{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const t of e.arrayFormulaNodes()){const[r]=this.transformSingleAst(t.getFormula(e.lazilyTransformingAstService),t.getAddress(e.lazilyTransformingAstService));t.setFormula(r)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet&&s.ErrorType.REF}}t.RemoveSheetTransformer=a},function(e,t,r){"use strict";t.__esModule=!0,t.findBoundaries=function(e){let t=0,r=0,s=0;for(let n=0;n<e.length;n++){let a=0;for(let t=0;t<e[n].length;t++){const r=e[n][t];null!=r&&(a=t+1,++s)}t=Math.max(t,a),a>0&&(r=n+1)}const n=t*r;return{height:r,width:t,fill:0===n?0:s/n}},t.validateAsSheet=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e){if(!Array.isArray(e))throw new s.InvalidArgumentsError("an array of arrays.");for(let t=0;t<e.length;t++)if(!Array.isArray(e[t]))throw new s.InvalidArgumentsError("an array of arrays.")};var s=r(5)},function(e,t,r){"use strict";t.__esModule=!0,t.UndoRedo=t.SetSheetContentUndoEntry=t.SetRowOrderUndoEntry=t.SetColumnOrderUndoEntry=t.SetCellContentsUndoEntry=t.RenameSheetUndoEntry=t.RemoveSheetUndoEntry=t.RemoveRowsUndoEntry=t.RemoveNamedExpressionUndoEntry=t.RemoveColumnsUndoEntry=t.PasteUndoEntry=t.MoveRowsUndoEntry=t.MoveColumnsUndoEntry=t.MoveCellsUndoEntry=t.ClearSheetUndoEntry=t.ChangeNamedExpressionUndoEntry=t.BatchUndoEntry=t.BaseUndoEntry=t.AddSheetUndoEntry=t.AddRowsUndoEntry=t.AddNamedExpressionUndoEntry=t.AddColumnsUndoEntry=void 0;var s=r(1),n=r(69);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a{}t.BaseUndoEntry=a;t.RemoveRowsUndoEntry=class extends a{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}};t.MoveCellsUndoEntry=class extends a{constructor(e,t,r,s,n,a,o){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=s,this.overwrittenCellsData=n,this.addedGlobalNamedExpressions=a,this.version=o}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}};t.AddRowsUndoEntry=class extends a{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}};t.SetRowOrderUndoEntry=class extends a{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}};t.SetColumnOrderUndoEntry=class extends a{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}};t.SetSheetContentUndoEntry=class extends a{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}};t.MoveRowsUndoEntry=class extends a{constructor(e,t,r,s,n){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=s,this.version=n,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}};t.MoveColumnsUndoEntry=class extends a{constructor(e,t,r,s,n){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=s,this.version=n,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}};t.AddColumnsUndoEntry=class extends a{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}};t.RemoveColumnsUndoEntry=class extends a{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}};t.AddSheetUndoEntry=class extends a{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}};t.RemoveSheetUndoEntry=class extends a{constructor(e,t,r,s,n){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=s,this.version=n}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}};t.RenameSheetUndoEntry=class extends a{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}};t.ClearSheetUndoEntry=class extends a{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}};t.SetCellContentsUndoEntry=class extends a{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}};t.PasteUndoEntry=class extends a{constructor(e,t,r,s){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=s}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}};t.AddNamedExpressionUndoEntry=class extends a{constructor(e,t,r,s){super(),this.name=e,this.newContent=t,this.scope=r,this.options=s}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}};t.RemoveNamedExpressionUndoEntry=class extends a{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}};t.ChangeNamedExpressionUndoEntry=class extends a{constructor(e,t,r,s,n){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=s,this.options=n}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}};class o extends a{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}t.BatchUndoEntry=o;t.UndoRedo=class{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){void 0!==this.batchUndoEntry?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new o}commitBatchMode(){if(void 0===this.batchUndoEntry)throw"Batch mode wasn't started";this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]);this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return 0===this.undoStack.length}isRedoStackEmpty(){return 0===this.redoStack.length}undo(){const e=this.undoStack.pop();if(!e)throw"Attempted to undo without operation on stack";this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let e=r.length-1;e>=0;--e){const s=r[e];this.operations.addRows(new n.AddRowsCommand(t,[[s.rowFrom,s.rowCount]]));for(const{address:e,cellType:t}of s.removedCells)this.operations.restoreCell(e,t);this.restoreOldDataFromVersion(s.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let e=r.length-1;e>=0;--e){const s=r[e];this.operations.addColumns(new n.AddColumnsCommand(t,[[s.columnFrom,s.columnCount]]));for(const{address:e,cellType:t}of s.removedCells)this.operations.restoreCell(e,t);this.restoreOldDataFromVersion(s.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const s=t[r];this.operations.removeRows(new n.RemoveRowsCommand(e.command.sheet,[[s.rowStart,s.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const s=t[r];this.operations.removeColumns(new n.RemoveColumnsCommand(e.command.sheet,[[s.columnStart,s.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const e=t.address,[r,n]=t.oldContent;(0,s.equalSimpleCellAddress)(e,r)||this.operations.setCellEmpty(e),this.operations.restoreCell(r,n)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let e=0;e<t.length;e++){const n=t[e];for(let t=0;t<n.length;t++){const a=n[t],o=(0,s.simpleCellAddress)(r,t,e);this.operations.restoreCell(o,a)}}for(const[t,s]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(t,s,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let e=0;e<t.length;e++){const n=t[e];for(let t=0;t<n.length;t++){const a=n[t],o=(0,s.simpleCellAddress)(r,t,e);this.operations.restoreCell(o,a)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let e=0;e<t.length;e++){const n=t[e];for(let t=0;t<n.length;t++){const a=n[t],o=(0,s.simpleCellAddress)(r,t,e);this.operations.restoreCell(o,a)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw"Attempted to redo without operation on stack";this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,n=r.length,a=r[0].length;for(let e=0;e<n;++e)for(let n=0;n<a;++n){const a=(0,s.simpleCellAddress)(t.sheet,t.col+n,t.row+e);this.operations.restoreCell(a,r[e][n])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const e of t){const[t,r]=e;this.operations.setFormulaToCellFromCache(r,t)}}}},function(e,t,r){"use strict";t.__esModule=!0,t.Evaluator=void 0;var s=r(4),n=r(23),a=r(1),o=r(24),i=r(2),u=r(40),l=r(27),h=r(32),d=r(25),p=r(33);t.Evaluator=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r,s,n,a){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=s,this.dependencyGraph=n,this.columnSearch=a}run(){this.stats.start(p.StatType.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(p.StatType.TOP_SORT),this.stats.measure(p.StatType.EVALUATION,()=>{this.recomputeFormulas(t,e)})}partialRun(e){const t=o.ContentChanges.empty();return this.stats.measure(p.StatType.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,e=>{if(e instanceof u.FormulaVertex){const r=e.isComputed()?e.getCellValue():void 0,s=this.recomputeFormulaVertexValue(e);if(s!==r){const n=e.getAddress(this.lazilyTransformingAstService);return t.addChange(s,n),this.columnSearch.change((0,h.getRawValue)(r),(0,h.getRawValue)(s),n),!0}return!1}return!(e instanceof i.RangeVertex)||(e.clearCache(),!0)},e=>{if(e instanceof i.RangeVertex)e.clearCache();else if(e instanceof u.FormulaVertex){const r=e.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove((0,h.getRawValue)(e.valueOrUndef()),r);const s=new a.CellError(a.ErrorType.CYCLE,void 0,e);e.setCellValue(s),t.addChange(s,r)}})}),t}runAndForget(e,t,r){const a=[];for(const e of(0,n.absolutizeDependencies)(r,t))if(e instanceof s.AbsoluteCellRange){const t=e;if(void 0===this.dependencyGraph.getRange(t.start,t.end)){const e=new i.RangeVertex(t);this.dependencyGraph.rangeMapping.setRange(e),a.push(e)}}const o=this.evaluateAstToCellValue(e,new l.InterpreterState(t,this.config.useArrayArithmetic));return a.forEach(e=>{this.dependencyGraph.rangeMapping.removeRange(e)}),o}recomputeFormulas(e,t){e.forEach(e=>{e instanceof u.FormulaVertex&&e.setCellValue(new a.CellError(a.ErrorType.CYCLE,void 0,e))}),t.forEach(e=>{if(e instanceof u.FormulaVertex){const t=this.recomputeFormulaVertexValue(e),r=e.getAddress(this.lazilyTransformingAstService);this.columnSearch.add((0,h.getRawValue)(t),r)}else e instanceof i.RangeVertex&&e.clearCache()})}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof i.ArrayVertex&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),s=this.evaluateAstToCellValue(r,new l.InterpreterState(t,this.config.useArrayArithmetic,e));return e.setCellValue(s)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof d.SimpleRangeValue?r:r===h.EmptyValue&&this.config.evaluateNullToZero?0:r}}},function(e,t,r){"use strict";t.__esModule=!0,t.Exporter=t.ExportedNamedExpressionChange=t.ExportedCellChange=void 0;var s=r(1),n=r(53),a=r(18),o=r(32),i=r(25),u=r(68),l=r(7);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class h{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}t.ExportedCellChange=h;class d{constructor(e,t){this.name=e,this.newValue=t}}t.ExportedNamedExpressionChange=d;t.Exporter=class{constructor(e,t,r,s){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=s}exportChange(e){const t=e.value,r=e.address;if(r.sheet===u.NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS){const e=this.namedExpressions.namedExpressionInAddress(r.row);if(!e)throw new Error("Missing named expression");return new d(e.displayName,this.exportScalarOrRange(t))}if(t instanceof i.SimpleRangeValue){const e=[];for(const[s,n]of t.entriesFromTopLeftCorner(r))e.push(new h(n,this.exportValue(s)));return e}return new h(r,this.exportValue(t))}exportValue(e){return e instanceof i.SimpleRangeValue?this.detailedError(new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.ScalarExpected)):this.config.smartRounding&&(0,o.isExtendedNumber)(e)?this.cellValueRounding((0,o.getRawValue)(e)):e instanceof s.CellError?this.detailedError(e):e===o.EmptyValue?null:(0,o.getRawValue)(e)}exportScalarOrRange(e){return e instanceof i.SimpleRangeValue?e.rawData().map(e=>e.map(e=>this.exportValue(e))):this.exportValue(e)}detailedError(e){var t,r;let s=void 0;const a=null===(t=e.root)||void 0===t?void 0:t.getAddress(this.lazilyTransformingService);return void 0!==a&&(s=a.sheet===u.NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS?null===(r=this.namedExpressions.namedExpressionInAddress(a.row))||void 0===r?void 0:r.displayName:(0,l.simpleCellAddressToString)(this.sheetIndexMapping,a,-1)),new n.DetailedCellError(e,this.config.translationPackage.getErrorTranslation(e.type),s)}cellValueRounding(e){if(0===e)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleStrategy=t.GraphBuilder=void 0;var s=r(23),n=r(26),a=r(1),o=r(65),i=r(2),u=r(32),l=r(33);t.GraphBuilder=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r,s,n,a){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=s,this.stats=n,this.arraySizePredictor=a,this.buildStrategy=new h(e,t,r,n,s,a)}buildGraph(e,t){const r=t.measure(l.StatType.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(e));this.dependencyGraph.getAndClearContentChanges(),t.measure(l.StatType.PROCESS_DEPENDENCIES,()=>this.processDependencies(r))}processDependencies(e){e.forEach((e,t)=>{this.dependencyGraph.processCellDependencies(e,t)})}};class h{constructor(e,t,r,s,n,a){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=s,this.cellContentParser=n,this.arraySizePredictor=a}run(e){const t=new Map;for(const r in e){const h=this.dependencyGraph.getSheetId(r),d=e[r];for(let e=0;e<d.length;++e){const r=d[e];for(let d=0;d<r.length;++d){const p=r[d],c=(0,a.simpleCellAddress)(h,d,e),m=this.cellContentParser.parse(p);if(m instanceof o.CellContent.Formula){const e=this.stats.measure(l.StatType.PARSER,()=>this.parser.parse(m.formula,c));if(e.errors.length>0){this.shrinkArrayIfNeeded(c);const t=new i.ParsingErrorVertex(e.errors,m.formula);this.dependencyGraph.addVertex(c,t)}else{this.shrinkArrayIfNeeded(c);const r=this.arraySizePredictor.checkArraySize(e.ast,c);if(r.isScalar()){const r=new i.FormulaCellVertex(e.ast,c,0);t.set(r,(0,s.absolutizeDependencies)(e.dependencies,c)),this.dependencyGraph.addVertex(c,r),e.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(r),e.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(r)}else{const a=new i.ArrayVertex(e.ast,c,new n.ArraySize(r.width,r.height));t.set(a,(0,s.absolutizeDependencies)(e.dependencies,c)),this.dependencyGraph.addArrayVertex(c,a)}}}else if(m instanceof o.CellContent.Empty);else{this.shrinkArrayIfNeeded(c);const e=new i.ValueCellVertex(m.value,p);this.columnIndex.add((0,u.getRawValue)(m.value),c),this.dependencyGraph.addVertex(c,e)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof i.ArrayVertex&&this.dependencyGraph.shrinkArrayToCorner(t)}}t.SimpleStrategy=h},function(e,t,r){"use strict";t.__esModule=!0,t.FunctionRegistry=void 0;var s=r(5),n=r(63),a=r(84);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function o(e,t){var r;let n=t.implementedFunctions[e];const a=null===(r=t.aliases)||void 0===r?void 0:r[e];if(void 0!==a){if(void 0!==n)throw new s.AliasAlreadyExisting(e,t.name);n=t.implementedFunctions[a]}if(void 0===n)throw s.FunctionPluginValidationError.functionNotDeclaredInPlugin(e,t.name);return n}class i{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=e=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(e),this.isFunctionVolatile=e=>this.volatileFunctions.has(e),this.isArrayFunction=e=>this.arrayFunctions.has(e),this.isFunctionDependentOnSheetStructureChange=e=>this.structuralChangeFunctions.has(e),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)i.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(i.plugins);for(const[e,t]of i.protectedFunctions())i.loadFunctionUnprotected(t,e,this.instancePlugins);for(const[e,t]of this.instancePlugins.entries())this.categorizeFunction(e,o(e,t))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),void 0!==t&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),void 0!==r&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw s.ProtectedFunctionError.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw s.ProtectedFunctionError.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){return this.functionIsProtected(e)?void 0:this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(n.HyperFormula.getRegisteredLanguagesCodes());Object.keys(e).forEach(r=>{t.has(r)&&n.HyperFormula.getLanguage(r).extendFunctions(e[r])})}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach(r=>{this.loadPluginFunction(e,r,t)}),void 0!==e.aliases&&Object.keys(e.aliases).forEach(r=>{this.loadPluginFunction(e,r,t)})}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw s.ProtectedFunctionError.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static loadFunctionUnprotected(e,t,r){const n=o(t,e).method;if(!Object.prototype.hasOwnProperty.call(e.prototype,n))throw s.FunctionPluginValidationError.functionMethodNotFound(n,e.name);r.set(t,e)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)void 0!==t&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)void 0!==e&&(yield e)}initializePlugins(e){const t=[];for(const[r,s]of this.instancePlugins.entries()){let n=t.find(e=>e instanceof s);void 0===n&&(n=new s(e),t.push(n));const a=o(r,s),i=a.method;this.functions.set(r,[i,n]);const u=a.arraySizeMethod;void 0!==u&&this.arraySizeFunctions.set(r,[u,n])}}getFunctionPlugin(e){if(!i.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(void 0!==t&&this.config.translationPackage.isFunctionTranslated(e)){const[e,r]=t;return(t,s)=>r[e](t,s)}}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(void 0!==t&&this.config.translationPackage.isFunctionTranslated(e)){const[e,r]=t;return(t,s)=>r[e](t,s)}}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)i.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.arrayFunction&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}t.FunctionRegistry=i,i.plugins=new Map,i._protectedPlugins=new Map([["VERSION",a.VersionPlugin],["OFFSET",void 0]])},function(e,t,r){"use strict";t.__esModule=!0,t.VersionPlugin=void 0;var s=r(63),n=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
const a=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class o extends n.FunctionPlugin{version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:e,licenseKey:t}=this.config;let r;return a.has(t)?r=a.get(t):a.has(e)?r=a.get(e):"valid"===e&&(r=t.slice(-5)),`HyperFormula v${s.HyperFormula.version}, ${r}`})}}t.VersionPlugin=o,o.implementedFunctions={VERSION:{method:"version",parameters:[]}}},function(e,t,r){"use strict";t.__esModule=!0,t.Interpreter=void 0;var s=r(4),n=r(41),a=r(1),o=r(18),i=r(14),u=r(29),l=r(86),h=r(83),d=r(27),p=r(32),c=r(25);function m(e,t){return t instanceof a.CellError?t:e(t)}function g(e,t,r){return t instanceof a.CellError?t:r instanceof a.CellError?r:e(t,r)}t.Interpreter=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r,s,n,a,o,i,h,d){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=s,this.arithmeticHelper=n,this.functionRegistry=a,this.namedExpressions=o,this.serialization=i,this.arraySizePredictor=h,this.dateTimeHelper=d,this.equalOp=(e,t)=>g(this.arithmeticHelper.eq,e,t),this.notEqualOp=(e,t)=>g(this.arithmeticHelper.neq,e,t),this.greaterThanOp=(e,t)=>g(this.arithmeticHelper.gt,e,t),this.lessThanOp=(e,t)=>g(this.arithmeticHelper.lt,e,t),this.greaterThanOrEqualOp=(e,t)=>g(this.arithmeticHelper.geq,e,t),this.lessThanOrEqualOp=(e,t)=>g(this.arithmeticHelper.leq,e,t),this.concatOp=(e,t)=>g(this.arithmeticHelper.concat,(0,u.coerceScalarToString)(e),(0,u.coerceScalarToString)(t)),this.plusOp=(e,t)=>g(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.minusOp=(e,t)=>g(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.timesOp=(e,t)=>g(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.powerOp=(e,t)=>g(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.divOp=(e,t)=>g(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.unaryMinusOp=e=>m(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(e)),this.percentOp=e=>m(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(e)),this.unaryPlusOp=e=>this.arithmeticHelper.unaryPlus(e),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new l.CriterionBuilder(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if((0,p.isExtendedNumber)(r)){if((0,u.isNumberOverflow)((0,p.getRawValue)(r)))return new a.CellError(a.ErrorType.NUM,o.ErrorMessage.NaN);r=(0,p.cloneNumber)(r,(0,u.fixNegativeZero)((0,p.getRawValue)(r)))}return r instanceof c.SimpleRangeValue&&1===r.height()&&1===r.width()&&([[r]]=r.data),function(e,t){if(e instanceof a.CellError&&void 0!==t)return e.attachRootVertex(t);return e}(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case i.AstNodeType.EMPTY:return p.EmptyValue;case i.AstNodeType.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return(0,a.invalidSimpleCellAddress)(r)?new a.CellError(a.ErrorType.REF,o.ErrorMessage.BadRef):this.dependencyGraph.getCellValue(r)}case i.AstNodeType.NUMBER:case i.AstNodeType.STRING:return e.value;case i.AstNodeType.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,s,t)}case i.AstNodeType.EQUALS_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,s,t)}case i.AstNodeType.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,s,t)}case i.AstNodeType.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,s,t)}case i.AstNodeType.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,s,t)}case i.AstNodeType.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,s,t)}case i.AstNodeType.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,s,t)}case i.AstNodeType.PLUS_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,s,t)}case i.AstNodeType.MINUS_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,s,t)}case i.AstNodeType.TIMES_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,s,t)}case i.AstNodeType.POWER_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,s,t)}case i.AstNodeType.DIV_OP:{const r=this.evaluateAst(e.left,t),s=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,s,t)}case i.AstNodeType.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case i.AstNodeType.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case i.AstNodeType.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case i.AstNodeType.FUNCTION_CALL:{if("valid"!==this.config.licenseKeyValidityState&&!h.FunctionRegistry.functionIsProtected(e.procedureName))return new a.CellError(a.ErrorType.LIC,o.ErrorMessage.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return void 0!==r?r(e,new d.InterpreterState(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new a.CellError(a.ErrorType.NAME,o.ErrorMessage.FunctionName(e.procedureName))}case i.AstNodeType.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new a.CellError(a.ErrorType.NAME,o.ErrorMessage.NamedExpressionName(e.expressionName))}case i.AstNodeType.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new a.CellError(a.ErrorType.REF,o.ErrorMessage.RangeManySheets);const r=s.AbsoluteCellRange.fromCellRange(e,t.formulaAddress),i=this.dependencyGraph.getArray(r);if(i){const e=i.array;if(e instanceof n.NotComputedArray)throw new Error("Array should be already computed");if(e instanceof a.CellError)return e;if(e instanceof n.ArrayValue)return c.SimpleRangeValue.fromRange(e.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}return c.SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case i.AstNodeType.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new a.CellError(a.ErrorType.REF,o.ErrorMessage.RangeManySheets);const r=s.AbsoluteColumnRange.fromColumnRange(e,t.formulaAddress);return c.SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case i.AstNodeType.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new a.CellError(a.ErrorType.REF,o.ErrorMessage.RangeManySheets);const r=s.AbsoluteRowRange.fromRowRangeAst(e,t.formulaAddress);return c.SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case i.AstNodeType.PARENTHESIS:return this.evaluateAst(e.expression,t);case i.AstNodeType.ARRAY:{let r=void 0;const s=[];for(const n of e.args){let e=void 0;const i=[];for(const r of n){const s=(0,u.coerceToRange)(this.evaluateAst(r,t)),n=s.height();if(void 0===e)e=n,i.push(...s.data);else{if(e!==n)return new a.CellError(a.ErrorType.REF,o.ErrorMessage.SizeMismatch);for(let e=0;e<n;e++)i[e].push(...s.data[e])}}const l=i[0].length;if(void 0===r)r=l,s.push(...i);else{if(r!==l)return new a.CellError(a.ErrorType.REF,o.ErrorMessage.SizeMismatch);s.push(...i)}}return c.SimpleRangeValue.onlyValues(s)}case i.AstNodeType.ERROR_WITH_RAW_INPUT:case i.AstNodeType.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var s;if(t instanceof c.SimpleRangeValue&&!r.arraysFlag&&(t=null!==(s=(0,u.coerceRangeToScalar)(t,r))&&void 0!==s?s:new a.CellError(a.ErrorType.VALUE,o.ErrorMessage.ScalarExpected)),t instanceof a.CellError)return t;if(t instanceof c.SimpleRangeValue){const r=t.data.map(t=>t.map(e));return c.SimpleRangeValue.onlyValues(r)}return e(t)}binaryRangeWrapper(e,t,r,s){var n,i;if(t instanceof c.SimpleRangeValue&&!s.arraysFlag&&(t=null!==(n=(0,u.coerceRangeToScalar)(t,s))&&void 0!==n?n:new a.CellError(a.ErrorType.VALUE,o.ErrorMessage.ScalarExpected)),t instanceof a.CellError)return t;if(r instanceof c.SimpleRangeValue&&!s.arraysFlag&&(r=null!==(i=(0,u.coerceRangeToScalar)(r,s))&&void 0!==i?i:new a.CellError(a.ErrorType.VALUE,o.ErrorMessage.ScalarExpected)),r instanceof a.CellError)return r;if(t instanceof c.SimpleRangeValue||r instanceof c.SimpleRangeValue){if(!(t instanceof c.SimpleRangeValue)){if(r.isAdHoc()){const s=r.data;for(let r=0;r<s.length;r++)for(let n=0;n<s[0].length;n++)s[r][n]=e(t,s[r][n]);return c.SimpleRangeValue.onlyValues(s)}t=c.SimpleRangeValue.fromScalar(t)}if(!(r instanceof c.SimpleRangeValue)){if(t.isAdHoc()){const s=t.data;for(let t=0;t<s.length;t++)for(let n=0;n<s[0].length;n++)s[t][n]=e(s[t][n],r);return c.SimpleRangeValue.onlyValues(s)}r=c.SimpleRangeValue.fromScalar(r)}if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const s=t.data,n=r.data;for(let t=0;t<s.length;t++)for(let r=0;r<s[0].length;r++)s[t][r]=e(s[t][r],n[t][r]);return c.SimpleRangeValue.onlyValues(s)}if(r.isAdHoc()){const s=t.data,n=r.data;for(let t=0;t<s.length;t++)for(let r=0;r<s[0].length;r++)n[t][r]=e(s[t][r],n[t][r]);return c.SimpleRangeValue.onlyValues(n)}}const s=Math.max(t.width(),r.width()),n=Math.max(t.height(),r.height()),o=Array(n);for(let e=0;e<n;e++)o[e]=Array(s);for(let i=0;i<n;i++){const n=1!==t.height()?i:0,u=1!==r.height()?i:0;for(let l=0;l<s;l++){const s=1!==t.width()?l:0,h=1!==r.width()?l:0;n<t.height()&&u<r.height()&&s<t.width()&&h<r.width()?o[i][l]=e(t.data[n][s],r.data[u][h]):o[i][l]=new a.CellError(a.ErrorType.NA)}}return c.SimpleRangeValue.onlyValues(o)}return e(t,r)}}},function(e,t,r){"use strict";t.__esModule=!0,t.buildCriterionLambda=t.buildCriterion=t.CriterionType=t.CriterionBuilder=void 0;var s,n=r(32);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.CriterionType=s,function(e){e.GREATER_THAN="GREATER_THAN",e.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",e.LESS_THAN="LESS_THAN",e.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",e.NOT_EQUAL="NOT_EQUAL",e.EQUAL="EQUAL"}(s||(t.CriterionType=s={}));const a=(e,t)=>({operator:e,value:t});t.buildCriterion=a;t.CriterionBuilder=class{constructor(e){var t,r,s,n;this.trueString=null!==(r=null===(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))||void 0===t?void 0:t.toLowerCase())&&void 0!==r?r:"true",this.falseString=null!==(n=null===(s=e.translationPackage.getMaybeFunctionTranslation("FALSE"))||void 0===s?void 0:s.toLowerCase())&&void 0!==n?n:"false"}fromCellValue(e,t){if("string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e)return;const r=this.parseCriterion(e,t);return void 0!==r?{raw:e,lambda:i(r,t)}:void 0}parseCriterion(e,t){if("number"==typeof e||"boolean"==typeof e)return a(s.EQUAL,e);if("string"==typeof e){const r=o.exec(e);let i,u;r?(u=function(e){switch(e){case">":return s.GREATER_THAN;case">=":return s.GREATER_THAN_OR_EQUAL;case"<":return s.LESS_THAN;case"<=":return s.LESS_THAN_OR_EQUAL;case"<>":return s.NOT_EQUAL;case"=":return s.EQUAL;default:return}}(r[1]),i=r[2]):(u=s.EQUAL,i=e);const l=t.coerceToMaybeNumber(i),h=i.toLowerCase()===this.trueString||i.toLowerCase()!==this.falseString&&void 0;if(void 0===u)return;if(""===i)return a(u,null);if(void 0!==l)return a(u,(0,n.getRawValue)(l));if(u===s.EQUAL||u===s.NOT_EQUAL)return a(u,null!=h?h:i)}}};const o=/([<>=]+)(.*)/;const i=(e,t)=>{switch(e.operator){case s.GREATER_THAN:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)>0:e=>!1;case s.GREATER_THAN_OR_EQUAL:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)>=0:e=>!1;case s.LESS_THAN:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)<0:e=>!1;case s.LESS_THAN_OR_EQUAL:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)<=0:e=>!1;case s.EQUAL:return"number"==typeof e.value?r=>{if("number"==typeof r)return 0===t.floatCmp(r,e.value);if("string"==typeof r){if(""===r)return!1;const s=t.coerceToMaybeNumber(r);return void 0!==s&&0===t.floatCmp(s,e.value)}return!1}:"string"==typeof e.value?t.eqMatcherFunction(e.value):"boolean"==typeof e.value?t=>"boolean"==typeof t&&t===e.value:e=>e===n.EmptyValue;case s.NOT_EQUAL:return"number"==typeof e.value?r=>{if("number"==typeof r)return 0!==t.floatCmp(r,e.value);if("string"==typeof r){if(""===r)return!0;const s=t.coerceToMaybeNumber(r);return void 0===s||0!==t.floatCmp(s,e.value)}return!0}:"string"==typeof e.value?t.neqMatcherFunction(e.value):"boolean"==typeof e.value?t=>"boolean"!=typeof t||t!==e.value:e=>e!==n.EmptyValue}};t.buildCriterionLambda=i},function(e,t,r){"use strict";t.__esModule=!0,t.LazilyTransformingAstService=void 0;var s=r(88),n=r(33);t.LazilyTransformingAstService=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return void 0!==this.combinedTransformer?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new s.CombinedTransformer(e)}commitCombinedMode(){if(void 0===this.combinedTransformer)throw"Combined mode wasn't started";return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(n.StatType.TRANSFORM_ASTS_POSTPONED);for(let s=r;s<this.transformations.length;s++){const r=this.transformations[s];r.isIrreversible()&&(this.undoRedo.storeDataForVersion(s,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[n,a]=r.transformSingleAst(e,t);e=n,t=a}const s=this.parser.rememberNewAst(e);return this.stats.end(n.StatType.TRANSFORM_ASTS_POSTPONED),[s,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const e=this.transformations[r];t&&!t(e)||(yield e)}}}},function(e,t,r){"use strict";t.__esModule=!0,t.CombinedTransformer=void 0;t.CombinedTransformer=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach(r=>r.performEagerTransformations(e,t))}transformSingleAst(e,t){let[r,s]=[e,t];return this.transformations.forEach(e=>{[r,s]=e.transformSingleAst(r,s)}),[r,s]}isIrreversible(){return!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.buildColumnSearchStrategy=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e,t,r){return t.useColumnIndex?new n.ColumnIndex(e,t,r):new s.ColumnBinarySearch(e,t)};var s=r(90),n=r(93)},function(e,t,r){"use strict";t.__esModule=!0,t.ColumnBinarySearch=void 0;var s=r(29),n=r(91),a=r(32),o=r(92);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.AdvancedFind{constructor(e,t){super(e),this.dependencyGraph=e,this.config=t}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,s){}removeValues(e){}find(e,t,r){"string"==typeof e&&(e=(0,s.forceNormalizeString)(e));const o=t.range;return void 0===o?t.valuesFromTopLeftCorner().map(a.getRawValue).map(e=>"string"==typeof e?(0,s.forceNormalizeString)(e):e).indexOf(e):r?(0,n.rangeLowerBound)(o,e,this.dependencyGraph,"row"):this.dependencyGraph.computeListOfValuesInRange(o).findIndex(t=>(t="string"==typeof(t=(0,a.getRawValue)(t))?(0,s.forceNormalizeString)(t):t)===e)}}t.ColumnBinarySearch=i},function(e,t,r){"use strict";t.__esModule=!0,t.compare=o,t.lowerBound=a,t.rangeLowerBound=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e,t,r,o){let i;i="col"===o?e.effectiveEndColumn(r):e.effectiveEndRow(r);const u=e.start[o];let l;l="row"===o?t=>(0,n.getRawValue)(r.getCellValue((0,s.simpleCellAddress)(e.sheet,e.start.col,t))):t=>(0,n.getRawValue)(r.getCellValue((0,s.simpleCellAddress)(e.sheet,t,e.start.row)));const h=a(l,t,u,i);return typeof l(h)!=typeof t?-1:h-u};var s=r(1),n=r(32);function a(e,t,r,s){for(;r<=s;){const n=Math.floor((r+s)/2),a=o(t,e(n));if(a>0)r=n+1;else if(a<0)s=n-1;else{if(r==n)return n;s=n}}return s}function o(e,t){return typeof e==typeof t?e===n.EmptyValue?0:e<t?-1:e>t?1:0:e===n.EmptyValue?-1:t===n.EmptyValue?1:t instanceof s.CellError||"number"==typeof e&&"string"==typeof t||"number"==typeof e&&"boolean"==typeof t?-1:"string"==typeof e&&"number"==typeof t?1:"string"==typeof e&&"boolean"==typeof t?-1:1}},function(e,t,r){"use strict";t.__esModule=!0,t.AdvancedFind=void 0;var s=r(32);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.AdvancedFind=class{constructor(e){this.dependencyGraph=e}advancedFind(e,t){let r;const n=t.range;r=void 0===n?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(n);for(let t=0;t<r.length;t++)if(e((0,s.getRawValue)(r[t])))return t;return-1}}},function(e,t,r){"use strict";t.__esModule=!0,t.ColumnIndex=void 0,t.lowerBound=p,t.upperBound=d;var s=r(1),n=r(72),a=r(76),o=r(29),i=r(32),u=r(25),l=r(33),h=r(90);function d(e,t){let r=0,s=e.length-1;for(;r<=s;){const n=Math.floor((r+s)/2);if(t>e[n])r=n+1;else{if(!(t<e[n]))return n;s=n-1}}return r}function p(e,t){let r=0,s=e.length-1;for(;r<=s;){const n=Math.floor((r+s)/2);if(t>e[n])r=n+1;else{if(!(t<e[n]))return n;s=n-1}}return s}t.ColumnIndex=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new h.ColumnBinarySearch(e,t)}add(e,t){if(!(e===i.EmptyValue||e instanceof s.CellError))if(e instanceof u.SimpleRangeValue)for(const[r,s]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue((0,i.getRawValue)(r),s);else this.addSingleCellValue(e,t)}remove(e,t){if(void 0!==e)if(e instanceof u.SimpleRangeValue)for(const[r,s]of e.entriesFromTopLeftCorner(t))this.removeSingleValue((0,i.getRawValue)(r),s);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)void 0!==t.oldValue&&this.change((0,i.getRawValue)(t.oldValue),(0,i.getRawValue)(t.value),t.address)}moveValues(e,t,r,n){for(const[a,o]of e){const e=(0,s.movedSimpleCellAddress)(o,n,t,r);this.remove(a,o),this.add(a,e)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,r){const s=t.range;if(void 0===s)return this.binarySearchStrategy.find(e,t,r);this.ensureRecentData(s.sheet,s.start.col,e);const n=this.getColumnMap(s.sheet,s.start.col);if(!n)return-1;"string"==typeof e&&(e=(0,o.forceNormalizeString)(e));const a=n.get(e);if(!a)return this.binarySearchStrategy.find(e,t,r);const i=d(a.index,s.start.row),u=a.index[i];return u<=s.end.row?u-s.start.row:this.binarySearchStrategy.find(e,t,r)}advancedFind(e,t){return this.binarySearchStrategy.advancedFind(e,t)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let s=r[t];return s||(s=new Map,r[t]=s),s}getValueIndex(e,t,r){const s=this.getColumnMap(e,t);let n=this.getColumnMap(e,t).get(r);return n||(n={version:this.transformingService.version(),index:[]},s.set(r,n)),n}ensureRecentData(e,t,r){const s=this.getValueIndex(e,t,r),o=this.transformingService.version();if(s.version===o)return;const i=this.transformingService.getTransformationsFrom(s.version,t=>t.sheet===e&&(t instanceof n.AddRowsTransformer||t instanceof a.RemoveRowsTransformer));for(const e of i)e instanceof n.AddRowsTransformer?this.addRows(t,e.rowsSpan,r):e instanceof a.RemoveRowsTransformer&&this.removeRows(t,e.rowsSpan,r);s.version=o}addSingleCellValue(e,t){this.stats.measure(l.StatType.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e),"string"==typeof e&&(e=(0,o.forceNormalizeString)(e));const r=this.getValueIndex(t.sheet,t.col,e);this.addValue(r,t.row)})}removeSingleValue(e,t){this.stats.measure(l.StatType.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);"string"==typeof e&&(e=(0,o.forceNormalizeString)(e));const s=r.get(e);if(!s)return;const n=d(s.index,t.row);s.index.splice(n,1),0===s.index.length&&r.delete(e),0===r.size&&delete this.index.get(t.sheet)[t.col]})}addRows(e,t,r){const s=this.getValueIndex(t.sheet,e,r);this.shiftRows(s,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const s=this.getValueIndex(t.sheet,e,r);this.removeRowsFromValues(s,t),this.shiftRows(s,t.rowEnd+1,-t.numberOfRows)}addValue(e,t){const r=p(e.index,t);e.index[r]!==t&&(r===e.index.length-1?e.index.push(t):e.index.splice(r+1,0,t))}removeRowsFromValues(e,t){const r=d(e.index,t.rowStart),s=p(e.index,t.rowEnd);e.index[r]<=t.rowEnd&&e.index.splice(r,s-r+1)}shiftRows(e,t,r){for(let s=d(e.index,t);s<e.index.length;++s)e.index[s]+=r}}},function(e,t,r){"use strict";t.__esModule=!0,t.NumberLiteralHelper=void 0;t.NumberLiteralHelper=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class{constructor(e){this.config=e;const t="."===this.config.thousandSeparator?"\\"+this.config.thousandSeparator:this.config.thousandSeparator,r="."===this.config.decimalSeparator?"\\"+this.config.decimalSeparator:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(""+t,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);if(isNaN(t))return;return t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}},function(e,t,r){"use strict";t.__esModule=!0,t.Serialization=void 0;var s=r(1),n=r(2),a=r(6);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof n.FormulaCellVertex){const s=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=null!=t?t:e,this.unparser.unparse(s,t)}if(r instanceof n.ArrayVertex){const s=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(s.row!==e.row||s.col!==e.col||s.sheet!==e.sheet)return;t=null!=t?t:e;const n=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(void 0!==n)return this.unparser.unparse(n,t)}else if(r instanceof n.ParsingErrorVertex)return r.getFormula()}getCellSerialized(e,t){var r;return null!==(r=this.getCellFormula(e,t))&&void 0!==r?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,e=>this.getCellValue(e))}getSheetFormulas(e){return this.genericSheetGetter(e,e=>this.getCellFormula(e))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),n=this.dependencyGraph.getSheetWidth(e),a=new Array(r);for(let o=0;o<r;o++){a[o]=new Array(n);for(let r=0;r<n;r++){const n=(0,s.simpleCellAddress)(e,r,o);a[o][r]=t(n)}for(let e=n-1;e>=0&&(null===a[o][e]||void 0===a[o][e]);e--)a[o].pop()}for(let e=r-1;e>=0&&0===a[e].length;e--)a.pop();return a}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const s=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(s)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,e=>this.getCellSerialized(e))}getAllSheetsValues(){return this.genericAllSheetsGetter(e=>this.getSheetValues(e))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(e=>this.getSheetFormulas(e))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(e=>this.getSheetSerialized(e))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const s=this.dependencyGraph.sheetMapping.fetch(r);e[s]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(t=>({name:t.expression.displayName,expression:this.getCellSerialized(t.expression.address),scope:void 0!==t.scope?e[t.scope]:void 0,options:t.expression.options}))}withNewConfig(e,t){const r=new a.Unparser(e,(0,a.buildLexerConfig)(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new o(this.dependencyGraph,r,this.exporter)}}t.Serialization=o},function(e,t,r){"use strict";function s(e){return()=>{throw new Error(`The "${e}" method cannot be called because this HyperFormula instance has been destroyed`)}}t.__esModule=!0,t.objectDestroy=
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function(e){for(const[t,r]of Object.entries(e))r instanceof Function?e[t]=s(r):delete e[t]}},function(e,t,r){"use strict";t.__esModule=!0,t.Events=t.Emitter=void 0;var s,n=r(98);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */t.Events=s,function(e){e.SheetAdded="sheetAdded",e.SheetRemoved="sheetRemoved",e.SheetRenamed="sheetRenamed",e.NamedExpressionAdded="namedExpressionAdded",e.NamedExpressionRemoved="namedExpressionRemoved",e.ValuesUpdated="valuesUpdated",e.EvaluationSuspended="evaluationSuspended",e.EvaluationResumed="evaluationResumed"}(s||(t.Events=s={}));class a extends n.TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}t.Emitter=a},function(e,t){e.exports=r},function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var s={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};t.default=s},function(e,t,r){"use strict";t.__esModule=!0;var s=r(28);t.FunctionPlugin=s.FunctionPlugin},function(e,t,r){"use strict";t.__esModule=!0,t.TrigonometryPlugin=t.TextPlugin=t.SumprodPlugin=t.SumifPlugin=t.StatisticalPlugin=t.StatisticalAggregationPlugin=t.SqrtPlugin=t.SimpleArithmerticPlugin=t.RoundingPlugin=t.RomanPlugin=t.RandomPlugin=t.RadixConversionPlugin=t.RadiansPlugin=t.PowerPlugin=t.NumericAggregationPlugin=t.ModuloPlugin=t.MedianPlugin=t.MatrixPlugin=t.MathPlugin=t.MathConstantsPlugin=t.LookupPlugin=t.LogarithmPlugin=t.IsOddPlugin=t.IsEvenPlugin=t.InformationPlugin=t.FormulaTextPlugin=t.FinancialPlugin=t.ExpPlugin=t.DeltaPlugin=t.DegreesPlugin=t.DateTimePlugin=t.CountUniquePlugin=t.CountBlankPlugin=t.ComplexPlugin=t.CodePlugin=t.CharPlugin=t.BooleanPlugin=t.BitwiseLogicOperationsPlugin=t.BitShiftPlugin=t.ArrayPlugin=t.AbsPlugin=void 0;var s=r(102);t.ArrayPlugin=s.ArrayPlugin;var n=r(103);t.AbsPlugin=n.AbsPlugin;var a=r(104);t.BitShiftPlugin=a.BitShiftPlugin;var o=r(105);t.BitwiseLogicOperationsPlugin=o.BitwiseLogicOperationsPlugin;var i=r(106);t.BooleanPlugin=i.BooleanPlugin;var u=r(107);t.CharPlugin=u.CharPlugin;var l=r(108);t.CodePlugin=l.CodePlugin;var h=r(109);t.CountBlankPlugin=h.CountBlankPlugin;var d=r(110);t.CountUniquePlugin=d.CountUniquePlugin;var p=r(111);t.DateTimePlugin=p.DateTimePlugin;var c=r(112);t.DegreesPlugin=c.DegreesPlugin;var m=r(113);t.DeltaPlugin=m.DeltaPlugin;var g=r(114);t.ExpPlugin=g.ExpPlugin;var E=r(115);t.FinancialPlugin=E.FinancialPlugin;var T=r(116);t.FormulaTextPlugin=T.FormulaTextPlugin;var y=r(117);t.InformationPlugin=y.InformationPlugin;var A=r(118);t.IsEvenPlugin=A.IsEvenPlugin;var f=r(119);t.IsOddPlugin=f.IsOddPlugin;var R=r(120);t.LogarithmPlugin=R.LogarithmPlugin;var N=r(121);t.MathConstantsPlugin=N.MathConstantsPlugin;var C=r(122);t.MatrixPlugin=C.MatrixPlugin;var S=r(123);t.MedianPlugin=S.MedianPlugin;var M=r(124);t.ModuloPlugin=M.ModuloPlugin;var w=r(125);t.NumericAggregationPlugin=w.NumericAggregationPlugin;var v=r(126);t.PowerPlugin=v.PowerPlugin;var O=r(127);t.RadiansPlugin=O.RadiansPlugin;var I=r(128);t.RadixConversionPlugin=I.RadixConversionPlugin;var b=r(129);t.RandomPlugin=b.RandomPlugin;var F=r(130);t.RoundingPlugin=F.RoundingPlugin;var V=r(131);t.SqrtPlugin=V.SqrtPlugin;var U=r(132);t.SumifPlugin=U.SumifPlugin;var x=r(135);t.SumprodPlugin=x.SumprodPlugin;var L=r(136);t.TextPlugin=L.TextPlugin;var P=r(137);t.TrigonometryPlugin=P.TrigonometryPlugin;var _=r(138);t.LookupPlugin=_.LookupPlugin;var B=r(140);t.RomanPlugin=B.RomanPlugin;var D=r(141);t.SimpleArithmerticPlugin=D.SimpleArithmerticPlugin;var G=r(142);t.StatisticalPlugin=G.StatisticalPlugin;var H=r(145);t.MathPlugin=H.MathPlugin;var W=r(146);t.ComplexPlugin=W.ComplexPlugin;var k=r(147);t.StatisticalAggregationPlugin=k.StatisticalAggregationPlugin},function(e,t,r){"use strict";t.__esModule=!0,t.ArrayPlugin=void 0;var s=r(26),n=r(1),a=r(18),o=r(6),i=r(29),u=r(27),l=r(25),h=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class d extends h.FunctionPlugin{arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),e=>e)}arrayformulaArraySize(e,t){if(1!==e.args.length)return s.ArraySize.error();const r=this.metadata("ARRAYFORMULA");return e.args.map(e=>{var s;return this.arraySizeForAst(e,new u.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))})[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(e,t,r)=>{t=Math.min(t,e.height()),r=Math.min(r,e.width());const s=e.data,n=[];for(let e=0;e<t;e++)n.push(s[e].slice(0,r));return l.SimpleRangeValue.onlyValues(n)})}arrayconstrainArraySize(e,t){if(3!==e.args.length)return s.ArraySize.error();const r=this.metadata("ARRAY_CONSTRAIN"),n=e.args.map(e=>{var s;return this.arraySizeForAst(e,new u.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))});let{height:a,width:i}=n[0];return e.args[1].type===o.AstNodeType.NUMBER&&(a=Math.min(a,e.args[1].value)),e.args[2].type===o.AstNodeType.NUMBER&&(i=Math.min(i,e.args[2].value)),a<1||i<1||!Number.isInteger(a)||!Number.isInteger(i)?s.ArraySize.error():new s.ArraySize(i,a)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(e,...t)=>{for(const r of t)if(e.width()!==r.width()||e.height()!==r.height())return new n.CellError(n.ErrorType.NA,a.ErrorMessage.EqualLength);if(e.width()>1&&e.height()>1)return new n.CellError(n.ErrorType.NA,a.ErrorMessage.WrongDimension);const r=e.data,s=[];for(let n=0;n<e.height();n++){const a=[];for(let s=0;s<e.width();s++){let e=!0;for(const r of t){if(!0!==(0,i.coerceScalarToBoolean)(r.data[n][s])){e=!1;break}}e&&a.push(r[n][s])}a.length>0&&s.push(a)}return s.length>0?l.SimpleRangeValue.onlyValues(s):new n.CellError(n.ErrorType.NA,a.ErrorMessage.EmptyRange)})}filterArraySize(e,t){if(e.args.length<=1)return s.ArraySize.error();const r=this.metadata("FILTER"),n=e.args.map(e=>{var s;return this.arraySizeForAst(e,new u.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))}),a=Math.max(...n.map(e=>e.width)),o=Math.max(...n.map(e=>e.height));return new s.ArraySize(a,o)}}t.ArrayPlugin=d,d.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",arraySizeMethod:"arrayformulaArraySize",arrayFunction:!0,parameters:[{argumentType:h.ArgumentTypes.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",arraySizeMethod:"arrayconstrainArraySize",parameters:[{argumentType:h.ArgumentTypes.RANGE},{argumentType:h.ArgumentTypes.INTEGER,minValue:1},{argumentType:h.ArgumentTypes.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",arraySizeMethod:"filterArraySize",arrayFunction:!0,parameters:[{argumentType:h.ArgumentTypes.RANGE},{argumentType:h.ArgumentTypes.RANGE}],repeatLastArgs:1}}},function(e,t,r){"use strict";t.__esModule=!0,t.AbsPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}t.AbsPlugin=n,n.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.BitShiftPlugin=void 0;var s=r(1),n=r(18),a=r(28);class o extends a.FunctionPlugin{bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),i)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),u)}}function i(e,t){return t<0?u(e,-t):l(e*Math.pow(2,t))}function u(e,t){return t<0?i(e,-t):l(Math.floor(e/Math.pow(2,t)))}function l(e){return e>0xffffffffffff?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.BitshiftLong):e}t.BitShiftPlugin=o,o.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:a.ArgumentTypes.INTEGER,minValue:0},{argumentType:a.ArgumentTypes.INTEGER,minValue:-53,maxValue:53}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:a.ArgumentTypes.INTEGER,minValue:0},{argumentType:a.ArgumentTypes.INTEGER,minValue:-53,maxValue:53}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.BitwiseLogicOperationsPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(e,t)=>e&t)}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(e,t)=>e|t)}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(e,t)=>e^t)}}t.BitwiseLogicOperationsPlugin=n,n.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:s.ArgumentTypes.INTEGER,minValue:0},{argumentType:s.ArgumentTypes.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:s.ArgumentTypes.INTEGER,minValue:0},{argumentType:s.ArgumentTypes.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:s.ArgumentTypes.INTEGER,minValue:0},{argumentType:s.ArgumentTypes.INTEGER,minValue:0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.BooleanPlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),()=>!0)}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),()=>!1)}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(e,t,r)=>e?t:r)}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(...e)=>!e.some(e=>!e))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(...e)=>e.some(e=>e))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),e=>!e)}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(...e)=>{let t=0;return e.forEach(e=>{e&&t++}),t%2==1})}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),(e,...t)=>{const r=t.length;let a=0;for(;a+1<r;a+=2)if(!(t[a]instanceof s.CellError)&&this.arithmeticHelper.eq(e,t[a]))return t[a+1];return a<r?t[a]:new s.CellError(s.ErrorType.NA,n.ErrorMessage.NoDefault)})}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(e,t)=>e instanceof s.CellError?t:e)}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(e,t)=>e instanceof s.CellError&&e.type===s.ErrorType.NA?t:e)}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(e,...t)=>e>t.length?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.Selector):t[e-1])}}t.BooleanPlugin=o,o.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:a.ArgumentTypes.BOOLEAN},{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:a.ArgumentTypes.SCALAR,defaultValue:!1,passSubtype:!0}]},AND:{method:"and",parameters:[{argumentType:a.ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:a.ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:a.ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:a.ArgumentTypes.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:a.ArgumentTypes.NOERROR},{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:a.ArgumentTypes.INTEGER,minValue:1},{argumentType:a.ArgumentTypes.SCALAR,passSubtype:!0}],repeatLastArgs:1}}},function(e,t,r){"use strict";t.__esModule=!0,t.CharPlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),e=>e<1||e>=256?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.CharacterCodeBounds):String.fromCharCode(Math.trunc(e)))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),e=>e<1||e>=1114112?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.CharacterCodeBounds):String.fromCodePoint(Math.trunc(e)))}}t.CharPlugin=o,o.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.CodePlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),e=>0===e.length?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.EmptyString):e.charCodeAt(0))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),e=>{var t;return null!==(t=e.codePointAt(0))&&void 0!==t?t:new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.EmptyString)})}}t.CodePlugin=o,o.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:a.ArgumentTypes.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:a.ArgumentTypes.STRING}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.CountBlankPlugin=void 0;var s=r(32),n=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.FunctionPlugin{countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(...e)=>{let t=0;return e.forEach(e=>{e===s.EmptyValue&&t++}),t})}}t.CountBlankPlugin=a,a.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:n.ArgumentTypes.SCALAR}],repeatLastArgs:1,expandRanges:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.CountUniquePlugin=void 0;var s=r(1),n=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.FunctionPlugin{countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(...e)=>{const t=new Set,r=new Set;for(const n of e)n instanceof s.CellError?r.add(n.type):""!==n&&t.add(n);return t.size+r.size})}}t.CountUniquePlugin=a,a.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:n.ArgumentTypes.SCALAR}],repeatLastArgs:1,expandRanges:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.DateTimePlugin=void 0;var s=r(1),n=r(57),a=r(18),o=r(59),i=r(32),u=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class l extends u.FunctionPlugin{constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),s=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),n=this.dateTimeHelper.relativeNumberToAbsoluteNumber(s),a=n+((4-n)%7+7)%7,o=Math.floor((t-1)/7)-Math.floor((a-1)/7)+1;return 0===o?this.isoweeknumCore(e-7)+1:o},this.days360Core=(e,t,r)=>{const s=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.numberToSimpleDate(t);let o,i;return r?(o=(0,n.toBasisEU)(s),i=(0,n.toBasisEU)(a)):[o,i]=this.dateTimeHelper.toBasisUS(s,a),360*(i.year-o.year)+30*(i.month-o.month)+i.day-o.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),(e,t,r)=>{const n=Math.trunc(r);let o=Math.trunc(t),i=Math.trunc(e);i<this.dateTimeHelper.getEpochYearZero()&&(i+=this.dateTimeHelper.getEpochYearZero());const u=Math.floor((o-1)/12);i+=u,o-=12*u;const l={year:i,month:o,day:1};if(this.dateTimeHelper.isValidDate(l)){let e=this.dateTimeHelper.dateToNumber(l)+(n-1);return e=this.dateTimeHelper.getWithinBounds(e),void 0===e?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.DateBounds):e}return new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.InvalidDate)})}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(e,t,r)=>{const o=(0,n.timeToNumber)({hours:Math.trunc(e),minutes:Math.trunc(t),seconds:Math.trunc(r)});return o<0?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.NegativeTime):o%1})}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),(e,t)=>{const r=this.dateTimeHelper.numberToSimpleDate(e);let o=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth((0,n.offsetMonth)(r,t)));return o=this.dateTimeHelper.getWithinBounds(o),void 0===o?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.DateBounds):o})}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),e=>this.dateTimeHelper.numberToSimpleDate(e).day)}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(e,t)=>Math.trunc(e)-Math.trunc(t))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),e=>this.dateTimeHelper.numberToSimpleDate(e).month)}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),e=>this.dateTimeHelper.numberToSimpleDate(e).year)}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),e=>(0,n.numberToSimpleTime)((0,n.roundToNearestSecond)(e)%1).hours)}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),e=>(0,n.numberToSimpleTime)((0,n.roundToNearestSecond)(e)%1).minutes)}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),e=>(0,n.numberToSimpleTime)((0,n.roundToNearestSecond)(e)%1).seconds)}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),(e,t)=>(0,o.format)(e,t,this.config,this.dateTimeHelper))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(e,t)=>{const r=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));if(3===t)return(r-1)%7;const n=p.get(t);return void 0===n?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.BadMode):(r-n)%7+1})}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(e,t)=>{const r=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),n=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.dateToNumber({year:n.year,month:1,day:1}),i=this.dateTimeHelper.relativeNumberToAbsoluteNumber(o);if(21===t)return this.isoweeknumCore(e);const u=p.get(t);return void 0===u?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.BadMode):Math.floor((r-u)/7)-Math.floor((i-u)/7)+1})}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),e=>{const{dateTime:t}=this.dateTimeHelper.parseDateTimeFromConfigFormats(e);return void 0===t?new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.IncorrectDateTime):(0,n.instanceOfSimpleDate)(t)?((0,n.instanceOfSimpleTime)(t)?Math.trunc((0,n.timeToNumber)(t)):0)+this.dateTimeHelper.dateToNumber(t):0})}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),e=>{const t=this.dateTimeHelper.dateStringToDateNumber(e);return void 0===t?new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.IncorrectDateTime):(0,i.getRawValue)(t)%1})}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),()=>{const e=new Date(Date.now());return(0,n.timeToNumber)({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()})+this.dateTimeHelper.dateToNumber({year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()})})}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),()=>{const e=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()})})}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),(e,t)=>{const r=this.dateTimeHelper.numberToSimpleDate(e),o=(0,n.truncateDayInMonth)((0,n.offsetMonth)(r,t));let i=this.dateTimeHelper.dateToNumber(o);return i=this.dateTimeHelper.getWithinBounds(i),void 0===i?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.DateBounds):i})}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),(e,t,r)=>{if(e>t)return new s.CellError(s.ErrorType.NUM,a.ErrorMessage.StartEndDate);if("D"===r)return Math.floor(t)-Math.floor(e);const n=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.numberToSimpleDate(t);switch(r){case"M":return 12*(o.year-n.year)+(o.month-n.month)-(o.day<n.day?1:0);case"YM":return(o.month-n.month+12-(o.day<n.day?1:0))%12;case"Y":return o.month>n.month||o.month===n.month&&o.day>=n.day?o.year-n.year:o.year-n.year-1;case"MD":if(o.day>=n.day)return o.day-n.day;{const e=1===o.month?12:o.month-1,t=1===o.month?o.year-1:o.year;return this.dateTimeHelper.daysInMonth(t,e)+o.day-n.day}case"YD":return o.month>n.month||o.month===n.month&&o.day>=n.day?Math.floor(t)-this.dateTimeHelper.dateToNumber({year:o.year,month:n.month,day:n.day}):Math.floor(t)-Math.floor(e)-365*(o.year-n.year-1)-this.dateTimeHelper.leapYearsCount(o.year-1)+this.dateTimeHelper.leapYearsCount(n.year);default:return new s.CellError(s.ErrorType.NUM,a.ErrorMessage.BadMode)}})}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(e,t,r)=>{switch((e=Math.trunc(e))>(t=Math.trunc(t))&&([e,t]=[t,e]),r){case 0:return this.days360Core(e,t,!1)/360;case 1:return(t-e)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(e),this.dateTimeHelper.numberToSimpleDate(t));case 2:return(t-e)/360;case 3:return(t-e)/365;case 4:return this.days360Core(e,t,!0)/360}throw new Error("Should not be reachable.")})}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),e=>{const t=(e=Math.trunc(e))%60,r=(e=Math.trunc(e/60))%60,s=(e=Math.trunc(e/60))%24,n=(e=Math.trunc(e/24))%30,a=(e=Math.trunc(e/30))%12,o=Math.trunc(e/12);return"P"+(o>0?o+"Y":"")+(a>0?a+"M":"")+(n>0?n+"D":"")+"T"+(s>0?s+"H":"")+(r>0?r+"M":"")+(t>0?t+"S":"")})}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(e,t,r)=>this.networkdayscore(e,t,1,r))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(e,t,r,s)=>this.networkdayscore(e,t,r,s))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),(e,t,r)=>this.workdaycore(e,t,1,r))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(e,t,r,s)=>this.workdaycore(e,t,r,s))}networkdayscore(e,t,r,n){let a=1;(e=Math.trunc(e))>(t=Math.trunc(t))&&([e,t]=[t,e],a=-1);const o=d(r);if(o instanceof s.CellError)return o;const i=this.simpleRangeToFilteredHolidays(o,n);return i instanceof s.CellError?i:a*this.countWorkdays(e,t,o,i)}workdaycore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);const a=d(r);if(a instanceof s.CellError)return a;const o=this.simpleRangeToFilteredHolidays(a,n);if(o instanceof s.CellError)return o;if(t>0){let r=1;for(;this.countWorkdays(e+1,e+r,a,o)<t;)r*=2;let s=1;for(;s+1<r;){const n=Math.trunc((s+r)/2);this.countWorkdays(e+1,e+n,a,o)<t?s=n:r=n}return e+r}if(t<0){t*=-1;let r=1;for(;this.countWorkdays(e-r,e-1,a,o)<t;)r*=2;let s=1;for(;s+1<r;){const n=Math.trunc((s+r)/2);this.countWorkdays(e-n,e-1,a,o)<t?s=n:r=n}return e-r}return e}countWorkdays(e,t,r,s){const n=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),a=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let o=0;for(let e=0;e<7;e++)"0"===r.charAt(e)&&(o+=Math.floor((n+6-e)/7),o-=Math.floor((a-1+6-e)/7));return o-=h(t+1,s)-h(e,s),o}simpleRangeToFilteredHolidays(e,t){var r;const n=null!==(r=null==t?void 0:t.valuesFromTopLeftCorner())&&void 0!==r?r:[];for(const e of n)if(e instanceof s.CellError)return e;const o=[];for(const e of n)if(e!==i.EmptyValue){if(!(0,i.isExtendedNumber)(e))return new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.WrongType);o.push(Math.trunc((0,i.getRawValue)(e)))}return[...new Set(o)].sort((e,t)=>e-t).filter(t=>{const r=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)-1)%7;return"0"===e.charAt(r)})}}function h(e,t){if(0===t.length)return 0;if(e<=t[0])return 0;if(t[t.length-1]<e)return t.length;let r=0,s=t.length-1;for(;r+1<s;){const n=Math.floor((s+r)/2);t[n]>=e?s=n:r=n}return s}function d(e){var t;return"number"!=typeof e&&"string"!=typeof e?new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.WrongType):"string"==typeof e?7===e.length&&/^(0|1)*$/.test(e)&&"1111111"!==e?e:new s.CellError(s.ErrorType.NUM,a.ErrorMessage.WeekendString):null!==(t=c.get(e))&&void 0!==t?t:new s.CellError(s.ErrorType.NUM,a.ErrorMessage.BadMode)}t.DateTimePlugin=l,l.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.NUMBER}],returnNumberType:i.NumberType.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.NUMBER}],returnNumberType:i.NumberType.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER}],returnNumberType:i.NumberType.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:u.ArgumentTypes.STRING}],returnNumberType:i.NumberType.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:u.ArgumentTypes.STRING}],returnNumberType:i.NumberType.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:i.NumberType.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:i.NumberType.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER}],returnNumberType:i.NumberType.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NOERROR,defaultValue:1},{argumentType:u.ArgumentTypes.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:u.ArgumentTypes.NUMBER,minValue:0},{argumentType:u.ArgumentTypes.NUMBER},{argumentType:u.ArgumentTypes.NOERROR,defaultValue:1},{argumentType:u.ArgumentTypes.RANGE,optionalArg:!0}]}};const p=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),c=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]])},function(e,t,r){"use strict";t.__esModule=!0,t.DegreesPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),e=>e*(180/Math.PI))}}t.DegreesPlugin=n,n.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.DeltaPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(e,t)=>e===t?1:0)}}t.DeltaPlugin=n,n.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:s.ArgumentTypes.NUMBER},{argumentType:s.ArgumentTypes.NUMBER,defaultValue:0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ExpPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}t.ExpPlugin=n,n.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.FinancialPlugin=void 0;var s=r(1),n=r(18),a=r(32),o=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.FunctionPlugin{pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),u)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),l)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),d)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),h)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(e,t,r,a,o,i)=>{if(a>o)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.EndStartPeriod);let u=0;for(let s=a;s<=o;s++)u+=l(e,s,t,r,0,i);return u})}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(e,t,r,a,o,i)=>{if(a>o)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.EndStartPeriod);let u=0;for(let s=a;s<=o;s++)u+=d(e,s,t,r,0,i);return u})}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(e,t,r,a,o)=>{if(12===o&&a>r||a>r+1)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.PeriodLong);if(t>=e)return 0;const i=Math.round(1e3*(1-Math.pow(t/e,1/r)))/1e3,u=e*i*o/12;if(1===a)return u;let l=u;for(let t=0;t<a-2;t++)l+=(e-l)*i;return a===r+1?(e-l)*i*(12-o)/12:(e-l)*i})}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(e,t,r,n,a)=>{if(n>r)return new s.CellError(s.ErrorType.NUM);let o,i=a/r;i>=1?(i=1,o=1===n?e:0):o=e*Math.pow(1-i,n-1);const u=e*Math.pow(1-i,n);return Math.max(o-Math.max(t,u),0)})}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(e,t)=>{if(t<1)return new s.CellError(s.ErrorType.DIV_BY_ZERO);for(t=Math.trunc(t);t>10;)t/=10;return Math.trunc(e)+10*(e-Math.trunc(e))/t})}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(e,t)=>{if(t<1)return new s.CellError(s.ErrorType.DIV_BY_ZERO);for(t=Math.trunc(t);t>10;)t/=10;return Math.trunc(e)+(e-Math.trunc(e))*t/10})}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(e,t)=>(t=Math.trunc(t),Math.pow(1+e/t,t)-1))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(e,t,r,n)=>0===r?new s.CellError(s.ErrorType.DIV_BY_ZERO):n*e*(t/r-1))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(e,t)=>(t=Math.trunc(t),(Math.pow(e+1,1/t)-1)*t))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(e,t,r,n,a)=>0===e?0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):(-r-n)/t:(a&&(t*=1+e),Math.log((t-n*e)/(r*e+t))/Math.log(1+e)))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(e,t,r,n,a,o)=>{if(o<=-1)return new s.CellError(s.ErrorType.VALUE);let i=o;a=a?1:0;for(let o=0;o<50;o++){if(i<=-1)return new s.CellError(s.ErrorType.NUM);let o,u;if(Math.abs(i)<1e-7)o=r*(1+e*i)+t*(1+i*a)*e+n;else{const s=Math.pow(1+i,e);o=r*s+t*(1/i+a)*(s-1)+n}if(Math.abs(o)<1e-7)return i;if(Math.abs(i)<1e-7)u=r*e+t*a*e;else{const s=Math.pow(1+i,e),n=e*Math.pow(1+i,e-1);u=r*n+t*(1/i+a)*n+t*(-1/(i*i))*(s-1)}i-=o/u}return new s.CellError(s.ErrorType.NUM)})}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(e,t,r,n,a)=>(a=a?1:0,-1===e?0===t?new s.CellError(s.ErrorType.NUM):new s.CellError(s.ErrorType.DIV_BY_ZERO):0===e?-r*t-n:((1-Math.pow(1+e,t))*r*(1+e*a)/e-n)/Math.pow(1+e,t)))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(e,t,r)=>0===t||r<0&&t>0||r>0&&t<0?new s.CellError(s.ErrorType.NUM):Math.pow(r/t,1/e)-1)}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(e,t,r)=>0===r?new s.CellError(s.ErrorType.DIV_BY_ZERO):(e-t)/r)}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(e,t,r,n)=>n>r?new s.CellError(s.ErrorType.NUM):(e-t)*(r-n+1)*2/(r*(r+1)))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(e,t,r)=>{if((e=Math.round(e))>=(t=Math.round(t)))return new s.CellError(s.ErrorType.NUM);const n=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.numberToSimpleDate(t);if(a.year>n.year+1||a.year===n.year+1&&(a.month>n.month||a.month===n.month&&a.day>n.day))return new s.CellError(s.ErrorType.NUM);const o=360-r*(t-e);return 0===o?0:o<0?new s.CellError(s.ErrorType.NUM):365*r/o})}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(e,t,r)=>{if((e=Math.round(e))>=(t=Math.round(t)))return new s.CellError(s.ErrorType.NUM);const n=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.numberToSimpleDate(t);if(a.year>n.year+1||a.year===n.year+1&&(a.month>n.month||a.month===n.month&&a.day>n.day))return new s.CellError(s.ErrorType.NUM);const o=360-r*(t-e);return 0===o?0:o<0?new s.CellError(s.ErrorType.NUM):100*(1-r*(t-e)/360)})}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(e,t,r)=>{if((e=Math.round(e))>=(t=Math.round(t)))return new s.CellError(s.ErrorType.NUM);const n=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.numberToSimpleDate(t);return a.year>n.year+1||a.year===n.year+1&&(a.month>n.month||a.month===n.month&&a.day>n.day)?new s.CellError(s.ErrorType.NUM):360*(100-r)/(r*(t-e))})}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(e,t)=>{const r=t.valuesFromTopLeftCorner();for(const e of r)if(e instanceof s.CellError)return e;for(const t of r)if((0,a.isExtendedNumber)(t))e*=1+(0,a.getRawValue)(t);else if(t!==a.EmptyValue)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NumberExpected);return e})}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),(e,...t)=>{const r=this.arithmeticHelper.coerceNumbersExactRanges(t);return r instanceof s.CellError?r:p(e,r)})}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),(e,t,r)=>{const n=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());if(n instanceof s.CellError)return n;let a=!1,o=!1;const i=[],u=[];for(const e of n)e>0?(a=!0,i.push(e),u.push(0)):e<0?(o=!0,u.push(e),i.push(0)):(u.push(0),i.push(0));if(!a||!o)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const l=n.length,h=p(r,i);if(h instanceof s.CellError)return h;const d=p(t,u);return d instanceof s.CellError?d:Math.pow(-h*Math.pow(1+r,l)/d/(1+t),1/(l-1))-1})}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(e,t,r)=>(Math.log(r)-Math.log(t))/Math.log(1+e))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(e,t,r)=>{const a=t.valuesFromTopLeftCorner();for(const e of a)if("number"!=typeof e)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NumberExpected);const o=a,i=r.valuesFromTopLeftCorner();for(const e of i)if("number"!=typeof e)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NumberExpected);const u=i;if(u.length!==o.length)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.EqualLength);const l=u.length;let h=0;if(u[0]<0)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);for(let t=0;t<l;t++){if(u[t]=Math.floor(u[t]),u[t]<u[0])return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);h+=o[t]/Math.pow(1+e,(u[t]-u[0])/365)}return h})}}function u(e,t,r,s,n){if(0===e)return(-r-s)/t;{const a=Math.pow(1+e,t);return(s*e+r*e*a)*(n?1/(1+e):1)/(1-a)}}function l(e,t,r,s,n,a){const o=u(e,r,s,n,a);return 1===t?e*(a?0:-s):e*(a?h(e,t-2,o,s,a)-o:h(e,t-1,o,s,a))}function h(e,t,r,s,n){if(0===e)return-s-r*t;{const a=Math.pow(1+e,t);return r*(n?1+e:1)*(1-a)/e-s*a}}function d(e,t,r,s,n,a){return u(e,r,s,n,a)-l(e,t,r,s,n,a)}function p(e,t){let r=0;for(let n=t.length-1;n>=0;n--){if(r+=t[n],-1===e){if(0===r)continue;return new s.CellError(s.ErrorType.DIV_BY_ZERO)}r/=1+e}return r}t.FinancialPlugin=i,i.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.INTEGER,minValue:1},{argumentType:o.ArgumentTypes.INTEGER,minValue:1},{argumentType:o.ArgumentTypes.INTEGER,minValue:0,maxValue:1}],returnNumberType:a.NumberType.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.INTEGER,minValue:1},{argumentType:o.ArgumentTypes.INTEGER,minValue:1},{argumentType:o.ArgumentTypes.INTEGER,minValue:0,maxValue:1}],returnNumberType:a.NumberType.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.INTEGER,minValue:0},{argumentType:o.ArgumentTypes.INTEGER,minValue:0},{argumentType:o.ArgumentTypes.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:a.NumberType.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.INTEGER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:a.NumberType.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:1}],returnNumberType:a.NumberType.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:1}],returnNumberType:a.NumberType.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:o.ArgumentTypes.NUMBER,defaultValue:.1}],returnNumberType:a.NumberType.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER}],returnNumberType:a.NumberType.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER}],returnNumberType:a.NumberType.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:a.NumberType.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:a.NumberType.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:a.NumberType.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.RANGE}],returnNumberType:a.NumberType.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.ANY}],repeatLastArgs:1,returnNumberType:a.NumberType.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:o.ArgumentTypes.RANGE},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER}],returnNumberType:a.NumberType.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:o.ArgumentTypes.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:o.ArgumentTypes.NUMBER,greaterThan:-1},{argumentType:o.ArgumentTypes.RANGE},{argumentType:o.ArgumentTypes.RANGE}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.FormulaTextPlugin=void 0;var s=r(1),n=r(18),a=r(100),o=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends a.FunctionPlugin{formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),()=>new s.CellError(s.ErrorType.NA,n.ErrorMessage.WrongArgNumber),e=>{var t;return null!==(t=this.serialization.getCellFormula(e))&&void 0!==t?t:new s.CellError(s.ErrorType.NA,n.ErrorMessage.Formula)})}}t.FormulaTextPlugin=i,i.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:o.ArgumentTypes.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.InformationPlugin=void 0;var s=r(1),n=r(40),a=r(18),o=r(6),i=r(32),u=r(25),l=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class h extends l.FunctionPlugin{isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),e=>/^[01]{1,10}$/.test(e))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),e=>e instanceof s.CellError&&e.type!==s.ErrorType.NA)}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),e=>e instanceof s.CellError)}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),()=>new s.CellError(s.ErrorType.NA,a.ErrorMessage.WrongArgNumber),e=>this.dependencyGraph.addressMapping.getCell(e)instanceof n.FormulaVertex)}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),e=>e===i.EmptyValue)}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),e=>e instanceof s.CellError&&e.type==s.ErrorType.NA)}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),i.isExtendedNumber)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),e=>"boolean"==typeof e)}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),e=>e instanceof s.CellError&&(e.type==s.ErrorType.REF||e.type==s.ErrorType.CYCLE))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),e=>"string"==typeof e)}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),e=>!("string"==typeof e))}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),()=>t.formulaAddress.col+1,e=>e.col+1)}columns(e,t){if(1!==e.args.length)return new s.CellError(s.ErrorType.NA,a.ErrorMessage.WrongArgNumber);if(e.args.some(e=>e.type===o.AstNodeType.EMPTY))return new s.CellError(s.ErrorType.NUM,a.ErrorMessage.EmptyArg);let r=e.args[0];for(;r.type===o.AstNodeType.PARENTHESIS;)r=r.expression;if(r.type===o.AstNodeType.CELL_RANGE||r.type===o.AstNodeType.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===o.AstNodeType.CELL_REFERENCE)return 1;if(r.type===o.AstNodeType.ROW_RANGE)return this.config.maxColumns;{const e=this.evaluateAst(r,t);return e instanceof u.SimpleRangeValue?e.width():e instanceof s.CellError?e:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),()=>t.formulaAddress.row+1,e=>e.row+1)}rows(e,t){if(1!==e.args.length)return new s.CellError(s.ErrorType.NA,a.ErrorMessage.WrongArgNumber);if(e.args.some(e=>e.type===o.AstNodeType.EMPTY))return new s.CellError(s.ErrorType.NUM,a.ErrorMessage.EmptyArg);let r=e.args[0];for(;r.type===o.AstNodeType.PARENTHESIS;)r=r.expression;if(r.type===o.AstNodeType.CELL_RANGE||r.type===o.AstNodeType.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===o.AstNodeType.CELL_REFERENCE)return 1;if(r.type===o.AstNodeType.COLUMN_RANGE)return this.config.maxRows;{const e=this.evaluateAst(r,t);return e instanceof u.SimpleRangeValue?e.height():e instanceof s.CellError?e:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(e,t,r)=>{var n,o,i,u,l,h;return r<1||t<1?new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.LessThanOne):r>e.width()||t>e.height()?new s.CellError(s.ErrorType.NUM,a.ErrorMessage.ValueLarge):null!==(h=null!==(i=null===(o=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n[t-1])||void 0===o?void 0:o[r-1])&&void 0!==i?i:null===(l=null===(u=null==e?void 0:e.data)||void 0===u?void 0:u[0])||void 0===l?void 0:l[0])&&void 0!==h?h:new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.CellRangeExpected)})}na(e,t){return new s.CellError(s.ErrorType.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),()=>t.formulaAddress.sheet+1,e=>e.sheet+1,e=>{const t=this.dependencyGraph.sheetMapping.get(e);return void 0!==t?t+1:new s.CellError(s.ErrorType.NA,a.ErrorMessage.SheetRef)})}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new s.CellError(s.ErrorType.VALUE,a.ErrorMessage.CellRefExpected))}}t.InformationPlugin=h,h.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:l.ArgumentTypes.NOERROR,optional:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:l.ArgumentTypes.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:l.ArgumentTypes.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:l.ArgumentTypes.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:l.ArgumentTypes.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:l.ArgumentTypes.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:l.ArgumentTypes.RANGE},{argumentType:l.ArgumentTypes.NUMBER},{argumentType:l.ArgumentTypes.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:l.ArgumentTypes.NOERROR,optional:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:l.ArgumentTypes.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:l.ArgumentTypes.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:l.ArgumentTypes.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.IsEvenPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),e=>e%2==0)}}t.IsEvenPlugin=n,n.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.IsOddPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),e=>e%2==1)}}t.IsOddPlugin=n,n.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.LogarithmPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(e,t)=>Math.log(e)/Math.log(t))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}t.LogarithmPlugin=n,n.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:s.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:s.ArgumentTypes.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.PI=t.MathConstantsPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */const n=parseFloat(Math.PI.toFixed(14));t.PI=n;class a extends s.FunctionPlugin{pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),()=>n)}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),e=>Math.sqrt(n*e))}}t.MathConstantsPlugin=a,a.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:s.ArgumentTypes.NUMBER,minValue:0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.MatrixPlugin=void 0;var s=r(26),n=r(1),a=r(18),o=r(6),i=r(27),u=r(25),l=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function h(e,t){return new s.ArraySize(t.width,e.height)}function d(e,t,r){return new s.ArraySize(1+(e.width-t)/r,1+(e.height-t)/r)}class p extends l.FunctionPlugin{mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),(e,t)=>{if(!e.hasOnlyNumbers()||!t.hasOnlyNumbers())return new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.NumberRange);if(t.height()!==e.width())return new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.ArrayDimensions);const r=h(e.size,t.size),s=this.createKernel((function(e,t,r){let s=0;for(let n=0;n<r;++n)s+=e[this.thread.y][n]*t[n][this.thread.x];return s}),r)(e.rawNumbers(),t.rawNumbers(),e.width());return u.SimpleRangeValue.onlyNumbers(s)})}mmultArraySize(e,t){if(2!==e.args.length)return s.ArraySize.error();const r=this.metadata("MMULT"),n=e.args.map(e=>{var s;return this.arraySizeForAst(e,new i.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))}),[a,o]=n;return h(a,o)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(e,t,r=t)=>{if(!e.hasOnlyNumbers())return new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.NumberRange);const s=d(e.size,t,r),o=this.createKernel((function(e,t,r){const s=this.thread.x*r,n=this.thread.y*r;let a=e[n][s];for(let r=0;r<t;r++)for(let o=0;o<t;o++)a=Math.max(a,e[n+r][s+o]);return a}),s)(e.rawNumbers(),t,r);return u.SimpleRangeValue.onlyNumbers(o)})}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(e,t,r=t)=>{if(!e.hasOnlyNumbers())return new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.NumberRange);const s=d(e.size,t,r),o=this.createKernel((function(e,t,r){const s=this.thread.x*r,n=this.thread.y*r;let a=e[n][s];for(let r=0;r<t;r++)for(let o=0;o<t;o++)a=Math.max(a,e[n+r][s+o]);let o=e[n][s];for(let r=0;r<t;r++)for(let a=0;a<t;a++)o=Math.min(o,e[n+r][s+a]);const i=t*t;let u=o,l=a,h=42;for(let r=0;r<32;r++){const r=(u+l)/2;let a=0;for(let o=0;o<t;o++)for(let i=0;i<t;i++)e[n+o][s+i]>r&&a++;if(t%2==0){if(a===i/2){h=r;break}a>i/2?u=r:l=r}else{if(a===(i-1)/2){h=r;break}a>(i-1)/2?u=r:l=r}}return h}),s)(e.rawNumbers(),t,r);return u.SimpleRangeValue.onlyNumbers(o)})}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return s.ArraySize.error();const r=this.metadata("MAXPOOL"),n=e.args.map(e=>{var s;return this.arraySizeForAst(e,new i.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))})[0],a=e.args[1];let u;u=a.type===o.AstNodeType.NUMBER?a.value:1;let l=u;if(3===e.args.length){const t=e.args[2];l=t.type===o.AstNodeType.NUMBER?t.value:1}return u>n.width||u>n.height||l>u||(n.width-u)%l!=0||(n.height-u)%l!=0?s.ArraySize.error():d(n,u,l)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),e=>{const t=e.rawData(),r=e.size,s=[];for(let e=0;e<r.width;++e){s[e]=[];for(let n=0;n<r.height;++n)s[e][n]=t[n][e]}return u.SimpleRangeValue.onlyValues(s)})}transposeArraySize(e,t){if(1!==e.args.length)return s.ArraySize.error();const r=this.metadata("MMULT"),n=e.args.map(e=>{var s;return this.arraySizeForAst(e,new i.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(s=null==r?void 0:r.arrayFunction)&&void 0!==s&&s))}),[a]=n;return new s.ArraySize(a.height,a.width)}createKernel(e,t){return function(...r){const s=[];for(let n=0;n<t.height;++n){s.push([]);for(let a=0;a<t.width;++a)s[n][a]=e.apply({thread:{x:a,y:n}},r)}return s}}}t.MatrixPlugin=p,p.implementedFunctions={MMULT:{method:"mmult",arraySizeMethod:"mmultArraySize",parameters:[{argumentType:l.ArgumentTypes.RANGE},{argumentType:l.ArgumentTypes.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",arraySizeMethod:"transposeArraySize",parameters:[{argumentType:l.ArgumentTypes.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",arraySizeMethod:"maxpoolArraySize",parameters:[{argumentType:l.ArgumentTypes.RANGE},{argumentType:l.ArgumentTypes.NUMBER},{argumentType:l.ArgumentTypes.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",arraySizeMethod:"medianpoolArraySize",parameters:[{argumentType:l.ArgumentTypes.RANGE},{argumentType:l.ArgumentTypes.NUMBER},{argumentType:l.ArgumentTypes.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.MedianPlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);return t instanceof s.CellError?t:0===t.length?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.OneValue):(t.sort((e,t)=>e-t),t.length%2==0?(t[t.length/2-1]+t[t.length/2])/2:t[Math.floor(t.length/2)])})}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),(e,t)=>{const r=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());return r instanceof s.CellError?r:(r.sort((e,t)=>e-t),(t=Math.trunc(t))>r.length?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):r[r.length-t])})}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),(e,t)=>{const r=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());return r instanceof s.CellError?r:(r.sort((e,t)=>e-t),(t=Math.trunc(t))>r.length?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):r[t-1])})}}t.MedianPlugin=o,o.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:a.ArgumentTypes.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:a.ArgumentTypes.RANGE},{argumentType:a.ArgumentTypes.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:a.ArgumentTypes.RANGE},{argumentType:a.ArgumentTypes.NUMBER,minValue:1}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ModuloPlugin=void 0;var s=r(1),n=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class a extends n.FunctionPlugin{mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(e,t)=>0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):e%t)}}t.ModuloPlugin=a,a.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:n.ArgumentTypes.NUMBER},{argumentType:n.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.NumericAggregationPlugin=void 0;var s=r(4),n=r(1),a=r(18),o=r(5),i=r(6),u=r(29),l=r(32),h=r(25),d=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function p(e){return(0,l.isExtendedNumber)(e)&&!Number.isFinite((0,l.getRawValue)(e))?0:e}class c{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new c(e*e,e,1)}compose(e){return new c(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){return this.count>0?this.sum/this.count:void 0}varSValue(){return this.count>1?(this.sumsq-this.sum*this.sum/this.count)/(this.count-1):void 0}varPValue(){return this.count>0?(this.sumsq-this.sum*this.sum/this.count)/this.count:void 0}}c.empty=new c(0,0,0);class m extends d.FunctionPlugin{constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,e=>Math.pow((0,l.getRawValue)(e),2),g)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){return p(this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(e,t)=>Math.max(e,t),l.getRawValue,E))}min(e,t){return this.doMin(e.args,t)}mina(e,t){return p(this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(e,t)=>Math.min(e,t),l.getRawValue,E))}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const s=this.reduce(e.args,t,c.empty,"_AGGREGATE_A",(e,t)=>e.compose(t),e=>c.single((0,l.getRawValue)(e)),E);return s instanceof n.CellError?s:null!==(r=s.averageValue())&&void 0!==r?r:new n.CellError(n.ErrorType.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const s=this.reduceAggregateA(e.args,t);return s instanceof n.CellError?s:null!==(r=s.varSValue())&&void 0!==r?r:new n.CellError(n.ErrorType.DIV_BY_ZERO)}varpa(e,t){var r;const s=this.reduceAggregateA(e.args,t);return s instanceof n.CellError?s:null!==(r=s.varPValue())&&void 0!==r?r:new n.CellError(n.ErrorType.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof n.CellError)return r;{const e=r.varSValue();return void 0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof n.CellError)return r;{const e=r.varPValue();return void 0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new n.CellError(n.ErrorType.NA,a.ErrorMessage.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:d.ArgumentTypes.NUMBER},t),s=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(s,t);case 2:case 102:return this.doCount(s,t);case 3:case 103:return this.doCounta(s,t);case 4:case 104:return this.doMax(s,t);case 5:case 105:return this.doMin(s,t);case 6:case 106:return this.doProduct(s,t);case 7:case 107:return this.doStdevS(s,t);case 8:case 108:return this.doStdevP(s,t);case 9:case 109:return this.doSum(s,t);case 10:case 110:return this.doVarS(s,t);case 11:case 111:return this.doVarP(s,t);default:return new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,c.empty,"_AGGREGATE",(e,t)=>e.compose(t),e=>c.single((0,l.getRawValue)(e)),g)}reduceAggregateA(e,t){return this.reduce(e,t,c.empty,"_AGGREGATE_A",(e,t)=>e.compose(t),e=>c.single((0,l.getRawValue)(e)),E)}doAverage(e,t){var r;const s=this.reduceAggregate(e,t);return s instanceof n.CellError?s:null!==(r=s.averageValue())&&void 0!==r?r:new n.CellError(n.ErrorType.DIV_BY_ZERO)}doVarS(e,t){var r;const s=this.reduceAggregate(e,t);return s instanceof n.CellError?s:null!==(r=s.varSValue())&&void 0!==r?r:new n.CellError(n.ErrorType.DIV_BY_ZERO)}doVarP(e,t){var r;const s=this.reduceAggregate(e,t);return s instanceof n.CellError?s:null!==(r=s.varPValue())&&void 0!==r?r:new n.CellError(n.ErrorType.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof n.CellError)return r;{const e=r.varSValue();return void 0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof n.CellError)return r;{const e=r.varPValue();return void 0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",(e,t)=>e+t,l.getRawValue,e=>(0,l.isExtendedNumber)(e)?1:0)}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",(e,t)=>e+t,l.getRawValue,e=>e===l.EmptyValue?0:1)}doMax(e,t){return p(this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(e,t)=>Math.max(e,t),l.getRawValue,g))}doMin(e,t){return p(this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(e,t)=>Math.min(e,t),l.getRawValue,g))}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,l.getRawValue,g)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",(e,t)=>e*t,l.getRawValue,g)}reduce(e,t,r,s,o,u,l){return e.length<1?new n.CellError(n.ErrorType.NA,a.ErrorMessage.WrongArgNumber):e.reduce((e,a)=>{if(e instanceof n.CellError)return e;if(a.type===i.AstNodeType.CELL_RANGE||a.type===i.AstNodeType.COLUMN_RANGE||a.type===i.AstNodeType.ROW_RANGE){const i=this.evaluateRange(a,t,r,s,o,u,l);return i instanceof n.CellError?i:o(i,e)}let d;if(d=this.evaluateAst(a,t),d instanceof h.SimpleRangeValue){return Array.from(d.valuesFromTopLeftCorner()).map(l).filter(e=>void 0!==e).map(e=>e instanceof n.CellError?e:u(e)).reduce((e,t)=>e instanceof n.CellError?e:t instanceof n.CellError?t:o(e,t),e)}if(a.type===i.AstNodeType.CELL_REFERENCE){if(d=l(d),void 0===d)return e}else if(d=this.coerceScalarToNumberOrError(d),d=l(d),void 0===d)return e;return d instanceof n.CellError?d:o(e,u(d))},r)}evaluateRange(e,t,r,i,u,l,h){let d;try{d=s.AbsoluteCellRange.fromAst(e,t.formulaAddress)}catch(e){if(e instanceof o.SheetsNotEqual)return new n.CellError(n.ErrorType.REF,a.ErrorMessage.RangeManySheets);throw e}const p=d.start,c=d.end,m=this.dependencyGraph.getRange(p,c);if(void 0===m)throw new Error("Range does not exists in graph");let g=m.getFunctionValue(i);if(void 0===g){g=this.getRangeValues(i,d,l,h).reduce((e,t)=>e instanceof n.CellError?e:t instanceof n.CellError?t:u(e,t),r),m.setFunctionValue(i,g)}return g}getRangeValues(e,t,r,s){const a=[],{smallerRangeVertex:o,restRange:i}=this.dependencyGraph.rangeMapping.findSmallerRange(t),u=this.dependencyGraph.getRange(t.start,t.end);let l;if(void 0!==o&&this.dependencyGraph.existsEdge(o,u)){const t=o.getFunctionValue(e);if(void 0!==t)a.push(t);else for(const e of o.range.addresses(this.dependencyGraph)){const t=s(this.dependencyGraph.getScalarValue(e));t instanceof n.CellError?a.push(t):void 0!==t&&a.push(r(t))}l=i}else l=t;for(const e of l.addresses(this.dependencyGraph)){const t=s(this.dependencyGraph.getScalarValue(e));t instanceof n.CellError?a.push(t):void 0!==t&&a.push(r(t))}return a}}function g(e){return(0,l.isExtendedNumber)(e)||e instanceof n.CellError?e:void 0}function E(e){return"boolean"==typeof e?(0,u.coerceBooleanToNumber)(e):(0,l.isExtendedNumber)(e)||e instanceof n.CellError?e:"string"==typeof e?0:void 0}t.NumericAggregationPlugin=m,m.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:d.ArgumentTypes.NUMBER},{argumentType:d.ArgumentTypes.ANY}],repeatLastArgs:1}},m.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"}},function(e,t,r){"use strict";t.__esModule=!0,t.PowerPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}t.PowerPlugin=n,n.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:s.ArgumentTypes.NUMBER},{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RadiansPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),e=>e*(Math.PI/180))}}t.RadiansPlugin=n,n.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RadixConversionPlugin=void 0;var s=r(1),n=r(18),a=r(59),o=r(28);class i extends o.FunctionPlugin{dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(e,t)=>l(e,2,t))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(e,t)=>l(e,8,t))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(e,t)=>l(e,16,t))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),e=>{const t=u(e,2,10);return void 0===t?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotBinary):c(t,2)})}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(e,t)=>{const r=u(e,2,10);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotBinary):l(c(r,2),8,t)})}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(e,t)=>{const r=u(e,2,10);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotBinary):l(c(r,2),16,t)})}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),e=>{const t=u(e,8,10);return void 0===t?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotOctal):c(t,8)})}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(e,t)=>{const r=u(e,8,10);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotOctal):l(c(r,8),2,t)})}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(e,t)=>{const r=u(e,8,10);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotOctal):l(c(r,8),16,t)})}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),e=>{const t=u(e,16,10);return void 0===t?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotHex):c(t,16)})}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(e,t)=>{const r=u(e,16,10);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotHex):l(c(r,16),2,t)})}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(e,t)=>{const r=u(e,16,10);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotHex):l(c(r,16),8,t)})}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),d)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(e,t)=>{const r=u(e,t,255);return void 0===r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NotHex):parseInt(r,t)})}}function u(e,t,r){const s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".substr(0,t),n=new RegExp(`^[${s}]+$`);if(!(e.length>r)&&n.test(e))return e}function l(e,t,r){if(e>function(e){return-h(e)-1}(t))return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueBaseLarge);if(e<h(t))return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueBaseSmall);const o=p(e,t);return void 0===r||e<0?o:o.length>r?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueBaseLong):(0,a.padLeft)(o,r)}function h(e){return-Math.pow(e,10)/2}function d(e,t,r){const s=p(e,t);return void 0!==r&&r>s.length?(0,a.padLeft)(s,r):s}function p(e,t){return(e+(e<0?Math.pow(t,10):0)).toString(t).toUpperCase()}function c(e,t){const r=parseInt(e,t),s=Math.pow(t,10);return r>=s/2?r-s:r}t.RadixConversionPlugin=i,i.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:o.ArgumentTypes.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:10}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:10}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:o.ArgumentTypes.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:10}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:10}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:o.ArgumentTypes.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:10}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:10}]},DECIMAL:{method:"decimal",parameters:[{argumentType:o.ArgumentTypes.STRING},{argumentType:o.ArgumentTypes.NUMBER,minValue:2,maxValue:36}]},BASE:{method:"base",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:0},{argumentType:o.ArgumentTypes.NUMBER,minValue:2,maxValue:36},{argumentType:o.ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:255}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RandomPlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(e,t)=>t<e?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.WrongOrder):((e=Math.ceil(e))===(t=Math.floor(t)+1)&&(t+=1),e+Math.floor(Math.random()*(t-e))))}}t.RandomPlugin=o,o.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}],isVolatile:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.RoundingPlugin=void 0,t.findNextEvenNumber=i,t.findNextOddNumber=o;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function o(e){const t=Math.ceil(e);return t%2==1?t:t+1}function i(e){const t=Math.ceil(e);return t%2==0?t:t+1}class u extends a.FunctionPlugin{roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(e,t)=>{const r=Math.pow(10,t);return e<0?-Math.ceil(-e*r)/r:Math.ceil(e*r)/r})}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(e,t)=>{const r=Math.pow(10,t);return e<0?-Math.floor(-e*r)/r:Math.floor(e*r)/r})}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(e,t)=>{const r=Math.pow(10,t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r})}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),e=>e<0?-Math.floor(-e):Math.floor(e))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),e=>e<0?-i(-e):i(e))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),e=>e<0?-o(-e):o(e))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(e,t,r)=>0===t||0===e?0:(t=Math.abs(t),1===r&&e<0&&(t=-t),Math.ceil(e/t)*t))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(e,t)=>0===e?0:0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):e>0&&t<0?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.DistinctSigns):Math.ceil(e/t)*t)}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(e,t)=>0===t||0===e?0:(t=Math.abs(t),Math.ceil(e/t)*t))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(e,t,r)=>0===t||0===e?0:(t=Math.abs(t),1===r&&e<0&&(t*=-1),Math.floor(e/t)*t))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(e,t)=>0===e?0:0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):e>0&&t<0?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.DistinctSigns):Math.floor(e/t)*t)}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(e,t)=>0===t||0===e?0:(t=Math.abs(t),Math.floor(e/t)*t))}}t.RoundingPlugin=u,u.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1}]}},u.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"}},function(e,t,r){"use strict";t.__esModule=!0,t.SqrtPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}t.SqrtPlugin=n,n.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:s.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.SumifPlugin=void 0;var s=r(1),n=r(18),a=r(133),o=r(32),i=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class u{constructor(e,t){this.sum=e,this.count=t}static single(e){return new u(e,1)}compose(e){return new u(this.sum+e.sum,this.count+e.count)}averageValue(){return this.count>0?this.sum/this.count:void 0}}function l(e){return["SUMIF",...e.map(e=>`${e.conditionRange.range.sheet},${e.conditionRange.range.start.col},${e.conditionRange.range.start.row}`)].join(",")}function h(e){return["AVERAGEIF",...e.map(e=>`${e.conditionRange.range.sheet},${e.conditionRange.range.start.col},${e.conditionRange.range.start.row}`)].join(",")}function d(e){return["COUNTIFS",...e.map(e=>`${e.conditionRange.range.sheet},${e.conditionRange.range.start.col},${e.conditionRange.range.start.row}`)].join(",")}u.empty=new u(0,0);class p extends i.FunctionPlugin{sumif(e,t){return this.runFunction(e.args,t,this.metadata("SUMIF"),(e,t,r)=>{const i=this.interpreter.criterionBuilder.fromCellValue(t,this.arithmeticHelper);return void 0===i?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.BadCriterion):(r=null!=r?r:e,new a.CriterionFunctionCompute(this.interpreter,l,0,(e,t)=>this.arithmeticHelper.nonstrictadd(e,t),e=>(0,o.getRawValue)(e)).compute(r,[new a.Condition(e,i)]))})}sumifs(e,t){return this.runFunction(e.args,t,this.metadata("SUMIFS"),(e,...t)=>{const r=[];for(let e=0;e<t.length;e+=2){const o=t[e],i=this.interpreter.criterionBuilder.fromCellValue(t[e+1],this.arithmeticHelper);if(void 0===i)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.BadCriterion);r.push(new a.Condition(o,i))}return new a.CriterionFunctionCompute(this.interpreter,l,0,(e,t)=>this.arithmeticHelper.nonstrictadd(e,t),e=>(0,o.getRawValue)(e)).compute(e,r)})}averageif(e,t){return this.runFunction(e.args,t,this.metadata("AVERAGEIF"),(e,t,r)=>{const i=this.interpreter.criterionBuilder.fromCellValue(t,this.arithmeticHelper);if(void 0===i)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.BadCriterion);r=null!=r?r:e;const l=new a.CriterionFunctionCompute(this.interpreter,h,u.empty,(e,t)=>e.compose(t),e=>(0,o.isExtendedNumber)(e)?u.single((0,o.getRawValue)(e)):u.empty).compute(r,[new a.Condition(e,i)]);return l instanceof s.CellError?l:l.averageValue()||new s.CellError(s.ErrorType.DIV_BY_ZERO)})}countif(e,t){return this.runFunction(e.args,t,this.metadata("COUNTIF"),(e,t)=>{const r=this.interpreter.criterionBuilder.fromCellValue(t,this.arithmeticHelper);return void 0===r?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.BadCriterion):new a.CriterionFunctionCompute(this.interpreter,()=>"COUNTIF",0,(e,t)=>e+t,()=>1).compute(e,[new a.Condition(e,r)])})}countifs(e,t){return this.runFunction(e.args,t,this.metadata("COUNTIFS"),(...e)=>{const t=[];for(let r=0;r<e.length;r+=2){const o=e[r],i=this.interpreter.criterionBuilder.fromCellValue(e[r+1],this.arithmeticHelper);if(void 0===i)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.BadCriterion);t.push(new a.Condition(o,i))}return new a.CriterionFunctionCompute(this.interpreter,d,0,(e,t)=>e+t,()=>1).compute(t[0].conditionRange,t)})}}t.SumifPlugin=p,p.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.NOERROR},{argumentType:i.ArgumentTypes.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.NOERROR},{argumentType:i.ArgumentTypes.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.NOERROR}],repeatLastArgs:2}}},function(e,t,r){"use strict";t.__esModule=!0,t.CriterionFunctionCompute=t.Condition=void 0;var s=r(1),n=r(18),a=r(134),o=r(32);t.CriterionFunctionCompute=class{constructor(e,t,r,s,n){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=s,this.mapFunction=n,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const r of t)if(!r.conditionRange.sameDimensionsAs(e))return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),a=t.map(e=>this.tryToGetRangeVertexForRangeValue(e.conditionRange));if(r&&a.every(e=>void 0!==e)){const s=t.map(e=>e.criterionPackage.raw).join(","),n=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),s);if(void 0!==n)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),n;const o=this.buildNewCriterionCache(this.cacheKey(t),t.map(e=>e.conditionRange.range),e.range);return o.has(s)||o.set(s,[this.evaluateRangeValue(e,t),t.map(e=>e.criterionPackage.lambda)]),r.setCriterionFunctionValues(this.cacheKey(t),o),a.forEach(e=>{void 0!==e&&e.addDependentCacheRange(r)}),o.get(s)[0]}return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;return void 0===t?void 0:this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map(e=>e.criterionPackage.lambda),s=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),n=u(r,t.map(e=>e.conditionRange.iterateValuesFromTopLeftCorner()),s);return this.reduceFunction(n)}buildNewCriterionCache(e,t,r){const n=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:a,restConditionRanges:o,restValuesRange:l}=((e,t,r)=>{if(r.end.row>r.start.row){const n=(0,s.simpleCellAddress)(r.end.sheet,r.end.col,r.end.row-1),a=e.getRange(r.start,n);if(void 0!==a)return{smallerRangeVertex:a,restValuesRange:r.withStart((0,s.simpleCellAddress)(r.start.sheet,r.start.col,r.end.row)),restConditionRanges:t.map(e=>e.withStart((0,s.simpleCellAddress)(e.start.sheet,e.start.col,e.end.row)))}}return{restValuesRange:r,restConditionRanges:t}})(this.dependencyGraph,t,r);let h;h=void 0!==a&&this.dependencyGraph.existsEdge(a,n)?a.getCriterionFunctionValues(e):new Map;const d=new Map;return h.forEach(([e,t],r)=>{const s=u(t,o.map(e=>i(this.dependencyGraph,e)),Array.from(i(this.dependencyGraph,l)).map(this.mapFunction)[Symbol.iterator]()),n=this.composeFunction(e,this.reduceFunction(s));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),d.set(r,[n,t])}),d}};function*i(e,t){for(const r of t.addresses(e))yield(0,o.getRawValue)(e.getScalarValue(r))}function*u(e,t,r){for(const s of r){const r=t.map(e=>(0,a.split)(e));if(!r.every(e=>Object.prototype.hasOwnProperty.call(e,"value")))return;l(r.map(e=>e.value),e).every(([e,t])=>t(e))&&(yield s),t=r.map(e=>e.rest)}}function l(e,t){const r=[];for(let s=0;s<Math.min(e.length,t.length);s++)r.push([e[s],t[s]]);return r}t.Condition=class{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}},function(e,t,r){"use strict";
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
function*s(){}t.__esModule=!0,t.empty=s,t.first=function(e){const t=e[Symbol.iterator](),{done:r,value:s}=t.next();if(!r)return s;return},t.split=function(e){const t=e[Symbol.iterator](),{done:r,value:n}=t.next();return r?{rest:s()}:{value:n,rest:t}}},function(e,t,r){"use strict";t.__esModule=!0,t.SumprodPlugin=void 0;var s=r(1),n=r(18),a=r(32),o=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.FunctionPlugin{sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(...e)=>{const t=e[0].width(),r=e[0].height();for(const a of e)if(a.width()!==t||a.height()!==r)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.EqualLength);let o=0;const i=e.map(e=>e.iterateValuesFromTopLeftCorner());for(let e=0;e<t*r;e++){let e=1;for(const t of i){const r=t.next().value;if(r instanceof s.CellError)return r;const n=this.coerceScalarToNumberOrError(r);(0,a.isExtendedNumber)(n)?e*=(0,a.getRawValue)(n):e=0}o+=e}return o})}}t.SumprodPlugin=i,i.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:o.ArgumentTypes.RANGE}],repeatLastArgs:1}}},function(e,t,r){"use strict";t.__esModule=!0,t.TextPlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(...e)=>"".concat(...e))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(e,t)=>{const r=e.split(" ");return t>=r.length||t<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.IndexBounds):r[t]})}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),e=>e.length)}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),e=>e.toLowerCase())}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),e=>e.replace(/^ +| +$/g,"").replace(/ +/g," "))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),e=>e.replace(/\p{L}+/gu,e=>e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),e=>e.replace(/[\u0000-\u001F]/g,""))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(e,t)=>e===t)}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(e,t)=>t<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NegativeCount):e.repeat(t))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(e,t)=>t<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NegativeLength):0===t?"":e.slice(-t))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(e,t)=>t<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NegativeLength):e.slice(0,t))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(e,t,r)=>t<1?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.LessThanOne):r<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NegativeLength):e.substring(t-1,t+r-1))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(e,t,r,a)=>t<1?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.LessThanOne):r<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.NegativeLength):e.substring(0,t-1)+a+e.substring(t+r-1))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),(e,t,r)=>{if(r<1||r>t.length)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.LengthBounds);const a=t.substring(r-1).toLowerCase();let o;return o=this.arithmeticHelper.requiresRegex(e)?this.arithmeticHelper.searchString(e,a):a.indexOf(e.toLowerCase()),o+=r,o>0?o:new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.PatternNotFound)})}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(e,t,r,a)=>{const o=new RegExp(t,"g");if(void 0===a)return e.replace(o,r);if(a<1)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.LessThanOne);let i,u=0;for(;null!==(i=o.exec(e));)if(a===++u)return e.substring(0,i.index)+r+e.substring(o.lastIndex);return e})}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(e,t,r)=>{if(r<1||r>t.length)return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.IndexBounds);const a=t.substring(r-1).indexOf(e)+r;return a>0?a:new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.PatternNotFound)})}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),e=>e instanceof s.CellError||"string"==typeof e?e:"")}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),e=>e.toUpperCase())}}t.TextPlugin=o,o.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:a.ArgumentTypes.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:a.ArgumentTypes.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:a.ArgumentTypes.STRING}]},MID:{method:"mid",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:a.ArgumentTypes.STRING}]},T:{method:"t",parameters:[{argumentType:a.ArgumentTypes.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:a.ArgumentTypes.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:a.ArgumentTypes.STRING}]},REPT:{method:"rept",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.STRING},{argumentType:a.ArgumentTypes.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:a.ArgumentTypes.STRING}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.TrigonometryPlugin=void 0;var s=r(1),n=r(18),a=r(28),o=r(121);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends a.FunctionPlugin{acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(e,t)=>0===e&&0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.atan2(t,e))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),e=>0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):1/Math.tan(e))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),e=>0===e?o.PI/2:Math.atan(1/e))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),e=>1/Math.cos(e))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),e=>0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):1/Math.sin(e))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),e=>0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):1/Math.tanh(e))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),e=>0===e?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NonZero):Math.atanh(1/e))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),e=>1/Math.cosh(e))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),e=>0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):1/Math.sinh(e))}}t.TrigonometryPlugin=i,i.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.LookupPlugin=void 0;var s=r(4),n=r(1),a=r(18),o=r(139),i=r(33),u=r(29),l=r(25),h=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class d extends h.FunctionPlugin{constructor(){super(...arguments),this.rowSearch=new o.RowSearchStrategy(this.config,this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(e,t,r,s)=>{const o=t.range;return void 0===o?new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.WrongType):r<1?new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.LessThanOne):r>o.width()?new n.CellError(n.ErrorType.REF,a.ErrorMessage.IndexLarge):this.doVlookup((0,u.zeroIfEmpty)(e),t,r-1,s)})}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(e,t,r,s)=>{const o=t.range;return void 0===o?new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.WrongType):r<1?new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.LessThanOne):r>o.height()?new n.CellError(n.ErrorType.REF,a.ErrorMessage.IndexLarge):this.doHlookup((0,u.zeroIfEmpty)(e),t,r-1,s)})}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),(e,t,r)=>this.doMatch((0,u.zeroIfEmpty)(e),t,r))}searchInRange(e,t,r,s){return!r&&"string"==typeof e&&this.arithmeticHelper.requiresRegex(e)?s.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t):s.find(e,t,r)}doVlookup(e,t,r,o){this.dependencyGraph.stats.start(i.StatType.VLOOKUP);const u=t.range;let h;h=void 0===u?l.SimpleRangeValue.onlyValues(t.data.map(e=>[e[0]])):l.SimpleRangeValue.onlyRange(s.AbsoluteCellRange.spanFrom(u.start,1,u.height()),this.dependencyGraph);const d=this.searchInRange(e,h,o,this.columnSearch);if(this.dependencyGraph.stats.end(i.StatType.VLOOKUP),-1===d)return new n.CellError(n.ErrorType.NA,a.ErrorMessage.ValueNotFound);let p;if(void 0===u)p=t.data[d][r];else{const e=(0,n.simpleCellAddress)(u.sheet,u.start.col+r,u.start.row+d);p=this.dependencyGraph.getCellValue(e)}return p instanceof l.SimpleRangeValue?new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.WrongType):p}doHlookup(e,t,r,o){const i=t.range;let u;u=void 0===i?l.SimpleRangeValue.onlyValues([t.data[0]]):l.SimpleRangeValue.onlyRange(s.AbsoluteCellRange.spanFrom(i.start,i.width(),1),this.dependencyGraph);const h=this.searchInRange(e,u,o,this.rowSearch);if(-1===h)return new n.CellError(n.ErrorType.NA,a.ErrorMessage.ValueNotFound);let d;if(void 0===i)d=t.data[r][h];else{const e=(0,n.simpleCellAddress)(i.sheet,i.start.col+h,i.start.row+r);d=this.dependencyGraph.getCellValue(e)}return d instanceof l.SimpleRangeValue?new n.CellError(n.ErrorType.VALUE,a.ErrorMessage.WrongType):d}doMatch(e,t,r){if(t.width()>1&&t.height()>1)return new n.CellError(n.ErrorType.NA);if(1===t.width()){const s=this.columnSearch.find(e,t,0!==r);return-1===s?new n.CellError(n.ErrorType.NA,a.ErrorMessage.ValueNotFound):s+1}{const s=this.rowSearch.find(e,t,0!==r);return-1===s?new n.CellError(n.ErrorType.NA,a.ErrorMessage.ValueNotFound):s+1}}}t.LookupPlugin=d,d.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:h.ArgumentTypes.NOERROR},{argumentType:h.ArgumentTypes.RANGE},{argumentType:h.ArgumentTypes.NUMBER},{argumentType:h.ArgumentTypes.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:h.ArgumentTypes.NOERROR},{argumentType:h.ArgumentTypes.RANGE},{argumentType:h.ArgumentTypes.NUMBER},{argumentType:h.ArgumentTypes.BOOLEAN,defaultValue:!0}]},MATCH:{method:"match",parameters:[{argumentType:h.ArgumentTypes.NOERROR},{argumentType:h.ArgumentTypes.RANGE},{argumentType:h.ArgumentTypes.NUMBER,defaultValue:1}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RowSearchStrategy=void 0;var s=r(29),n=r(91),a=r(32),o=r(92);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.AdvancedFind{constructor(e,t){super(t),this.config=e,this.dependencyGraph=t}find(e,t,r){"string"==typeof e&&(e=(0,s.forceNormalizeString)(e));const o=t.range;return void 0===o?t.valuesFromTopLeftCorner().map(a.getRawValue).indexOf(e):r?(0,n.rangeLowerBound)(o,e,this.dependencyGraph,"col"):this.dependencyGraph.computeListOfValuesInRange(o).findIndex(t=>(t="string"==typeof(t=(0,a.getRawValue)(t))?(0,s.forceNormalizeString)(t):t)===e)}}t.RowSearchStrategy=i},function(e,t,r){"use strict";t.__esModule=!0,t.RomanPlugin=void 0;var s=r(1),n=r(18),a=r(32),o=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.FunctionPlugin{roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),(e,t)=>(e=Math.trunc(e),!1===t?t=4:!0===t&&(t=0),(t=(0,a.getRawValue)(this.coerceScalarToNumberOrError(t)))instanceof s.CellError?t:(t=Math.trunc(t))<0?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.ValueSmall):t>4?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.ValueLarge):function(e,t){const r={val:e%1e3,acc:"M".repeat(Math.floor(e/1e3))};4===t&&(l(r,"IM",999,1e3),l(r,"ID",499,500));t>=3&&(l(r,"VM",995,1e3),l(r,"VD",495,500));t>=2&&(l(r,"XM",990,1e3),l(r,"XD",490,500));t>=1&&(l(r,"LM",950,1e3),l(r,"LD",450,500));l(r,"CM",900,1e3),l(r,"CD",400,500),l(r,"D",500,900),r.acc+="C".repeat(Math.floor(r.val/100)),r.val%=100,t>=2&&(l(r,"IC",99,100),l(r,"IL",49,50));t>=1&&(l(r,"VC",95,100),l(r,"VL",45,50));return l(r,"XC",90,100),l(r,"XL",40,50),l(r,"L",50,90),r.acc+="X".repeat(Math.floor(r.val/10)),r.val%=10,l(r,"IX",9,10),l(r,"IV",4,5),l(r,"V",5,9),r.acc+="I".repeat(r.val),r.acc}(e,t)))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),e=>{let t=!1;if((e=e.trim().toUpperCase()).startsWith("-")&&(t=!0,""===(e=e.slice(1))))return new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.InvalidRoman);const r={input:e,acc:0};return u(r,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),u(r,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),u(r,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),u(r,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),u(r,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),u(r,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),u(r,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),u(r,{token:"IX",val:9}),u(r,{token:"V",val:5},{token:"IV",val:4}),u(r,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),""!==r.input?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.InvalidRoman):t?-r.acc:r.acc})}}function u(e,...t){for(const r of t)if(e.input.startsWith(r.token)){e.input=e.input.slice(r.token.length),e.acc+=r.val;break}}function l(e,t,r,s){e.val>=r&&e.val<s&&(e.val-=r,e.acc+=t)}t.RomanPlugin=i,i.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:o.ArgumentTypes.NUMBER,minValue:1,lessThan:4e3},{argumentType:o.ArgumentTypes.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:o.ArgumentTypes.STRING}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleArithmerticPlugin=void 0;var s=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */class n extends s.FunctionPlugin{add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}t.SimpleArithmerticPlugin=n,n.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:s.ArgumentTypes.STRING,passSubtype:!0},{argumentType:s.ArgumentTypes.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:s.ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:s.ArgumentTypes.NUMBER,passSubtype:!0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.StatisticalPlugin=void 0;var s=r(1),n=r(18),a=r(143),o=r(144),i=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class u extends i.FunctionPlugin{erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(e,t)=>void 0===t?(0,o.erf)(e):(0,o.erf)(t)-(0,o.erf)(e))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),o.erfc)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(e,t,r)=>r?o.exponential.cdf(e,t):o.exponential.pdf(e,t))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),e=>Math.log((1+e)/(1-e))/2)}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),e=>1-2/(Math.exp(2*e)+1))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),o.gammafn)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(e,t,r,s)=>s?o.gamma.cdf(e,t,r):o.gamma.pdf(e,t,r))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),o.gammaln)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),o.gamma.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),e=>o.normal.cdf(e,0,1)-.5)}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(e,t,r,a,i,u)=>e<=i?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall):e>=u?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):(e=(e-i)/(u-i),a?o.beta.cdf(e,t,r):o.beta.pdf(e,t,r)))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(e,t,r,a,i)=>a>=i?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.WrongOrder):o.beta.inv(e,t,r)*(i-a)+a)}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(e,t,r,a)=>e>t?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.WrongOrder):(e=Math.trunc(e),t=Math.trunc(t),a?o.binomial.cdf(e,t,r):o.binomial.pdf(e,t,r)))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(e,t,r)=>{let s=-1,n=e=Math.trunc(e);for(;n>s+1;){const a=Math.trunc((s+n)/2);o.binomial.cdf(a,e,t)>=r?n=a:s=a}return n})}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(e,t)=>(0,a.besseli)(e,Math.trunc(t)))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(e,t)=>(0,a.besselj)(e,Math.trunc(t)))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(e,t)=>(0,a.besselk)(e,Math.trunc(t)))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(e,t)=>(0,a.bessely)(e,Math.trunc(t)))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(e,t,r)=>(t=Math.trunc(t),r?o.chisquare.cdf(e,t):o.chisquare.pdf(e,t)))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(e,t)=>1-o.chisquare.cdf(e,Math.trunc(t)))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(e,t)=>o.chisquare.inv(e,Math.trunc(t)))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(e,t)=>o.chisquare.inv(1-e,Math.trunc(t)))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(e,t,r,s)=>(t=Math.trunc(t),r=Math.trunc(r),s?o.centralF.cdf(e,t,r):o.centralF.pdf(e,t,r)))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(e,t,r)=>1-o.centralF.cdf(e,Math.trunc(t),Math.trunc(r)))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(e,t,r)=>o.centralF.inv(e,Math.trunc(t),Math.trunc(r)))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(e,t,r)=>o.centralF.inv(1-e,Math.trunc(t),Math.trunc(r)))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(e,t,r,s)=>s?o.weibull.cdf(e,r,t):o.weibull.pdf(e,r,t))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(e,t,r)=>(e=Math.trunc(e),r?o.poisson.cdf(e,t):o.poisson.pdf(e,t)))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(e,t,r,a,i)=>e>t||e>r||t>a||r>a||e+a<r+t?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):(e=Math.trunc(e),t=Math.trunc(t),r=Math.trunc(r),a=Math.trunc(a),i?o.hypgeom.cdf(e,a,r,t):o.hypgeom.pdf(e,a,r,t)))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(e,t,r)=>(t=Math.trunc(t),r?o.studentt.cdf(e,t):o.studentt.pdf(e,t)))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(e,t)=>2*(1-o.studentt.cdf(e,Math.trunc(t))))}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(e,t)=>1-o.studentt.cdf(e,Math.trunc(t)))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(e,t,r)=>r*(1-o.studentt.cdf(e,Math.trunc(t))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(e,t)=>o.studentt.inv(e,Math.trunc(t)))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(e,t)=>o.studentt.inv(1-e/2,Math.trunc(t)))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(e,t,r,s)=>s?o.lognormal.cdf(e,t,r):o.lognormal.pdf(e,t,r))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(e,t,r)=>o.lognormal.inv(e,t,r))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(e,t,r,s)=>s?o.normal.cdf(e,t,r):o.normal.pdf(e,t,r))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(e,t,r)=>o.normal.inv(e,t,r))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(e,t)=>t?o.normal.cdf(e,0,1):o.normal.pdf(e,0,1))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),e=>o.normal.inv(e,0,1))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),e=>o.normal.pdf(e,0,1))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(e,t,r,s)=>(e=Math.trunc(e),t=Math.trunc(t),s?o.negbin.cdf(e,t,r):o.negbin.pdf(e,t,r)))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(e,t,r)=>(0,o.normalci)(1,e,t,Math.trunc(r))[1]-1)}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(e,t,r)=>1===(r=Math.trunc(r))?new s.CellError(s.ErrorType.DIV_BY_ZERO):(0,o.tci)(1,e,t,r)[1]-1)}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(e,t,r)=>(e-t)/r)}}t.StatisticalPlugin=u,u.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:i.ArgumentTypes.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:i.ArgumentTypes.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:i.ArgumentTypes.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0,lessThan:1},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:i.ArgumentTypes.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN},{argumentType:i.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:i.ArgumentTypes.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,defaultValue:0},{argumentType:i.ArgumentTypes.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:1,maxValue:1e10},{argumentType:i.ArgumentTypes.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,maxValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:i.ArgumentTypes.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:i.ArgumentTypes.NUMBER,minValue:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1},{argumentType:i.ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:i.ArgumentTypes.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0},{argumentType:i.ArgumentTypes.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,greaterThan:0}]}},u.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"}},function(e,t,r){"use strict";t.__esModule=!0,t.bessely=t.besselk=t.besselj=t.besseli=void 0;
/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */
var s=Math;function n(e,t){for(var r=0,s=0;r<e.length;++r)s=t*s+e[r];return s}function a(e,t,r,s,n){if(0===t)return r;if(1===t)return s;for(var a=2/e,o=s,i=1;i<t;++i)o=s*i*a+n*r,r=s,s=o;return o}function o(e,t,r,s,n){return function(r,o){if(s){if(0===r)return 1==s?-1/0:1/0;if(r<0)return NaN}return 0===o?e(r):1===o?t(r):o<0?NaN:a(r,o|=0,e(r),t(r),n)}}var i=function(){var e=.636619772,t=[57568490574,-13362590354,651619640.7,-11214424.18,77392.33017,-184.9052456].reverse(),r=[57568490411,1029532985,9494680.718,59272.64853,267.8532712,1].reverse(),o=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),i=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34935152e-8].reverse();function u(a){var u=0,l=0,h=0,d=a*a;if(a<8)u=(l=n(t,d))/(h=n(r,d));else{var p=a-.785398164;l=n(o,d=64/d),h=n(i,d),u=s.sqrt(e/a)*(s.cos(p)*l-s.sin(p)*h*8/a)}return u}var l=[72362614232,-7895059235,242396853.1,-2972611.439,15704.4826,-30.16036606].reverse(),h=[144725228442,2300535178,18583304.74,99447.43394,376.9991397,1].reverse(),d=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),p=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();function c(t){var r=0,a=0,o=0,i=t*t,u=s.abs(t)-2.356194491;return Math.abs(t)<8?r=(a=t*n(l,i))/(o=n(h,i)):(a=n(d,i=64/i),o=n(p,i),r=s.sqrt(e/s.abs(t))*(s.cos(u)*a-s.sin(u)*o*8/s.abs(t)),t<0&&(r=-r)),r}return function e(t,r){if(r=Math.round(r),!isFinite(t))return isNaN(t)?t:0;if(r<0)return(r%2?-1:1)*e(t,-r);if(t<0)return(r%2?-1:1)*e(-t,r);if(0===r)return u(t);if(1===r)return c(t);if(0===t)return 0;var n=0;if(t>r)n=a(t,r,u(t),c(t),-1);else{for(var o=!1,i=0,l=0,h=1,d=0,p=2/t,m=2*s.floor((r+s.floor(s.sqrt(40*r)))/2);m>0;m--)d=m*p*h-i,i=h,h=d,s.abs(h)>1e10&&(h*=1e-10,i*=1e-10,n*=1e-10,l*=1e-10),o&&(l+=h),o=!o,m==r&&(n=i);n/=l=2*l-h}return n}}();t.besselj=i;var u,l,h,d,p,c,m,g,E,T=(u=.636619772,l=[-2957821389,7062834065,-512359803.6,10879881.29,-86327.92757,228.4622733].reverse(),h=[40076544269,745249964.8,7189466.438,47447.2647,226.1030244,1].reverse(),d=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),p=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34945152e-8].reverse(),c=[-4900604943e3,127527439e4,-51534381390,734926455.1,-4237922.726,8511.937935].reverse(),m=[249958057e5,424441966400,3733650367,22459040.02,102042.605,354.9632885,1].reverse(),g=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),E=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse(),o((function(e){var t=0,r=0,a=0,o=e*e,c=e-.785398164;return e<8?t=(r=n(l,o))/(a=n(h,o))+u*i(e,0)*s.log(e):(r=n(d,o=64/o),a=n(p,o),t=s.sqrt(u/e)*(s.sin(c)*r+s.cos(c)*a*8/e)),t}),(function(e){var t=0,r=0,a=0,o=e*e,l=e-2.356194491;return e<8?t=(r=e*n(c,o))/(a=n(m,o))+u*(i(e,1)*s.log(e)-1/e):(r=n(g,o=64/o),a=n(E,o),t=s.sqrt(u/e)*(s.sin(l)*r+s.cos(l)*a*8/e)),t}),0,1,-1));t.bessely=T;var y,A,f,R,N=(y=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),A=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse(),f=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),R=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse(),function e(t,r){if(0===(r=Math.round(r)))return function(e){return e<=3.75?n(y,e*e/14.0625):s.exp(s.abs(e))/s.sqrt(s.abs(e))*n(A,3.75/s.abs(e))}(t);if(1===r)return function(e){return e<3.75?e*n(f,e*e/14.0625):(e<0?-1:1)*s.exp(s.abs(e))/s.sqrt(s.abs(e))*n(R,3.75/s.abs(e))}(t);if(r<0)return NaN;if(0===s.abs(t))return 0;if(t==1/0)return 1/0;var a,o=0,i=2/s.abs(t),u=0,l=1,h=0;for(a=2*s.round((r+s.round(s.sqrt(40*r)))/2);a>0;a--)h=a*i*l+u,u=l,l=h,s.abs(l)>1e10&&(l*=1e-10,u*=1e-10,o*=1e-10),a==r&&(o=u);return o*=e(t,0)/l,t<0&&r%2?-o:o});t.besseli=N;var C=function(){var e=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),t=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),a=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();return o((function(r){return r<=2?-s.log(r/2)*N(r,0)+n(e,r*r/4):s.exp(-r)/s.sqrt(r)*n(t,2/r)}),(function(e){return e<=2?s.log(e/2)*N(e,1)+1/e*n(r,e*e/4):s.exp(-e)/s.sqrt(e)*n(a,2/e)}),0,2,1)}();t.besselk=C},function(e,t,r){"use strict";
/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */
function s(e){const t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let r,s,n,a,o=t.length-1,i=!1,u=0,l=0;if(0===e)return 0;for(e<0&&(e=-e,i=!0),r=2/(2+e),s=4*r-2;o>0;o--)n=u,u=s*u-l+t[o],l=n;return a=r*Math.exp(-e*e+.5*(t[0]+s*u)-l),i?a-1:1-a}function n(e){return 1-s(e)}function a(e){let t,r,s,a,o=0;if(e>=2)return-100;if(e<=0)return 100;for(a=e<1?e:2-e,s=Math.sqrt(-2*Math.log(a/2)),t=-.70711*((2.30753+.27061*s)/(1+s*(.99229+.04481*s))-s);o<2;o++)r=n(t)-a,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return e<1?t:-t}t.__esModule=!0,t.chisquare=t.centralF=t.binomial=t.beta=void 0,t.corrcoeff=function(e,t){return _(e,t)/P(e,1)/P(t,1)},t.covariance=_,t.erf=s,t.erfc=n,t.exponential=void 0,t.factorial=C,t.factorialln=N,t.gamma=void 0,t.gammafn=i,t.gammaln=l,t.geomean=function(e){return Math.pow(function(e){var t=1,r=e.length;for(;--r>=0;)t*=e[r];return t}(e),1/e.length)},t.lognormal=t.hypgeom=void 0,t.mean=U,t.normal=t.negbin=void 0,t.normalci=function(){var e,t=[].slice.call(arguments),r=new Array(2);e=4===t.length?Math.abs(p.inv(t[1]/2,0,1)*t[2]/Math.sqrt(t[3])):Math.abs(p.inv(t[1]/2,0,1)*P(t[2])/Math.sqrt(t[2].length));return r[0]=t[0]-e,r[1]=t[0]+e,r},t.poisson=void 0,t.stdev=P,t.studentt=void 0,t.sumsqerr=x,t.tci=function(){var e,t=[].slice.call(arguments),r=new Array(2);e=4===t.length?Math.abs(I.inv(t[1]/2,t[3]-1)*t[2]/Math.sqrt(t[3])):Math.abs(I.inv(t[1]/2,t[2].length-1)*P(t[2],!0)/Math.sqrt(t[2].length));return r[0]=t[0]-e,r[1]=t[0]+e,r},t.variance=L,t.weibull=void 0;const o={pdf:(e,t)=>e<0?0:t*Math.exp(-t*e),cdf:(e,t)=>e<0?0:1-Math.exp(-t*e)};function i(e){const t=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],r=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let s,n,a,o,i=!1,u=0,l=0,h=0,d=e;if(e>171.6243769536076)return 1/0;if(d<=0){if(o=d%1,!o)return 1/0;i=(1&d?-1:1)*Math.PI/Math.sin(Math.PI*o),d=1-d}for(a=d,n=d<1?d++:(d-=u=(0|d)-1)-1,s=0;s<8;++s)h=(h+t[s])*n,l=l*n+r[s];if(o=h/l+1,a<d)o/=a;else if(a>d)for(s=0;s<u;++s)o*=d,d++;return i&&(o=i/o),o}t.exponential=o;const u={pdf:function(e,t,r){return e<0?0:0===e&&1===t?1/r:Math.exp((t-1)*Math.log(e)-e/r-l(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:h(t,e/r)},inv:function(e,t,r){return d(e,t)*r}};function l(e){let t=0;const r=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let s,n,a,o=1.000000000190015;for(a=(n=s=e)+5.5,a-=(s+.5)*Math.log(a);t<6;t++)o+=r[t]/++n;return Math.log(2.5066282746310007*o/s)-a}function h(e,t){const r=l(e);let s=e,n=1/e,a=n,o=t+1-e,i=1/1e-30,u=1/o,h=u,d=1;const p=-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17);let c;if(t<0||e<=0)return NaN;if(t<e+1){for(;d<=p;d++)n+=a*=t/++s;return n*Math.exp(-t+e*Math.log(t)-r)}for(;d<=p;d++)c=-d*(d-e),o+=2,u=c*u+o,i=o+c/i,u=1/u,h*=u*i;return 1-h*Math.exp(-t+e*Math.log(t)-r)}function d(e,t){let r=0;const s=t-1,n=l(t);let a,o,i,u,d,p,c;if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(e<=0)return 0;for(t>1?(p=Math.log(s),c=Math.exp(s*(p-1)-n),d=e<.5?e:1-e,i=Math.sqrt(-2*Math.log(d)),a=(2.30753+.27061*i)/(1+i*(.99229+.04481*i))-i,e<.5&&(a=-a),a=Math.max(.001,t*Math.pow(1-1/(9*t)-a/(3*Math.sqrt(t)),3))):(i=1-t*(.253+.12*t),a=e<i?Math.pow(e/i,1/t):1-Math.log(1-(e-i)/(1-i)));r<12;r++){if(a<=0)return 0;if(o=h(t,a)-e,i=t>1?c*Math.exp(-(a-s)+s*(Math.log(a)-p)):Math.exp(-a+s*Math.log(a)-n),u=o/i,a-=i=u/(1-.5*Math.min(1,u*((t-1)/a-1))),a<=0&&(a=.5*(a+i)),Math.abs(i)<1e-8*a)break}return a}t.gamma=u;const p={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return.5*(1+s((e-t)/Math.sqrt(2*r*r)))},inv:function(e,t,r){return-1.4142135623730951*r*a(2*e)+t}};t.normal=p;const c={pdf:function(e,t,r){return e>1||e<0?0:1==t&&1==r?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/m(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-g(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):T(e,t,r)},inv:function(e,t,r){return E(e,t,r)}};function m(e,t){if(!(e<=0||t<=0))return e+t>170?Math.exp(g(e,t)):i(e)*i(t)/i(e+t)}function g(e,t){return l(e)+l(t)-l(e+t)}function E(e,t,r){var s,n,a,o,i,u,h,d,p,c,m=t-1,g=r-1,E=0;if(e<=0)return 0;if(e>=1)return 1;for(t>=1&&r>=1?(a=e<.5?e:1-e,u=(2.30753+.27061*(o=Math.sqrt(-2*Math.log(a))))/(1+o*(.99229+.04481*o))-o,e<.5&&(u=-u),h=(u*u-3)/6,d=2/(1/(2*t-1)+1/(2*r-1)),p=u*Math.sqrt(h+d)/d-(1/(2*r-1)-1/(2*t-1))*(h+5/6-2/(3*d)),u=t/(t+r*Math.exp(2*p))):(s=Math.log(t/(t+r)),n=Math.log(r/(t+r)),u=e<(o=Math.exp(t*s)/t)/(p=o+(i=Math.exp(r*n)/r))?Math.pow(t*p*e,1/t):1-Math.pow(r*p*(1-e),1/r)),c=-l(t)-l(r)+l(t+r);E<10;E++){if(0===u||1===u)return u;if((u-=o=(i=(T(u,t,r)-e)/(o=Math.exp(m*Math.log(u)+g*Math.log(1-u)+c)))/(1-.5*Math.min(1,i*(m/u-g/(1-u)))))<=0&&(u=.5*(u+o)),u>=1&&(u=.5*(u+o+1)),Math.abs(o)<1e-8*u&&E>0)break}return u}function T(e,t,r){var s=0===e||1===e?0:Math.exp(l(t+r)-l(t)-l(r)+t*Math.log(e)+r*Math.log(1-e));return!(e<0||e>1)&&(e<(t+1)/(t+r+2)?s*y(e,t,r)/t:1-s*y(1-e,r,t)/r)}function y(e,t,r){var s,n,a,o,i=1,u=t+r,l=t+1,h=t-1,d=1,p=1-u*e/l;for(Math.abs(p)<1e-30&&(p=1e-30),o=p=1/p;i<=100&&(p=1+(n=i*(r-i)*e/((h+(s=2*i))*(t+s)))*p,Math.abs(p)<1e-30&&(p=1e-30),d=1+n/d,Math.abs(d)<1e-30&&(d=1e-30),o*=(p=1/p)*d,p=1+(n=-(t+i)*(u+i)*e/((t+s)*(l+s)))*p,Math.abs(p)<1e-30&&(p=1e-30),d=1+n/d,Math.abs(d)<1e-30&&(d=1e-30),o*=a=(p=1/p)*d,!(Math.abs(a-1)<3e-7));i++);return o}t.beta=c;const A={pdf:function(e,t,r){return 0===r||1===r?t*r===e?1:0:R(t,e)*Math.pow(r,e)*Math.pow(1-r,t-e)},cdf:function(e,t,r){var s;if(e<0)return 0;if(e>=t)return 1;if(r<0||r>1||t<=0)return NaN;var n=r,a=(e=Math.floor(e))+1,o=t-e,i=a+o,u=Math.exp(l(i)-l(o)-l(a)+a*Math.log(n)+o*Math.log(1-n));return s=n<(a+1)/(i+2)?u*f(n,a,o,1e-10):1-u*f(1-n,o,a,1e-10),Math.round(1/1e-10*(1-s))/(1/1e-10)}};function f(e,t,r,s){for(var n,a=0,o=1,i=1,u=1,l=0,h=0;Math.abs((i-h)/i)>s;)h=i,o=u+(n=-(t+l)*(t+r+l)*e/(t+2*l)/(t+2*l+1))*o,i=(a=i+n*a)+(n=(l+=1)*(r-l)*e/(t+2*l-1)/(t+2*l))*i,a/=u=o+n*u,o/=u,i/=u,u=1;return i/t}function R(e,t){return e>170||t>170?Math.exp(function(e,t){return N(e)-N(t)-N(e-t)}(e,t)):C(e)/C(t)/C(e-t)}function N(e){return e<0?NaN:l(e+1)}function C(e){return e<0?NaN:i(e+1)}t.binomial=A;const S={pdf:function(e,t){return e<0?0:0===e&&2===t?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-l(t/2))},cdf:function(e,t){return e<0?0:h(t/2,e/2)},inv:function(e,t){return 2*d(e,.5*t)}};t.chisquare=S;const M={pdf:function(e,t,r){return e<0?0:t<=2?0===e&&t<2?1/0:0===e&&2===t?1:1/m(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):t*(r/(r+e*t))/2*A.pdf((t-2)/2,(t+r-2)/2,t*e/(r+e*t))},cdf:function(e,t,r){return e<0?0:T(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/E(e,t/2,r/2)-1))}};t.centralF=M;const w={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}};t.weibull=w;const v={pdf:function(e,t){return t<0||e%1!=0||e<0?0:Math.pow(t,e)*Math.exp(-t)/C(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var s=0;r<=e;r++)s+=v.pdf(r,t);return s}};t.poisson=v;const O={pdf:function(e,t,r,s){if(e<0||e<r-(t-s))return 0;if(e>s||e>r)return 0;if(2*r>t)return 2*s>t?O.pdf(t-r-s+e,t,t-r,t-s):O.pdf(s-e,t,t-r,s);if(2*s>t)return O.pdf(r-e,t,r,t-s);if(r<s)return O.pdf(e,t,s,r);for(var n=1,a=0,o=0;o<e;o++){for(;n>1&&a<s;)n*=1-r/(t-a),a++;n*=(s-o)*(r-o)/((o+1)*(t-r-s+o+1))}for(;a<s;a++)n*=1-r/(t-a);return Math.min(1,Math.max(0,n))},cdf:function e(t,r,s,n){if(t<0||t<s-(r-n))return 0;if(t>=n||t>=s)return 1;if(2*s>r)return 2*n>r?e(r-s-n+t,r,r-s,r-n):1-O.cdf(n-t-1,r,r-s,n);if(2*n>r)return 1-O.cdf(s-t-1,r,s,r-n);if(s<n)return O.cdf(t,r,n,s);for(var a=1,o=1,i=0,u=0;u<t;u++){for(;a>1&&i<n;){var l=1-s/(r-i);o*=l,a*=l,i++}a+=o*=(n-u)*(s-u)/((u+1)*(r-s-n+u+1))}for(;i<n;i++)a*=1-s/(r-i);return Math.min(1,Math.max(0,a))}};t.hypgeom=O;const I={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*m(.5,t/2))*Math.pow(1+e*e/t,-(t+1)/2)},cdf:function(e,t){var r=t/2;return T((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(e,t){var r=E(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}};t.studentt=I;const b={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*s((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(e,t,r){return Math.exp(-1.4142135623730951*r*a(2*e)+t)}};t.lognormal=b;const F={pdf:function(e,t,r){return e===e>>>0&&(e<0?0:R(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t))},cdf:function(e,t,r){var s=0,n=0;if(e<0)return 0;for(;n<=e;n++)s+=F.pdf(n,t,r);return s}};function V(e){for(var t=0,r=e.length;--r>=0;)t+=e[r];return t}function U(e){return V(e)/e.length}function x(e){for(var t,r=U(e),s=0,n=e.length;--n>=0;)s+=(t=e[n]-r)*t;return s}function L(e,t){return x(e)/(e.length-(t?1:0))}function P(e,t){return Math.sqrt(L(e,t))}function _(e,t){var r,s=U(e),n=U(t),a=e.length,o=new Array(a);for(r=0;r<a;r++)o[r]=(e[r]-s)*(t[r]-n);return V(o)/(a-1)}t.negbin=F},function(e,t,r){"use strict";t.__esModule=!0,t.MathPlugin=void 0;var s=r(1),n=r(18),a=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class o extends a.FunctionPlugin{fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),e=>{e=Math.trunc(e);let t=1;for(let r=1;r<=e;r++)t*=r;return t})}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),e=>{let t=1;for(let r=e=Math.trunc(e);r>=1;r-=2)t*=r;return t})}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(e,t)=>t>e?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.WrongOrder):i(e=Math.trunc(e),t=Math.trunc(t)))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(e,t)=>(e=Math.trunc(e))+(t=Math.trunc(t))-1>=1030?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):0===e&&0===t?1:i(e+t-1,t))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(e);if(t instanceof s.CellError)return t;let r=0;for(const e of t){if(e<0)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);r=u(r,Math.trunc(e))}return r>Number.MAX_SAFE_INTEGER?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):r})}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(e);if(t instanceof s.CellError)return t;let r=1;for(const e of t){if(e<0)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);r=l(r,Math.trunc(e))}return r>Number.MAX_SAFE_INTEGER?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueLarge):r})}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(e,t)=>0===t?0:e>0&&t<0||e<0&&t>0?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.DistinctSigns):Math.round(e/t)*t)}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(...e)=>{let t=0,r=1;for(let a of e){if(a<0)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);a=Math.trunc(a);for(let e=1;e<=a;e++)r*=(t+e)/e;t+=a}return Math.round(r)})}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(e,t)=>0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.trunc(e/t))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(e,t,r,n)=>{const a=this.arithmeticHelper.manyToOnlyNumbersDropNulls(n.valuesFromTopLeftCorner());if(a instanceof s.CellError)return a;let o=0;a.reverse();for(const t of a)o*=Math.pow(e,r),o+=t;return o*Math.pow(e,t)})}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),e=>e>0?1:e<0?-1:0)}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(e,t)=>{const r=e.valuesFromTopLeftCorner(),a=t.valuesFromTopLeftCorner();if(r.length!==a.length)return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const o=r.length;let i=0;for(let e=0;e<o;e++){const t=r[e],n=a[e];if(t instanceof s.CellError)return t;if(n instanceof s.CellError)return n;"number"==typeof t&&"number"==typeof n&&(i+=Math.pow(t,2)-Math.pow(n,2))}return i})}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(e,t)=>{const r=e.valuesFromTopLeftCorner(),a=t.valuesFromTopLeftCorner();if(r.length!==a.length)return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const o=r.length;let i=0;for(let e=0;e<o;e++){const t=r[e],n=a[e];if(t instanceof s.CellError)return t;if(n instanceof s.CellError)return n;"number"==typeof t&&"number"==typeof n&&(i+=Math.pow(t,2)+Math.pow(n,2))}return i})}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(e,t)=>{const r=e.valuesFromTopLeftCorner(),a=t.valuesFromTopLeftCorner();if(r.length!==a.length)return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const o=r.length;let i=0;for(let e=0;e<o;e++){const t=r[e],n=a[e];if(t instanceof s.CellError)return t;if(n instanceof s.CellError)return n;"number"==typeof t&&"number"==typeof n&&(i+=Math.pow(t-n,2))}return i})}}function i(e,t){2*t>e&&(t=e-t);let r=1;for(let s=1;s<=t;s++)r*=(e-t+s)/s;return Math.round(r)}function u(e,t){for(e<t&&([e,t]=[t,e]);t>0;)[e,t]=[t,e%t];return e}function l(e,t){return 0===e||0===t?0:e*(t/u(e,t))}t.MathPlugin=o,o.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:a.ArgumentTypes.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:a.ArgumentTypes.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:a.ArgumentTypes.NUMBER,minValue:0,lessThan:1030},{argumentType:a.ArgumentTypes.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:a.ArgumentTypes.NUMBER,minValue:0},{argumentType:a.ArgumentTypes.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:a.ArgumentTypes.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:a.ArgumentTypes.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:a.ArgumentTypes.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.NUMBER},{argumentType:a.ArgumentTypes.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:a.ArgumentTypes.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:a.ArgumentTypes.RANGE},{argumentType:a.ArgumentTypes.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:a.ArgumentTypes.RANGE},{argumentType:a.ArgumentTypes.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:a.ArgumentTypes.RANGE},{argumentType:a.ArgumentTypes.RANGE}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ComplexPlugin=void 0;var s=r(1),n=r(18),a=r(29),o=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class i extends o.FunctionPlugin{complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(e,t,r)=>"i"!==r&&"j"!==r?new s.CellError(s.ErrorType.VALUE,n.ErrorMessage.ShouldBeIorJ):(0,a.coerceComplexToString)([e,t],r))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),E)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),([e,t])=>t)}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),([e,t])=>e)}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),([e,t])=>0===e&&0===t?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.atan2(t,e))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),([e,t])=>(0,a.coerceComplexToString)([e,-t]))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),e=>(0,a.coerceComplexToString)(d(e)))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),e=>(0,a.coerceComplexToString)(p(e)))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),e=>(0,a.coerceComplexToString)(h(d(e),c(e))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),e=>(0,a.coerceComplexToString)(h([1,0],c(e))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),e=>(0,a.coerceComplexToString)(h([1,0],m(e))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),e=>(0,a.coerceComplexToString)(h([1,0],d(e))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),e=>(0,a.coerceComplexToString)(h([1,0],p(e))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),e=>(0,a.coerceComplexToString)(c(e)))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),e=>(0,a.coerceComplexToString)(m(e)))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),e=>(0,a.coerceComplexToString)(h(c(e),d(e))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(e,t)=>(0,a.coerceComplexToString)(h(e,t)))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(...e)=>{const t=this.arithmeticHelper.coerceComplexExactRanges(e);if(t instanceof s.CellError)return t;let r=[1,0];for(const e of t)r=l(r,e);return(0,a.coerceComplexToString)(r)})}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),(...e)=>{const t=this.arithmeticHelper.coerceComplexExactRanges(e);if(t instanceof s.CellError)return t;let r=[0,0];for(const e of t)r=u(r,e);return(0,a.coerceComplexToString)(r)})}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(e,t)=>(0,a.coerceComplexToString)(function([e,t],[r,s]){return[e-r,t-s]}(e,t)))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),e=>(0,a.coerceComplexToString)(g(e)))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),e=>(0,a.coerceComplexToString)(T(e)))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),e=>{const[t,r]=T(e),s=Math.log(10);return(0,a.coerceComplexToString)([t/s,r/s])})}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),e=>{const[t,r]=T(e),s=Math.log(2);return(0,a.coerceComplexToString)([t/s,r/s])})}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(e,t)=>(0,a.coerceComplexToString)(y(e,t)))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),e=>(0,a.coerceComplexToString)(y(e,.5)))}}function u([e,t],[r,s]){return[e+r,t+s]}function l([e,t],[r,s]){return[e*r-t*s,e*s+r*t]}function h([e,t],[r,s]){const n=Math.pow(r,2)+Math.pow(s,2),[a,o]=l([e,t],[r,-s]);return[a/n,o/n]}function d([e,t]){return[Math.cos(e)*Math.cosh(t),-Math.sin(e)*Math.sinh(t)]}function p([e,t]){return[Math.cosh(e)*Math.cos(t),Math.sinh(e)*Math.sin(t)]}function c([e,t]){return[Math.sin(e)*Math.cosh(t),Math.cos(e)*Math.sinh(t)]}function m([e,t]){return[Math.sinh(e)*Math.cos(t),Math.cosh(e)*Math.sin(t)]}function g([e,t]){return[Math.exp(e)*Math.cos(t),Math.exp(e)*Math.sin(t)]}function E([e,t]){return Math.sqrt(e*e+t*t)}function T([e,t]){return[Math.log(E([e,t])),Math.atan2(t,e)]}function y(e,t){const[r,s]=T(e);return g([t*r,t*s])}t.ComplexPlugin=i,i.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.NUMBER},{argumentType:o.ArgumentTypes.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:o.ArgumentTypes.COMPLEX},{argumentType:o.ArgumentTypes.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:o.ArgumentTypes.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:o.ArgumentTypes.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:o.ArgumentTypes.COMPLEX},{argumentType:o.ArgumentTypes.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:o.ArgumentTypes.COMPLEX},{argumentType:o.ArgumentTypes.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:o.ArgumentTypes.COMPLEX}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.StatisticalAggregationPlugin=void 0;var s=r(1),n=r(18),a=r(32),o=r(144),i=r(28);
/**
 * @license
 * Copyright (c) 2021 Handsoncode. All rights reserved.
 */
class u extends i.FunctionPlugin{avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof s.CellError)return t;if(0===t.length)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const r=(0,o.mean)(t);return t.reduce((e,t)=>e+Math.abs(t-r),0)/t.length})}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);return t instanceof s.CellError?t:0===t.length?0:(0,o.sumsqerr)(t)})}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof s.CellError)return t;if(0===t.length)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.OneValue);for(const e of t)if(e<=0)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);return(0,o.geomean)(t)})}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof s.CellError)return t;if(0===t.length)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.OneValue);for(const e of t)if(e<=0)return new s.CellError(s.ErrorType.NUM,n.ErrorMessage.ValueSmall);return t.length/t.reduce((e,t)=>e+1/t,0)})}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof s.CellError)return r;return r[0].length<=1?new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues):(0,o.corrcoeff)(r[0],r[1])})}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof s.CellError)return r;return r[0].length<=1?new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues):Math.pow((0,o.corrcoeff)(r[0],r[1]),2)})}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof s.CellError)return r;const a=r[0].length;return a<1?new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.OneValue):1===a?0:(0,o.covariance)(r[0],r[1])*(a-1)/a})}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof s.CellError)return r;return r[0].length<=1?new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues):(0,o.covariance)(r[0],r[1])})}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),(e,t,r)=>{const a=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());if(a instanceof s.CellError)return a;const i=a.length;if(void 0===r){if(i<2)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues);r=(0,o.stdev)(a,!0)}return i<1?new s.CellError(s.ErrorType.NA,n.ErrorMessage.OneValue):0===r?new s.CellError(s.ErrorType.DIV_BY_ZERO):1-o.normal.cdf(((0,o.mean)(a)-t)/(r/Math.sqrt(i)),0,1)})}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),(e,t)=>{const r=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner()),n=this.arithmeticHelper.manyToExactNumbers(t.valuesFromTopLeftCorner());if(r instanceof s.CellError)return r;if(n instanceof s.CellError)return n;if(r.length<=1||n.length<=1)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const a=(0,o.variance)(r,!0),i=(0,o.variance)(n,!0);if(0===a||0===i)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const u=a/i,l=o.centralF.cdf(u,r.length-1,n.length-1);return 2*Math.min(l,1-l)})}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof s.CellError)return r;const a=r[0].length;return a<=2?new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.ThreeValues):Math.sqrt(((0,o.sumsqerr)(r[0])-Math.pow((0,o.covariance)(r[0],r[1])*(a-1),2)/(0,o.sumsqerr)(r[1]))/(a-2))})}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof s.CellError)return r;const a=r[0].length;return a<=1?new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues):(0,o.covariance)(r[0],r[1])*(a-1)/(0,o.sumsqerr)(r[1])})}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(e,t)=>{const r=e.height(),a=e.width();if(t.height()!==r||t.width()!==a)return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);const i=l(e,t);if(i instanceof s.CellError)return i;if(i[0].length<=1)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues);let u=0;for(let e=0;e<i[0].length;e++){if(0===i[1][e])return new s.CellError(s.ErrorType.DIV_BY_ZERO);u+=Math.pow(i[0][e]-i[1][e],2)/i[1][e]}return u<0?new s.CellError(s.ErrorType.NUM,n.ErrorMessage.NaN):1-o.chisquare.cdf(u,r>1&&a>1?(r-1)*(a-1):r*a-1)})}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),(e,t,r,a)=>{const i=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(t.valuesFromTopLeftCorner());if(i instanceof s.CellError)return i;if(u instanceof s.CellError)return u;const l=i.length,h=u.length;if(1===a){if(h!==l)return new s.CellError(s.ErrorType.NA,n.ErrorMessage.EqualLength);if(l<=1)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues);const e=Array(l);for(let t=0;t<l;t++)e[t]=i[t]-u[t];const t=(0,o.stdev)(e,!0);if(0===t)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const a=Math.abs(Math.sqrt(l)*(0,o.mean)(e)/t);return r*(1-o.studentt.cdf(a,l-1))}if(2===a){if(l<=1||h<=1)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues);const e=((0,o.sumsqerr)(i)+(0,o.sumsqerr)(u))/(l+h-2);if(0===e)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const t=Math.abs(((0,o.mean)(i)-(0,o.mean)(u))/Math.sqrt(e*(1/l+1/h)));return r*(1-o.studentt.cdf(t,l+h-2))}{if(l<=1||h<=1)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.TwoValues);const e=(0,o.variance)(i,!0),t=(0,o.variance)(u,!0);if(0===e&&0===t)return new s.CellError(s.ErrorType.DIV_BY_ZERO);const a=Math.abs(((0,o.mean)(i)-(0,o.mean)(u))/Math.sqrt(e/l+t/h)),d=Math.pow(e/l+t/h,2)/(Math.pow(e/l,2)/(l-1)+Math.pow(t/h,2)/(h-1));return r*(1-o.studentt.cdf(a,d))}})}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof s.CellError)return t;const r=t.length;if(r<3)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.ThreeValues);const a=(0,o.mean)(t),i=(0,o.stdev)(t,!0);return 0===i?new s.CellError(s.ErrorType.DIV_BY_ZERO):t.reduce((e,t)=>e+Math.pow((t-a)/i,3),0)*r/(r-1)/(r-2)})}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),(...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof s.CellError)return t;const r=t.length;if(r<3)return new s.CellError(s.ErrorType.DIV_BY_ZERO,n.ErrorMessage.ThreeValues);const a=(0,o.mean)(t),i=(0,o.stdev)(t,!1);return 0===i?new s.CellError(s.ErrorType.DIV_BY_ZERO):t.reduce((e,t)=>e+Math.pow((t-a)/i,3),0)/r})}}function l(e,t){const r=e.iterateValuesFromTopLeftCorner(),n=t.iterateValuesFromTopLeftCorner();let o,i;const u=[],l=[];for(;o=r.next(),i=n.next(),!o.done&&!i.done;){const e=o.value,t=i.value;if(e instanceof s.CellError)return e;if(t instanceof s.CellError)return t;(0,a.isExtendedNumber)(e)&&(0,a.isExtendedNumber)(t)&&(u.push((0,a.getRawValue)(e)),l.push((0,a.getRawValue)(t)))}return[u,l]}t.StatisticalAggregationPlugin=u,u.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:i.ArgumentTypes.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:i.ArgumentTypes.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:i.ArgumentTypes.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:i.ArgumentTypes.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.NUMBER},{argumentType:i.ArgumentTypes.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.RANGE},{argumentType:i.ArgumentTypes.INTEGER,minValue:1,maxValue:2},{argumentType:i.ArgumentTypes.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:i.ArgumentTypes.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:i.ArgumentTypes.ANY}],repeatLastArgs:1}},u.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"}}]).default}));